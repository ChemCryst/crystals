<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux (vers 25 March 2009), see www.w3.org" />

  <title>MinGW compilers</title>
  <link rel="important stylesheet" href="chrome://messagebody/skin/messageBody.css" />
  <meta http-equiv="Content-Type" content="text/html;" />
</head>

<body>
  <div dir="ltr">
    <h1>Setup to be ready to compile CRYSTALS on Windows using 64-bit MinGW compiler,
    CMake and wxWidgets 3.0</h1><br />
    <br />

    <h2>I. Install MSYS2</h2>We're not going to use it to build CRYSTALS, but it provides
    a handy way to installI.&nbsp; MinGW compilers.<br />
    Install instuctions are provided here: <a href=
    "http://sourceforge.net/p/msys2/wiki/MSYS2%20installation/">http://sourceforge.net/p/msys2/wiki/MSYS2%20installation/</a>,
    but also summarized below.<br />
    <br />
    1. <a href="http://repo.msys2.org/distrib/x86_64/">get the latest .exe installer
    (64-bit).</a>&nbsp; Select the latest stable version.<br />
    2. Run the MSYS2 installer (install dir c:\msys64\)<br />
    <br />
    3. Start MSYS2 (either from the installer <strong>Start Now</strong>, or by finding
    "MSYS2 shell" in the start menu)<br />
    <br />
    4. Type 'pacman -Su' at the prompt. Type 'Y' if it asks for confirmation to download
    packges.<br />
    <br />
    5. Type 'pacman -S mingw-w64-x86_64-gcc'. Type 'Y' if it asks for confirmation to
    download packges.<br />
    &nbsp;&nbsp; Type 'pacman -S mingw-w64-x86_64-make'. Type 'Y' if it asks for
    confirmation to download packges.<br />
    &nbsp;&nbsp; Type 'pacman -S mingw-w64-x86_64-toolchain'. Hit return to install all
    packages.<br />
    &nbsp;&nbsp; Type 'pacman -S mingw-w64-x86_64-openblas'. Type 'Y' if it asks for
    confirmation to download packges.<br />
    &nbsp;&nbsp;<br />
    6. Close the MSYS2 prompt and never use it again. Open a normal CMD.EXE prompt.<br />
    <br />
    7. Install CMAKE from <a href="http://cmake.org">cmake.org</a> [at time of writing
    version 3.15.0]. Get the Win32 installer version.<br />
    &nbsp;During the installation make sure the 'Add CMAKE to system path for all users'
    box is checked.<br />
    &nbsp;<br />
    <h3>Bugfix Jun 2019</h3>
    Need to downgrade compiler because current one founders on ',' in text lines<br />
    Necessary dlls are in the temporary folder <strong>extras</strong> in msys64.<br />
    Type pacman -U c:/msys64/extras/*.xz<br />
    <br />

    <h2>II. Download wxWidgets.</h2>1.
    A better option is IIb below, download the dll directly<br /><br />
    Get the ZIP not the installer. At time of writing
    this is version 3.1.2<br />
    &nbsp;Extract everything to c:\wx where c: is disk where CRYSTALS lives<br />
    2. SET PATH=c:\msys64\mingw64\bin;%PATH%<br />
    3. cd c:\wx\build\msw<br />
    <br />

    <table border="3" cellspacing="0" cellpadding="0">
      <tr>
        <td>
          <i><strong>For info: Lines too long problem</strong></i><br />
          Solution based on similar problem here:<br />
          https://wiki.wxwidgets.org/Compiling_wxWidgets_with_MinGW#To_fix_the_issue_.22The_input_line_is_too_long.22_when_compile_static_library_with_MONOLITHIC_option<br />

          <br />
          Edit <strong>build/msw/makefile.gcc</strong> and change the line starting<br />

          <h3>ar rcu $@ $(CORELIB_OBJECTS)</h3>to<br />

          <h3>ar rcu $@ gcc_mswu/corelib*.o</h3>Also note that the first step in the
          document (update-core) no longer required - in fact that command isn't found.
        </td>
      </tr>
    </table><br />
    <br />
    4. Issue: mingw32-make -f makefile.gcc SHARED=0 UNICODE=1 BUILD=release SHELL=cmd.exe
    CXXFLAGS=-std=gnu++11<br />
    <br />
    <i><strong>Check it has worked.</strong></i><br />
    5. cd c:\wx\samples<br />
    6. Issue<br />
    mingw32-make -f makefile.gcc SHARED=0 UNICODE=1 BUILD=release SHELL=cmd.exe
    CXXFLAGS=-std=gnu++11<br />
    <br />
    <i><strong>Run test program</strong></i> and check you get an OpenGL window
    containing a 3D penguin<br />
    7. cd opengl\penguin\gcc_mswu<br />
    8. Just type "penguin.exe"<br />
    <br />
    <h2>IIb Install .dlls directly</h2>
    1) Go to wxwidgets.org/downloads<br />
    2) Go to Windows Binaries for minGW-w64.8.10 <br />
    3) Download from gcc810_x64_dll to a new folder (eg wx-3)<br />
    <ul>
    <li> wxMSW-3.1.2_gcc810_x64_release_dll.7z
    <li> wxMSW-3.1.2_gcc810_x64_Dev
    <li> wxWidget-3.1.2-headers.7z
    </ul>

    <h2>III Install Strawberry Perl</h2>
    <h2>IV Checkout a copy of CRYSTALS from gitHub</h2>

    Username = david-watkin <br />
    access is 15-jun-42<br /><br />
    1. add c:\msys64\mingw64\bin to your path<br />
       If you used option IIB, add (for example) c:\wx-3\lib\gcc810_x64_dll to your run environment 
       path<br />
    2. cd crystals<br />
    3. mkdir b<br />
    4. cd b<br />
    5. Put the following line into a bat file, for example crystals/build/CMAKE.BAT. This must be
    executed each time a new CRYSTALS system is downloaded from the repository or a new
    module (e.g. a new script) is added<br />
    <strong>cmake -DMINGW=1 -DwxWidgets_ROOT_DIR=e:\wx
    -DwxWidgets_LIB_DIR=e:\wx\lib\gcc_lib -DwxWidgets_CONFIGURATION=mswu -G"MinGW
    Makefiles" <br /><br />
    or<br />

    <strong>cmake -DMINGW=1 -DwxWidgets_ROOT_DIR=e:\wx-3 &nbsp;&nbsp;&nbsp;
    -DwxWidgets_LIB_DIR=e:\wx-3\lib\gcc810_x64-dll &nbsp;&nbsp;&nbsp;
    -DwxWidgets_CONFIGURATION=mswu &nbsp;&nbsp;&nbsp;
    -G"MinGW&nbsp;&nbsp;&nbsp;
    Makefiles" <br /><br />


    In crystals\CMakeLists.txt dont forget this change, at about line 202<br />
    <br />
    # abi line copied across by DJW<br />
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fabi-version=9")<br />
    <br /></strong>
    6. To compile CRYSTALS, SCRIPTS etc or any new changes, issue:<br />
    7. mingw32-make<br />
    8. To get a clean build, issue <i>mingw32-make clean</i> and then recompile.<br />
    9. Create execution environment bat file (e.g.)
    <pre>
path=%path%;h:\crystals\b;c:\msys64\mingw64\bin;
path=%path%;c:\progra~1\micros~3\common\tools;c:\progra~1\bbc;
path=%path%;u:\ecce;
set dircmd=/o:ne /x
doskey/insert
set crysdir=h:\crystals\b\
set COMPCODE=GID
D:
cd \cyclo
    
</pre>    
   <h2>V Install Git for Windows, (gitforwindows.org) v 2.21.0 </h2>
   1. Install in AppData\local\Programs\git
   <h2>VI Install Tortoise Git, v 2.8.0.0 </h2>
   username: david-watkin<br />
   account: 440555616+david-watkin@users.noreply.github<br />



   <h2>VII Install Anaconda Sphinx</h2>
   for building the documentation<br /><br />
   1. Download and Install Anaconda 3-5.2.0-Windows-x86_64<br />
   2. If the documentation compilatiion folder (b) already exists, delete all the 
      contents<br />
   3. Set path=c:\msys64\mingw64\bin;%path%;c:\perl\bin;<br />
      (see 2019-sphinx.bat)<br />
   4. Set PATH=C:\ProgramData\Anaconda3;C:\ProgramData\Anaconda3\Library\mingw-w64\bin;C:\ProgramData\Anaconda3\Library\usr\bin;C:\ProgramData\Anaconda3\Library\bin;C:\ProgramData\Anaconda3\Scripts;C:\ProgramData\Anaconda3\bin;%path%
      <br /> 
     (See anaconda.bat)<br />
   5. Issue pip install sphinx_rtd_theme<br />
   6. cd b\<br />
   7. Issue cmake &nbsp;&nbsp;&nbsp; .. &nbsp;&nbsp;&nbsp; -G"MinGW Makefiles" to create makefiles 
      (makesphinx.bat)<br />
   8. Issue: mingw32-make to build system (sphinx.bat)

  <h2>VIII Jenkins.</h2>
   The uploaded files are processed by Jenkins, ID djw, copecottage

  

  </div>
</body>
</html>
