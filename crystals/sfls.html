<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Structure Factors And Least Squares &mdash; CRYSTALS 15.4.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=a6d7e377"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Fourier Routines" href="fourier.html" />
    <link rel="prev" title="Atomic And Structural Parameters" href="parameters.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CRYSTALS
          </a>
              <div class="version">
                15.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">CRYSTALS documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../userguide.html">Crystals User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../userguide/install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/gettingstarted.html">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../userguide/gettingstarted.html#organisation-of-data">Organisation of data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/gettingstarted.html#starting-the-program">Starting the program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/gettingstarted.html#customising-crystals-to-suit-your-screen-size">Customising CRYSTALS to suit your screen size</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/examples.html">Worked examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../userguide/examples.html#cyclo-a-routine-structure-analysis">Cyclo - a routine structure analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#video-demonstration">Video demonstration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#step-one-import-cell-and-crystal-data">Step one: Import cell and crystal data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#step-two-import-reflection-data">Step two: Import reflection data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#step-three-initial-assessment-of-the-data">Step three: Initial assessment of the data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#step-four-structure-solution">Step four: Structure solution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#step-five-check-atom-types">Step five: Check atom types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#step-six-commence-refinement">Step six: Commence refinement…</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#step-seven-adding-hydrogen-atoms">Step seven: Adding Hydrogen Atoms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#step-eight-more-refinement-extinction">Step eight: More refinement &amp; Extinction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#step-nine-choose-a-nice-weighting-scheme">Step nine: Choose a nice weighting scheme</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#step-ten-validation-and-cif-archival">Step ten: Validation and CIF archival.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/examples.html#poor-quality-data-tetraphenylene">Poor Quality Data - Tetraphenylene</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#background">Background</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#analysis-and-solution">Analysis and solution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#refinement">Refinement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/examples.html#but-what-of-the-e-s-d-s">But what of the e.s.d’s?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/examples.html#spacegroup-quiz">Spacegroup Quiz</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/userinterface.html">User Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../userguide/userinterface.html#overview-of-the-graphical-user-interface">Overview of the graphical user interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/userinterface.html#the-menus">The Menus</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#file">File</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#x-ray-data">X-ray data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#preprocess">Diffractometer cifs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#input-pre-processed-data">Input Pre-processed data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#solve">Solve</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#structure">Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#fourier">Fourier</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#refinement">Refinement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#results">Results</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#results-rotax">Results -&gt; Rotax</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#graphics">Graphics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#graphics-special">Graphics -&gt; Special</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#appearance">Appearance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#appearance-atoms">Appearance -&gt; Atoms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#appearance-model">Appearance -&gt; Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../userguide/userinterface.html#development">Development</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/commandline.html">Command line</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../userguide/commandline.html#command-syntax">Command syntax</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/faqs.html">Frequently asked questions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#getting-started-organisation-of-files">Getting Started: Organisation of files.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#general-who-is-responsible-for-it">General: Who is responsible for it?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#general-where-is-the-manual">General: Where is the manual?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#general-is-there-an-example-to-work-through">General: Is there an example to work through?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#general-can-i-prepare-commands-to-run-crystals-in-batch-mode-like-shelx">General: Can I prepare commands to run CRYSTALS in batch mode (like SHELX)?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#general-is-there-any-command-line-help">General: Is there any command line help?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#general-how-can-i-switch-the-left-and-right-crystals-windows">General: How can I switch the left and right CRYSTALS windows?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#solving-structures-how-do-i-prepare-a-job-for-sir92-or-shelxs">Solving structures: How do I prepare a job for SIR92 or SHELXS?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#solving-structures-it-failed-how-do-i-prepare-a-different-job">Solving structures: It failed. How do I prepare a different job?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#solving-structures-how-do-i-import-the-solution-back-into-crystals">Solving structures: How do I import the solution back into CRYSTALS?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#cameron-how-do-i-see-a-plot-of-the-structure">CAMERON: How do I see a plot of the structure?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#cameron-can-i-rotate-it-and-label-the-atoms">CAMERON: Can I rotate it and label the atoms?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#cameron-how-do-i-delete-atoms">CAMERON: How do I delete atoms?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#fourier-how-do-i-calculate-a-fourier-map-to-find-missing-atoms">Fourier: How do I calculate a Fourier map to find missing atoms?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#refinement-what-infomation-does-crystals-need">Refinement: What infomation does CRYSTALS need?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#refinement-refinement-instructions">Refinement: Refinement instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#refinement-occupancies-of-an-atom-or-fragment-split-over-two-sites">Refinement: Occupancies of an atom or fragment split over two sites?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#refinement-how-do-i-add-restraints">Refinement: How do I add restraints?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#refinement-how-do-you-use-platon-s-squeeze-from-crystals">Refinement: How do you use Platon’s Squeeze from CRYSTALS?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#refinement-what-are-parts-assemblies-and-groups">Refinement: What are parts assemblies and groups?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#structure-how-can-i-adjust-a-molecule-or-fragment-to-have-ideal-coordinates">Structure: How can I adjust a molecule or fragment to have ideal coordinates?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#analysis-find-the-angle-between-a-plane-of-atoms-and-a-bond">Analysis: Find the angle between a plane of atoms and a bond</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#analysis-calculate-intermolecular-distances">Analysis: Calculate intermolecular distances</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#analysis-find-likely-h-bonds-with-donors-or-acceptors-other-the-o-and-n">Analysis: Find LIKELY H-BONDS with donors or acceptors other the O and N</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#analysis-how-do-i-use-rotax-to-test-for-twin-laws">Analysis: How do I use ROTAX to test for twin laws?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#analysis-how-do-i-add-hydrogen-atoms-to-water-molecules">Analysis: How do I add hydrogen atoms to water molecules?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#publication-editor-wants-completeness-of-the-data-at-25-degrees">Publication: Editor wants completeness of the data at 25 degrees</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#publication-what-s-the-difference-between-theta-max-and-theta-full">Publication: What’s the difference between _theta_max and _theta_full?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#publication-diagram-shows-wrong-enantiomer-what-to-do">Publication: Diagram shows wrong enantiomer. What to do?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#references-what-references-should-i-know-about">References: What References should I know about?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../userguide/faqs.html#miscellaneous-environment-variables">Miscellaneous: Environment variables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../crystalsmanual.html">Crystals Reference Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Definitions And Conventions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="intro.html#syntax-of-commands">Syntax of Commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="intro.html#format-of-commands">Format of Commands</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#syntax-of-the-manual">Syntax of the manual</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#types-of-commands">Types of Commands:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="intro.html#lists">Lists</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#commands">Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#immediate-commands">Immediate Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#comments">Comments</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#continuation-lines">Continuation Lines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#index-3">Immediate commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="intro.html#finish">\FINISH</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#id2">\ ….. COMMENTS ….</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#title-a-title-to-be-printed">\TITLE ….. A title to be printed …..</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#type-filename">\TYPE  ‘filename’</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#use-source">\USE source</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#script-filename">\SCRIPT filename</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#spawn-shell-command">\SPAWN      ‘shell command’</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#shell-command">$      ‘shell command’</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#commands-command">\COMMANDS   command</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#text">? text</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#manual-name">\MANUAL  ‘name’</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#help-topic">\HELP   ‘topic’</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#release-devicename-filename">\RELEASE  devicename filename</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#open-devicename-filename">\OPEN devicename filename</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#close-devicename">\CLOSE devicename</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#append-devicename-filename">\APPEND devicename filename</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#flush-devicename">\FLUSH devicename</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#device-names">Device names</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#pause-interval">\PAUSE interval</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#bench-nparam-nref">\BENCH nparam nref</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-list-state">\SET LIST   state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-watch-number">\SET WATCH number</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-file-type">\SET FILE type</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-generate-state">\SET GENERATE state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-export-state">\SET EXPORT state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-uequiv-state">\SET UEQUIV state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-pause-value">\SET PAUSE value</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-log-state">\SET LOG state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-mirror-state">\SET MIRROR state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-page-length">\SET PAGE length</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-terminal-device">\SET TERMINAL device</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-communication-speed">\SET COMMUNICATION speed</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-time-state">\SET TIME state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-printer-state">\SET PRINTER state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-monitor-state">\SET MONITOR state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-openmessage-state">\SET OPENMESSAGE state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-message-state">\SET MESSAGE state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-srq-state">\SET SRQ state</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#set-ratio-state">\SET RATIO state</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#files">Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#errors-and-warnings">Errors and Warnings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="intro.html#warnings">Warnings</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#errors">Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#severe-errors">Severe Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#catastrophic-errors">Catastrophic Errors.</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#programming-errors">Programming Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#errors-detected-during-the-creation-of-a-list">Errors Detected During the Creation of a LIST</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#the-crystals-database">The Crystals Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="intro.html#general-list-control-directives-disk">General List-control Directives  -  \DISK</a><ul>
<li class="toctree-l4"><a class="reference internal" href="intro.html#disk">\DISK</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#elimination-of-old-versions-of-lists-purge">Elimination of Old Versions of LISTS  -  \PURGE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="intro.html#id3">\PURGE</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#lists-in-current-use">LISTS in Current use</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#printed-summary-of-data-lists">Printed Summary of Data lists</a><ul>
<li class="toctree-l4"><a class="reference internal" href="intro.html#summary">\SUMMARY</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#element-and-atom-names">Element and Atom names</a><ul>
<li class="toctree-l4"><a class="reference internal" href="intro.html#element-names">Element Names</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#atom-names">Atom names</a></li>
<li class="toctree-l4"><a class="reference internal" href="intro.html#symmetry-equivalent-atoms">Symmetry equivalent atoms</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#foreign-program-links">Foreign Program Links</a><ul>
<li class="toctree-l4"><a class="reference internal" href="intro.html#foreign">\FOREIGN</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="initial.html">Initial Data Input</a><ul>
<li class="toctree-l3"><a class="reference internal" href="initial.html#scope-of-the-initial-data-input-section">Scope of the Initial Data Input section.</a></li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#abbreviated-startup-command-quickstart">Abbreviated startup command  -  QUICKSTART</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#quickstart">\QUICKSTART</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#input-of-the-cell-parameters-list-1">Input of the cell parameters  -  LIST 1</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#list-1">\LIST 1</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#printing-the-cell-parameters">Printing the cell parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#print-1">\PRINT 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="initial.html#punch-1">\PUNCH 1</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#input-of-the-unit-cell-parameter-errors-list-31">Input of the unit cell parameter errors  -  LIST 31</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#list-31">\LIST 31</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#printing-the-cell-variance-covariance-matrix">Printing the cell variance-covariance matrix</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#print-31">\PRINT 31</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#space-group-input-spacegroup">Space Group input - \SPACEGROUP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#id1">\SPACEGROUP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#input-of-the-symmetry-data-list-2">Input of the symmetry data  -  LIST 2</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#list-2">\LIST 2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#printing-the-symmetry-information">Printing the symmetry information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#print-2">\PRINT 2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#input-of-molecular-composition-composition">Input of molecular composition \COMPOSITION</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#composition">\COMPOSITION</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#input-of-the-atomic-scattering-factors-list-3">Input of the atomic scattering factors  -  \LIST 3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#list-3">\LIST 3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#printing-the-scattering-factors">Printing the scattering factors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#print-3">\PRINT 3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#input-of-the-crystal-and-data-collection-details-list-13">Input of the crystal and data collection details  -  LIST 13</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#list-13">\LIST 13</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#printing-the-experimental-conditions-list-13">Printing the experimental conditions, LIST 13</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#print-13">\PRINT 13</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#input-of-structural-formula-as-a-smiles-string-list-18">Input of Structural Formula as a SMILES string - LIST 18</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#list-18">\LIST 18</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#printing-the-smiles-string-list-18">Printing the SMILES string, LIST 18</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#print-18">\PRINT 18</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#punching-the-smiles-string-list-18">Punching the SMILES string, LIST 18</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#punch-18">\PUNCH 18</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#input-of-the-contents-of-the-asymmetric-unit-list-29">Input of the contents of the asymmetric unit  -  LIST 29</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#list-29">\LIST 29</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#printing-the-contents-of-the-asymmetric-unit-list-29">Printing the contents of the asymmetric unit, LIST 29</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#print-29">\PRINT 29</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#input-of-general-crystallographic-data-list-30">Input of General Crystallographic Data - LIST 30</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#list-30">\LIST 30</a></li>
<li class="toctree-l4"><a class="reference internal" href="initial.html#interval">INTERVAL=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initial.html#printing-the-general-information-list-30">Printing the general information, LIST 30</a><ul>
<li class="toctree-l4"><a class="reference internal" href="initial.html#print-30">\PRINT 30</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reflectiondata.html">Reflection Data Input</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#scope-of-the-reflection-data-input-section-of-the-reference-manual">Scope of the Reflection Data Input section of the Reference Manual</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#reflection-data">Reflection Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#simple-input-of-f-or-fsq-data-list-6">Simple input of F or Fsq data - LIST 6</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#creation-of-list-7-from-list-6-copy-6-7">Creation of LIST 7 from LIST 6 - COPY 6 7</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#printing-list-6">Printing LIST 6</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#print-6-mode">\PRINT 6 mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#punching-list-6">Punching LIST 6</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#punch-6-mode">\PUNCH 6 mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#advanced-input-of-f-or-fsq-data-list-6">Advanced input of F or Fsq data - LIST 6</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#reflection-parameter-coefficients">Reflection Parameter Coefficients</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#special-reflection-storage">Special Reflection storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#recognised-reflection-coefficients">Recognised reflection coefficients</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#storage-of-reflection-data">Storage of reflection data</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#compressed-reflection-data">Compressed reflection data</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#intensity-data-hkli">Intensity Data - HKLI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#hkli">\HKLI</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#intensity-decay-curves-list-27">Intensity Decay Curves  \LIST 27</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#list-27">\LIST 27</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#printing-the-decay-curve">Printing the decay curve</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#print-27">\PRINT 27</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#data-reduction-lp">Data Reduction - Lp</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#lp">\LP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#systematic-absence-removal-systematic">Systematic absence removal - \SYSTEMATIC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#id1">\SYSTEMATIC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#sorting-of-the-reflection-data-sort">Sorting of the reflection data  -  \SORT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#id2">\SORT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#merging-equivalent-reflections-merge">Merging equivalent reflections  -  \MERGE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#weighting-schemes-for-the-data-merge">WEIGHTING SCHEMES FOR THE DATA MERGE</a></li>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#standard-deviations-produced-by-the-merge">Standard deviations produced by the merge</a></li>
<li class="toctree-l4"><a class="reference internal" href="reflectiondata.html#merge">\MERGE</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#theta-dependent-absorption-correction-thetabs">Theta-dependent Absorption Correction  -  \THETABS</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#wilson-plot-wilson">WILSON PLOT  -  \WILSON</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#thlim-thlim">THLIM  -  \THLIM</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflectiondata.html#sigmadist-sigmadist">SIGMADIST  -  \SIGMADIST</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Atomic And Structural Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#scope-of-the-atomic-and-structural-parameters-section">Scope of the atomic and structural parameters Section</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#specifications-of-atoms-and-other-parameters">Specifications of atoms and other parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#atom-specification">ATOM SPECIFICATION</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#atomic-parameter-specification">ATOMIC PARAMETER SPECIFICATION</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#overall-parameter-specification">OVERALL PARAMETER SPECIFICATION</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#input-of-atoms-and-other-parameters-list-5">Input of atoms and other parameters  -  LIST 5</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#list-5">\LIST 5</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#further-examples-of-parameter-input">Further examples of parameter input</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#printing-and-punching-list-5">Printing and punching list 5</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#print-5">\PRINT 5</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#punch-5-mode">\PUNCH 5 mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#summary-display-of-list-5-display">Summary display of LIST 5 - \DISPLAY</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#display-level">\DISPLAY    LEVEL=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#editing-structural-parameters-edit">Editing structural parameters -  \EDIT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#edit-inputlist-outputlist">\EDIT INPUTLIST OUTPUTLIST</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#reorganisation-of-lists-5-and-10-regroup">Reorganisation of lists 5 and 10  -  \REGROUP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#regroup-inputlist-outputlist">\REGROUP INPUTLIST= OUTPUTLIST=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#repositioning-of-atoms-collect">Repositioning of atoms  -  \COLLECT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#collect-inputlist-outputlist">\COLLECT INPUTLIST= OUTPUTLIST=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#shifting-the-molecule-to-a-permitted-alternative-origin-origin">Shifting the molecule to a permitted alternative origin - \ORIGIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#origin-inputlist-outputlist-mode">\ORIGIN INPUTLIST= OUTPUTLIST= MODE=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#conversion-of-temperature-factors-convert">Conversion of temperature factors - \CONVERT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#convert-inputlist-outputlist-crossterms">\CONVERT INPUTLIST= OUTPUTLIST= CROSSTERMS=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#hydrogen-placing-hydrogens">Hydrogen placing - \HYDROGENS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#hydrogens-inputlist-outputlist">\HYDROGENS INPUTLIST= OUTPUTLIST=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#perhydrogenation-perhydro">Perhydrogenation - \PERHYDRO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#perhydro-inputlist-outputlist">\PERHYDRO INPUTLIST= OUTPUTLIST=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#hydrogen-re-numbering-hname">Hydrogen re-numbering - \HNAME</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#regularisation-of-atomic-groups-regularise">Regularisation of atomic groups - \REGULARISE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#input-for-regularise">Input for REGULARISE</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#output-from-regularise">Output from REGULARISE</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#method-of-calculation">Method of calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#regularise-mode">\REGULARISE    MODE</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#uses-of-regularise">Uses of \REGULARISE</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#map-two-atomic-groups-together-match">Map two atomic groups together - \MATCH</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#calculation-of-interatomic-bonds-bondcalc">Calculation of interatomic bonds - \BONDCALC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#id1">Method of calculation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#bonding-information-list-40">Bonding information - \LIST 40</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#bonding-information-bonding">Bonding information - \BONDING</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#printing-of-list-40">Printing of LIST 40</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#print-40">\PRINT 40</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#summary-40">\SUMMARY 40</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#punch-40">\PUNCH 40</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#punch-40-b">\PUNCH 40 B</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#creating-a-null-list-40">Creating a null LIST 40</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#printing-of-list-41">Printing of LIST 41</a><ul>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#print-41">\PRINT 41</a></li>
<li class="toctree-l4"><a class="reference internal" href="parameters.html#summary-41">\SUMMARY 41</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Structure Factors And Least Squares</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scope-of-the-structure-factors-and-least-squares-section">Scope of the structure factors and least squares section</a></li>
<li class="toctree-l3"><a class="reference internal" href="#refinement">Refinement</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#correlations-in-refinement">Correlations in Refinement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#f-or-fsq-refinement">F or Fsq refinement?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hydrogen-atom-refinement">Hydrogen Atom Refinement</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#special-positions">Special positions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#atomic-parameter-refinement">Atomic parameter refinement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#overall-parameter-refinement">Overall parameter refinement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scale-factor-definitions">Scale factor definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-factor-calculation-control-list-list-23">Structure factor calculation control list  -  LIST 23</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#list-23">\LIST 23</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#printing-the-slfs-control-list">Printing the SLFS control list</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#print-23">\PRINT 23</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#special-position-constraints-special">Special position constraints - \SPECIAL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#special-action-update-tolerance">\SPECIAL  ACTION= UPDATE= TOLERANCE=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#printing-the-special-position-information">Printing the special position information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#refinement-directives-list-12">Refinement directives  -  LIST 12</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#list-12">\LIST 12</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#obsolete-refinement-directives">Obsolete Refinement directives</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-the-least-squares-matrix">Defining the least squares matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#printing-of-list-12">Printing of LIST 12</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#print-12">\PRINT 12</a></li>
<li class="toctree-l4"><a class="reference internal" href="#summary-12">\SUMMARY 12</a></li>
<li class="toctree-l4"><a class="reference internal" href="#punch-12">\PUNCH 12</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-null-list-12">Creating a null LIST 12</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#clear-12">\CLEAR 12</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#processing-of-list-12">Processing of LIST 12</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#list-22">\LIST 22</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#restraints-list-16">Restraints  -  LIST 16</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameter-atom-bond-and-angle-specifications">Parameter, atom, bond and angle specifications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#list-16">\LIST 16</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#general-restraints">General restraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">General restraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-restraints">Debugging restraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#printing-the-contents-of-list-16">Printing the contents of LIST 16</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#print-16">\PRINT 16</a></li>
<li class="toctree-l4"><a class="reference internal" href="#summary-list-16">\SUMMARY LIST 16</a></li>
<li class="toctree-l4"><a class="reference internal" href="#punch-16">\PUNCH 16</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-null-list-16">Creating a null LIST 16</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#clear-16">\CLEAR 16</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-special-restraints-list-17">The special restraints  -  LIST 17</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#list-17">\LIST 17</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#printing-and-punching-list-17">Printing and punching LIST 17</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#print-17">\PRINT 17</a></li>
<li class="toctree-l4"><a class="reference internal" href="#summary-list-17">\SUMMARY LIST 17</a></li>
<li class="toctree-l4"><a class="reference internal" href="#punch-17">\PUNCH 17</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-null-list-17">Creating a null LIST 17</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#clear-17">\CLEAR 17</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#checking-restraints-check">Checking restraints - CHECK</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#check-level">\CHECK LEVEL=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#weighting-schemes-for-refinement-list-4">Weighting schemes for refinement-  LIST 4</a></li>
<li class="toctree-l3"><a class="reference internal" href="#weighting-for-refinement-against-fo">Weighting for refinement against Fo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#weighting-for-refinement-against-fsq">Weighting for refinement against Fsq</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#list-4">\LIST 4</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#weights-stored-in-list-6">Weights stored in LIST 6</a></li>
<li class="toctree-l3"><a class="reference internal" href="#weighting-schemes">Weighting schemes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dunitz-seiler-weighting-scheme-13">Dunitz Seiler weighting - scheme 13</a></li>
<li class="toctree-l3"><a class="reference internal" href="#chebychev-weighting-schemes-10-11">Chebychev weighting schemes 10, 11</a></li>
<li class="toctree-l3"><a class="reference internal" href="#robust-resistant-weighting-schemes-14-15">Robust-resistant weighting schemes 14, 15</a></li>
<li class="toctree-l3"><a class="reference internal" href="#statistical-weights-16">Statistical Weights, 16</a></li>
<li class="toctree-l3"><a class="reference internal" href="#auto-statistical-weights-17">Auto-Statistical Weights, 17</a></li>
<li class="toctree-l3"><a class="reference internal" href="#printing-list-4">Printing LIST 4</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#print-4">\PRINT 4</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#weighting-the-reflections-weight">Weighting the reflections - WEIGHT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#weight-input-factor">\WEIGHT INPUT= FACTOR=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#reflection-restriction-list-list-28">Reflection restriction list  -  LIST 28</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#list-28">\LIST 28</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-null-list-28">Creating a null LIST 28</a></li>
<li class="toctree-l3"><a class="reference internal" href="#printing-the-contents-of-list-28">Printing the contents of LIST 28</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#print-28">\PRINT 28</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#structure-factor-least-squares-calculations-sfls">Structure Factor Least Squares Calculations  -  \SFLS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#definitions">Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unstable-refinements">Unstable refinements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sorting-of-list-6-for-structure-factor-calculations">Sorting of LIST 6 for structure factor calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">\SFLS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#processing-of-the-refinement-directives">Processing of the refinement directives</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-of-residuals-analyse">Analysis of residuals -  \ANALYSE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#analyse-input">\ANALYSE INPUT=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#least-squares-absorption-correction-difabs">Least squares absorption correction  - \DIFABS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#difabs-action-mode-input">\DIFABS  ACTION= MODE= INPUT=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#internal-workings">Internal workings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parameter-esds-list-9">Parameter esds - LIST 9</a></li>
<li class="toctree-l4"><a class="reference internal" href="#refinement-parameter-map-list-22">Refinement parameter map  -  LIST 22</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-least-squares-matrix-list-11">The least squares matrix  -  LIST 11</a></li>
<li class="toctree-l4"><a class="reference internal" href="#printing-the-contents-of-list-11">Printing the contents of LIST 11</a></li>
<li class="toctree-l4"><a class="reference internal" href="#least-squares-shift-list-list-24">Least squares shift list  -  LIST 24</a></li>
<li class="toctree-l4"><a class="reference internal" href="#restraints-in-internal-format-list-26">Restraints in internal format  -  LIST 26</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="fourier.html">Fourier Routines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="fourier.html#scope-of-the-fourier-section-of-the-user-guide">Scope of the Fourier section of the user guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="fourier.html#input-of-the-fourier-section-limits-list-14">Input of the Fourier section limits - LIST 14</a><ul>
<li class="toctree-l4"><a class="reference internal" href="fourier.html#list-14">\LIST 14</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="fourier.html#printing-the-contents-of-list-14">Printing the contents of LIST 14</a><ul>
<li class="toctree-l4"><a class="reference internal" href="fourier.html#print-14">\PRINT 14</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="fourier.html#compute-fourier-limits-from-the-symmetry">Compute Fourier limits from the symmetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="fourier.html#fourier-calculations-fourier">Fourier calculations  -  \FOURIER</a><ul>
<li class="toctree-l4"><a class="reference internal" href="fourier.html#fourier-input">\FOURIER INPUT=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="fourier.html#calculation-of-superposition-minimum-functions">Calculation of superposition minimum functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="fourier.html#processing-of-the-peaks-list-list-10">Processing of the peaks list  -  LIST 10</a></li>
<li class="toctree-l3"><a class="reference internal" href="fourier.html#printing-the-contents-of-list-10">Printing the contents of LIST 10</a><ul>
<li class="toctree-l4"><a class="reference internal" href="fourier.html#print-10">\PRINT 10</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="fourier.html#elimination-of-duplicated-entries-in-lists-5-and-10-peaks">Elimination of duplicated entries in LISTS 5 and 10  -  \PEAKS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="fourier.html#peaks-inputlist-outputlist">\PEAKS INPUTLIST= OUTPUTLIST=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="fourier.html#slant-fourier-calculations-slant">Slant fourier calculations  -  \SLANT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="fourier.html#slant-input">\SLANT INPUT=</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="analysis.html">Analysis Of Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#scope-of-this-section-of-the-user-guide">Scope of this section of the user guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#analysis-of-residuals-analyse">Analysis of residuals - \ANALYSE</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#create-esd-list-esd">Create esd list - \ESD</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#output-vcv-matrix-of-selected-atoms">Output VcV matrix of selected atoms</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#distance-angles-calculations-distances">Distance angles calculations  -  \DISTANCES</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#distances-inputlist">\DISTANCES INPUTLIST=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#distance-angles-symmetry-operations">Distance-angles symmetry operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#void-location-voids">Void Location  -  \VOIDS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#voids-inputlist">\VOIDS INPUTLIST=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#tls-analysis-best-planes-and-lines-geometry">TLS analysis, best planes and lines  -  \GEOMETRY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#geometry-inputlist">\GEOMETRY INPUTLIST=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#torsion-angles-torsion">Torsion angles  -  \TORSION</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#torsion-inputlist">\TORSION INPUTLIST=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#absolute-configuration-ton">Absolute Configuration  -  \TON</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#ton">\TON</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#publication-listing-of-the-atomic-parameters-parameters">Publication listing of the atomic parameters  -  \PARAMETERS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#parameters">\PARAMETERS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#publication-listing-of-reflection-data-reflections">Publication listing of reflection data  - \REFLECTIONS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#reflections-input">\REFLECTIONS INPUT=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#summary-of-data-lists-summary">Summary of data lists - \SUMMARY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#summary-of-type-level">\SUMMARY OF= TYPE= LEVEL=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#estimation-of-absolute-configuration-tonspek">Estimation of Absolute configuration - \TONSPEK</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#tonspek-input-type-plot-punch-filter1-filter5-weight">\TONSPEK INPUT= TYPE= PLOT= PUNCH= FILTER1= … FILTER5= WEIGHT=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#cif-lists-cif">CIF lists - \CIF</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#cif">\CIF</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#adding-archive-files-addarc">Adding Archive files - ADDARC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#addarc-filename">ADDARC filename</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#graphics-cameron">Graphics - CAMERON</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#cameron">CAMERON</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="twin.html">Twinned Crystals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="twin.html#twinning-introduction">Twinning - introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="twin.html#tlqs-twins">TLQS twins</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#tls-twins">TLS twins</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="twin.html#twinning-problems">Twinning Problems</a><ul>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twinning-initial-clues">Twinning - Initial clues</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twinning-data-collection-and-processing">Twinning - Data collection and processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twinning-structure-solution">Twinning - Structure solution</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twinning-structure-refinement">Twinning - Structure Refinement</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twin-data-stored-by-crystals">Twin Data stored by CRYSTALS</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twinning-lists-affected">Twinning - LISTS affected</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twin-list-5">Twin List 5</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twin-list-6">Twin List 6</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twin-list-13">TWIN LIST 13</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twin-list-12">Twin List 12</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twin-list-16">Twin List 16</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="twin.html#sorting-twinned-structure-data-reorder">SORTING TWINNED STRUCTURE DATA  -  \REORDER</a><ul>
<li class="toctree-l4"><a class="reference internal" href="twin.html#reorder">\REORDER</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twins-backward-compatability">Twins - backward compatability</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twins-worked-example">Twins - Worked Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="twin.html#twinning-mathematical-aspects">Twinning - Mathematical aspects</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="matrix.html">Matrix Calculations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="matrix.html#the-basic-matrix-calculator-matrix">The Basic Matrix Calculator \MATRIX</a><ul>
<li class="toctree-l4"><a class="reference internal" href="matrix.html#matrix">\MATRIX</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="obsolete.html">Obsolete Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="obsolete.html#index-0">Obsolete Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="obsolete.html#least-squares-best-planes-and-lines-molax">Least squares best planes and lines  -  \MOLAX</a><ul>
<li class="toctree-l4"><a class="reference internal" href="obsolete.html#molax-inputlist">\MOLAX INPUTLIST=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="obsolete.html#thermal-displacement-parameter-analysis-aniso">Thermal displacement parameter analysis  -  \ANISO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="obsolete.html#aniso-inputlist">\ANISO INPUTLIST</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="obsolete.html#principal-atomic-displacement-directions-axes">Principal atomic displacement directions  -  \AXES</a><ul>
<li class="toctree-l4"><a class="reference internal" href="obsolete.html#axes-inputlist">\AXES INPUTLIST=</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="obsolete.html#structure-factors-for-a-group-of-trial-models-trial">Structure factors for a group of trial models  -  \TRIAL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="obsolete.html#trial">\TRIAL</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="secret.html">Secret Lists</a><ul>
<li class="toctree-l3"><a class="reference internal" href="secret.html#index-0">Secret LISTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="secret.html#storage-of-intermediate-results-and-the-status-of-a-refinement-list-39">Storage of intermediate results and the status of a refinement -  LIST 39</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cameron.html">Cameron Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#how-to-control-the-program">HOW TO CONTROL THE PROGRAM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#command-groups">Command Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#error-handling">ERROR HANDLING</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#abandon">Abandon</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#edit">Edit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#help">Help</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#the-help-facility">The HELP facility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#mouse-activation">Mouse Activation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#general-input-syntax">General Input Syntax</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#how-to-get-started">How To Get Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#data-input">Data Input</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#input-of-crystals-list-5-files">Input of CRYSTALS List 5 files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#input">INPUT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#outputting-data">Outputting Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#output">OUTPUT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#editing-the-atom-list">Editing The Atom List</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#rename">RENAME</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#retype">RETYPE</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#obeying-files">Obeying Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#obey">OBEY</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#archiving-and-retrieving-views">Archiving And Retrieving Views</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#archive">ARCHIVE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#retrieve">RETRIEVE</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#graphical-output-devices">Graphical Output Devices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#screen">SCREEN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#hardcopy">HARDCOPY</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#view-direction-control">View Direction Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#basic-control">BASIC CONTROL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#xrot">XROT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#yrot">YROT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#zrot">ZROT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#rot">ROT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#cursor">CURSOR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#orientation-commands">ORIENTATION COMMANDS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#plane">PLANE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#face">FACE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#along">ALONG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#vertical">VERTICAL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#horizontal">HORIZONTAL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#bisect">BISECT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#other-related-commands">Other related commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#view">VIEW</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#copy">COPY</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#matrix">MATRIX</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#stereo">STEREO</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#nostereo">NOSTEREO</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#photographs">PHOTOGRAPHS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#photo">PHOTO</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#include-and-exclude">Include And Exclude</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#include">INCLUDE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#exclude">EXCLUDE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#further-related-commands">Further related commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#mask">MASK</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#unmask">UNMASK</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#switch">SWITCH</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#generation-of-dummy-atoms">Generation of Dummy atoms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#dummy">DUMMY</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#drawing-style-control">Drawing Style Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#line">LINE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#ball">BALL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#ellipse">ELLIPSE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#all">ALL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#fragment">FRAGMENT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#group">GROUP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#line-commands">LINE commands.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#ball-commands">BALL commands.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#ellipse-commands">ELLIPSE commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#connectivity-control">Connectivity Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#connect">CONNECT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#id1">CONNECT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#join">JOIN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#remove">REMOVE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#disconnect">DISCONNECT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#miscellaneous-connect-commands">Miscellaneous CONNECT commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#taper">TAPER</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#thickness">THICKNESS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#tolerance">TOLERANCE</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#control-of-colour">Control Of Colour</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#colour">COLOUR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#id2">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#atom-labelling">Atom Labelling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#label">LABEL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#nolabel">NOLABEL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#font">FONT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#text">TEXT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#other-picture-controlling-commands">Other Picture Controlling Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#maximise">MAXIMISE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#scale">SCALE</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#symmetry-input">Symmetry Input</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#input-of-symmetry-operators">Input of symmetry operators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#spacegroup">SPACEGROUP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#symmetry">SYMMETRY</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#example-of-space-group-input">Example of Space Group Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#other-symmetry-related-operations">Other symmetry related operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#setunit">SETUNIT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#enantio">ENANTIO</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#special">SPECIAL</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#crystal-packing-commands">Crystal Packing Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#pack">PACK</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#cell">CELL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#window">WINDOW</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#dealing-with-connectivity">Dealing with connectivity</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#intra">INTRA</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#inter">INTER</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#keep">KEEP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#id3">INTRA</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#id4">INTER</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#id5">KEEP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#examples">EXAMPLES</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#enclosure">ENCLOSURE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#choice-of-enclosure-origin">Choice of enclosure “origin”</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#atom">ATOM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#point">POINT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#type-of-volume-to-be-used">Type of volume to be used</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#sphere">SPHERE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#anorthic">ANORTHIC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#orthogonal">ORTHOGONAL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#id6">EXAMPLE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#packing-more-complicated-structures">PACKING MORE COMPLICATED STRUCTURES</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#id7">GROUP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#unpack">UNPACK</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#add-and-move-further-symmetry-related-commands">Add And Move - Further Symmetry Related Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#add">ADD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#atoms">ATOMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#id8">ALL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#initial">INITIAL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#id9">GROUP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#id10">EXAMPLES</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#move">MOVE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#id11">ATOMS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#id12">ALL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#id13">GROUP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#id14">INITIAL</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#distance-and-angle-calculations">Distance And Angle Calculations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#distance">DISTANCE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#method-of-calculation">Method of Calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#angle">ANGLE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cameron.html#torsion">TORSION</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#information-on-data-held-within-the-program">Information On Data Held Within The Program</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#information">INFORMATION</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#group-definitions">Group Definitions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#defgroup">DEFGROUP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#id15">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#miscellaneous-commands">Miscellaneous Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#reset">RESET</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#log">LOG</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#id16">EDIT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#menus">MENUS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#issue">ISSUE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#print">PRINT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#how-to-stop-the-program">How To Stop The Program</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cameron.html#end">END</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#menu-definition-file">Menu Definition File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cameron.html#some-useful-ideas">Some Useful Ideas</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CRYSTALS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../crystalsmanual.html">Crystals Reference Manual</a></li>
      <li class="breadcrumb-item active">Structure Factors And Least Squares</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/crystals/sfls.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="toctree-wrapper compound">
</div>
<section id="structure-factors-and-least-squares">
<h1>Structure Factors And Least Squares<a class="headerlink" href="#structure-factors-and-least-squares" title="Link to this heading"></a></h1>
<section id="scope-of-the-structure-factors-and-least-squares-section">
<span id="sfandls"></span><h2>Scope of the structure factors and least squares section<a class="headerlink" href="#scope-of-the-structure-factors-and-least-squares-section" title="Link to this heading"></a></h2>
<p>This section describes the necessary LISTS and explains how structure factor
calculation and
least squares refinement can be carried out.</p>
<p>Refinement</p>
<p>LIST 23 - Structure factor calculation control list (<a class="reference internal" href="#list23"><span class="std std-ref">Structure factor calculation control list  -  LIST 23</span></a>)</p>
<p>SPECIAL - Special positions constraints (<a class="reference internal" href="#special"><span class="std std-ref">Special position constraints - \SPECIAL</span></a>)</p>
<p>LIST 12 - Input of refinement directives (<a class="reference internal" href="#list12"><span class="std std-ref">Refinement directives  -  LIST 12</span></a>)</p>
<p>LIST 16 - Input of the restraints (<a class="reference internal" href="#list16"><span class="std std-ref">Restraints  -  LIST 16</span></a>)</p>
<p>LIST 4 - Weighting the reflections (<a class="reference internal" href="#list04"><span class="std std-ref">Weighting schemes for refinement-  LIST 4</span></a>)</p>
<p>LIST 28 - Reflection restriction list (<a class="reference internal" href="#list28"><span class="std std-ref">Reflection restriction list  -  LIST 28</span></a>)</p>
<p>CHECK - Checking the refinement and restraint directives</p>
<p>SFLS - Structure factor least squares calculations (<a class="reference internal" href="#sfls"><span class="std std-ref">Structure Factor Least Squares Calculations  -  \SFLS</span></a>)</p>
<p>ESD - Creates an esd list, LIST 9 (<a class="reference internal" href="#list9"><span class="std std-ref">Parameter esds - LIST 9</span></a>)</p>
<p>ANALYSE - Systematic comparisons of Fo and Fc</p>
<p>DIFABS - Least squares absorption correction</p>
<p>Internal workings</p>
<p>LIST  9 - Parameter esds (<a class="reference internal" href="#list9"><span class="std std-ref">Parameter esds - LIST 9</span></a>)</p>
<p>LIST 22 - Refinement parameter map (<a class="reference internal" href="#list22"><span class="std std-ref">Refinement parameter map  -  LIST 22</span></a>)</p>
<p>LIST 17 - Input of the special restraints (<a class="reference internal" href="#list17"><span class="std std-ref">The special restraints  -  LIST 17</span></a>)</p>
<p>LIST 11 - The least squares matrix (<a class="reference internal" href="#list11"><span class="std std-ref">The least squares matrix  -  LIST 11</span></a>)</p>
<p>LIST 24 - The least squares shift list (<a class="reference internal" href="#list24"><span class="std std-ref">Least squares shift list  -  LIST 24</span></a>)</p>
<p>LIST 26 - Restraints in internal format (<a class="reference internal" href="#list26"><span class="std std-ref">Restraints in internal format  -  LIST 26</span></a>)</p>
</section>
<section id="refinement">
<span id="index-0"></span><h2>Refinement<a class="headerlink" href="#refinement" title="Link to this heading"></a></h2>
<p>Before a stucture factor-least squares calculation is performed, the
following lists must exist in the .DSC file</p>
<p>LIST  1  Cell parameters (section <a class="reference internal" href="initial.html#list01"><span class="std std-ref">Input of the cell parameters  -  LIST 1</span></a>)</p>
<p>LIST  2  Symmetry inforamation (section <a class="reference internal" href="initial.html#list02"><span class="std std-ref">Input of the symmetry data  -  LIST 2</span></a>)</p>
<p>LIST  3  Scattering factors (section <a class="reference internal" href="initial.html#list03"><span class="std std-ref">Input of the atomic scattering factors  -  \LIST 3</span></a>)</p>
<p>LIST  4  Weighting scheme</p>
<p>LIST  5  Atomic and other model parameters (section <a class="reference internal" href="parameters.html#list05"><span class="std std-ref">Input of atoms and other parameters  -  LIST 5</span></a>)</p>
<p>LIST  6  Reflection data (section <a class="reference internal" href="parameters.html#list05"><span class="std std-ref">Input of atoms and other parameters  -  LIST 5</span></a>)</p>
<p>LIST 12  Refinement definitions (section <a class="reference internal" href="#list12"><span class="std std-ref">Refinement directives  -  LIST 12</span></a>)</p>
<p>LIST 16  Restraints (section <a class="reference internal" href="#list16"><span class="std std-ref">Restraints  -  LIST 16</span></a>)</p>
<p>LIST 17  Special position restraints (section <a class="reference internal" href="#list17"><span class="std std-ref">The special restraints  -  LIST 17</span></a>)</p>
<p>LIST 18  SMILES string (section <a class="reference internal" href="initial.html#list18"><span class="std std-ref">Input of Structural Formula as a SMILES string - LIST 18</span></a>)</p>
<p>LIST 23  Structure factor control list (section <a class="reference internal" href="#list23"><span class="std std-ref">Structure factor calculation control list  -  LIST 23</span></a>)</p>
<p>LIST 25  Twin laws, only for twinned refinements (section <a class="reference internal" href="twin.html#list25"><span class="std std-ref">Twinning - introduction</span></a>)</p>
<p>LIST 28  Reflection control list (section <a class="reference internal" href="#list28"><span class="std std-ref">Reflection restriction list  -  LIST 28</span></a>)</p>
<p>LISTS 12,16 and 17 (constraints <a class="reference internal" href="#list12"><span class="std std-ref">Refinement directives  -  LIST 12</span></a>, restraints
<a class="reference internal" href="#list16"><span class="std std-ref">Restraints  -  LIST 16</span></a> and special restraints  <a class="reference internal" href="#list17"><span class="std std-ref">The special restraints  -  LIST 17</span></a>)
are not required if structure factors
are only going to be calculated.</p>
<p>The refinement directives specify which model
parameters are to be refined, and the control directives control the
terms in the minimisation function.</p>
<p>During structure factor least squares calculations,
the partial derivatives with respect to each of the parameters is
calculated for each structure factor and added into the ‘normal
equations’.
This system of equations may be represented in matrix notation as :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">b</span>
<span class="n">WHERE</span> <span class="p">:</span>
<span class="n">A</span>      <span class="s1">&#39;A&#39;</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">symmetric</span> <span class="n">n</span><span class="o">*</span><span class="n">n</span> <span class="n">matrix</span><span class="o">.</span> <span class="n">an</span> <span class="n">element</span>
       <span class="s1">&#39;A(i,j)&#39;</span> <span class="n">of</span> <span class="s1">&#39;A&#39;</span><span class="ow">is</span> <span class="n">given</span> <span class="n">by</span> <span class="p">:</span>
        <span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">Sum</span> <span class="p">[</span> <span class="n">w</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">]</span> <span class="n">over</span> <span class="n">k</span><span class="o">.</span>
<span class="n">n</span>       <span class="n">number</span> <span class="n">of</span> <span class="n">parameters</span> <span class="n">being</span> <span class="n">refined</span><span class="o">.</span>
<span class="n">k</span>       <span class="n">indicates</span> <span class="n">reflection</span> <span class="n">number</span> <span class="s1">&#39;k&#39;</span><span class="o">.</span>
<span class="n">w</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>    <span class="n">weight</span> <span class="n">of</span> <span class="n">reflection</span> <span class="n">k</span><span class="o">.</span>
<span class="n">Q</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>  <span class="n">the</span> <span class="n">partial</span> <span class="n">differential</span> <span class="n">of</span> <span class="n">Fc</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">with</span>
        <span class="n">respect</span> <span class="n">to</span> <span class="n">parameter</span> <span class="n">i</span><span class="o">.</span>
<span class="n">x</span>       <span class="n">a</span> <span class="n">column</span> <span class="n">vector</span> <span class="n">of</span> <span class="n">order</span> <span class="n">n</span><span class="p">,</span> <span class="n">containing</span>
        <span class="n">the</span> <span class="n">shifts</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">parameters</span><span class="o">.</span>
<span class="n">b</span>       <span class="n">also</span> <span class="n">a</span> <span class="n">column</span> <span class="n">vector</span><span class="p">,</span> <span class="n">an</span> <span class="n">element</span>
        <span class="n">of</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">given</span> <span class="n">by</span> <span class="p">:</span>
        <span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Sum</span> <span class="p">[</span> <span class="n">w</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">DF</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">]</span> <span class="n">over</span> <span class="n">k</span><span class="o">.</span>
<span class="n">DF</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>   <span class="n">delta</span> <span class="k">for</span> <span class="n">reflection</span> <span class="n">k</span><span class="p">,</span> <span class="n">given</span> <span class="n">by</span> <span class="p">:</span>
        <span class="n">DF</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="n">Fo</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fc</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
</pre></div>
</div>
<p>As the matrix  A  is symmetric, only (n(n+1))/2 of its elements
need to be calculated and stored, together with a few house keeping items.</p>
<p>In some cases, because of either storage or time considerations,
it is impractical to use the full normal matrix  A .
In this situation, it is necessary to use a ‘block diagonal approximation’
to the full matrix, in which interactions between parameters which are known
not to be highly correlated are ignored.
The effect of ignoring such interactions is to leave blank areas of
the full matrix, related symmetrically across the diagonal, which
do not need to be stored or accumulated.
A common (but not very efficient or stable)
example of this approach is to place one atom in each of the blocks
used to approximate the normal matrix, so that each block is of order
either 4 (x, y, z and u[iso]) or 9 (x, y, z and the anisotropic
thermal parameters).</p>
<p>One of the main purposes of the refinement directives is to
describe the areas of the matrix  A  that are to be calculated.
If the matrix  A  is approximated by  m  blocks of order
n(1), n(2),…..n(m),
The total amount of memory needed to hold the matrix
and vector is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="n">Elements</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="n">Sum</span> <span class="n">n</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">5</span> <span class="o">+</span><span class="n">n</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>

                                                <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">m</span>

     <span class="n">Currently</span> <span class="p">(</span><span class="n">June</span> <span class="mi">2003</span><span class="p">)</span> <span class="n">elements</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="mi">388</span><span class="p">,</span><span class="mi">608</span><span class="p">,</span> <span class="n">giving</span> <span class="n">over</span> <span class="mi">4000</span>
<span class="n">parameters</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">single</span> <span class="n">block</span><span class="o">.</span>
</pre></div>
</div>
<p>The formation of the blocks that are to be used to
approximate the normal matrix  A  is controlled in the refinement
directive list by a series of  BLOCK  directives, each of which
contains the coordinates that are to be included in the newly
specified block.
Further control instructions for the current block may appear on
subsequent directives until a new  BLOCK  directive is found, when the formation
of another block with its associated parameters is started.</p>
<p>Two special directives are provided to allow for the most common
cases required, full matrix refinement (a  FULL  directive)
and one atom per block (a  DIAGONAL  directive).
For all these cases only the parameters specified on the control directives
and the following directives are refined.</p>
<section id="correlations-in-refinement">
<h3>Correlations in Refinement<a class="headerlink" href="#correlations-in-refinement" title="Link to this heading"></a></h3>
<p>Highly correleated parameters <strong>MUST</strong> be refined together. Refining
them in different cycles or different blocks will lead to an incorrect
structure.</p>
<p>As a rough guide, the following groups of parameters are in general
highly correlated and should be refined in the same block if possible :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span>  <span class="n">Temperature</span> <span class="n">factors</span><span class="p">,</span> <span class="n">scale</span> <span class="n">factors</span><span class="p">,</span> <span class="n">the</span> <span class="n">extinction</span>
    <span class="n">parameter</span><span class="p">,</span> <span class="n">the</span> <span class="n">polarity</span> <span class="n">parameter</span> <span class="ow">and</span> <span class="n">the</span>
    <span class="n">enantiopole</span> <span class="n">parameter</span><span class="o">.</span>
<span class="mf">2.</span>  <span class="n">Coordinates</span> <span class="n">of</span> <span class="n">bonded</span> <span class="n">atoms</span><span class="o">.</span>
<span class="mf">3.</span>  <span class="n">Non</span><span class="o">-</span><span class="n">orthogonal</span> <span class="n">coordinates</span> <span class="n">of</span> <span class="n">the</span> <span class="n">same</span> <span class="n">atom</span><span class="o">.</span>
<span class="mf">4.</span>  <span class="n">U</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">U</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span> <span class="ow">and</span> <span class="n">U</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">same</span> <span class="n">atom</span><span class="o">.</span>
</pre></div>
</div>
<p>If it is necessary to split the temperature factors and scale
factor into different blocks, their interactions must not be neglected
but must be allowed for by using a ‘dummy overall isotropic temperature
factor’.
In this case, the scale factor and the dummy temperature factor
must be put into a block of order 2 by themselves, and the program
will make the appropriate corrections to all the temperature factors.
This dummy temperature factor should not be confused with the
‘overall temperature factor’ which is a temperature factor that
applies to all the atoms and is therefore just a convenience and requires
no special treatment.</p>
<p>For further details,  Computing Methods in
Crystallography, edited by J. S. Rollett, page 50, and Crystalographic
Computing, ed Ahmed, 1970,  page 174.</p>
<p>Although it is possible to input an overall temperature factor as one
of the overall parameters, it is not possible to use it under all
circumstances. The structure factor routines always take the
temperature factor of an individual atom as the value or values stored
for that atom. If the overall temperature factor is to be refined, the
system will ensure that the current value of the overall temperature
factor is inserted for the temperature factor of all the atoms. When the
new parameters are computed after the solution of the normal equations,
this substitution is again made, so that all the atoms have the same
overall isotropic temperature factor. However, if the overall temperature
factor is not refined, or no refinement is done, the individual temperature
factor for each atom will be used, and the overall temperature factor ignored.</p>
<p><strong>CAUTION</strong></p>
<p>It should be noted that if a set of anisotropic atoms are input with no
U[ISO]  key and  U[ISO]  data, then the default value of 0.05 will be
inserted by the sfls routines. This implies that all such atoms are
isotropic, so that the anisotropic temperature factors will be set to
zero, and the calculation will proceed for isotropic atoms.</p>
</section>
<section id="f-or-fsq-refinement">
<h3>F or Fsq refinement?<a class="headerlink" href="#f-or-fsq-refinement" title="Link to this heading"></a></h3>
<p>Both type of refinement have been available in CRYSTALS since the early
70’s. For most data sets, there is little difference between the two
correclty weighted refinements. One of the current reasons for choosing
Fsq refinement is ‘so that -ve observations may be used’. Such a choice
is based on the misapprehension that the moduli in /Fo/ are the result
of taking the square root of Fsq. In fact, it indicates that the phase
cannot be observed experimentally. The experimental value of Fo takes
the sign of Fsq and the positive square root. With proper weighting,
both refinemets converge to the same minima
(Rollett, J.S., McKinlay,T.G. and Haigh, N.P.,  1976, Crystallographic
Computing Techniques, pp 413-415,  ed F.R.
Ahmed,Munksgaard; and Prince,E. 1994, Mathematical Techniques in
Crystalography and Materials Science, pp 124-125.Springer-Verlag).
However, the path to the
minima will be different, and there is some evidence that Fsq refinement
has less false minima. Using all data, including -ve observations,
increases the observation:variable ratio, but it is not evident that a
large number of essentially unobserved data will improve the refinement.
If the difference between F and Fsq refinement is significant, then the
analysis requires care and attention.</p>
</section>
<section id="hydrogen-atom-refinement">
<h3>Hydrogen Atom Refinement<a class="headerlink" href="#hydrogen-atom-refinement" title="Link to this heading"></a></h3>
<p>Several strategies are available for refining hydrogen atoms.
Which you use is probably a matter of taste.</p>
<p><em>Geometric re-placement</em></p>
<p>The command \HYDROGEN or \PERHYDRO is used to compute geometrically
suitable positions for the H atoms. These are <strong>not</strong> refined (either
they are left out of LIST 12, or a fixed with the FIX directive). After
a few cycles of refinement of the remaining parameters, they are deleted
(\EDIT &lt;cr&gt; SELECT TYPE NE H) and new positions computed. This ensures
optimal geometry, ensures that Fcalc is optimal, but avoids the cost of
including the deviatives in the normal matrix.</p>
<p><em>Riding hydrogens</em></p>
<p>As above, the hydrogens are placed geomtrically, but they are included
in the formation of the least squares matrix. Their derivatives are
added to those of the corresponding carbon, and a composite shift
computed for each carbon and its riding hydrogens. This preserves the
C-H vector, but can distort C-C-H angles. A cycle of refinement takes
almost twice as long as the re-placement method.</p>
<p><em>Restrained hydrogens</em></p>
<p>In this method, starting positions are hound for the hydrogen atoms
(either from Fourier maps of geometrically), and the hydrogen positions
are refined along with other atoms. The C-H distances and C-C-H angles
are restrained to acceptable values in LIST 16. This calculation is even
slower than the riding model, and would normally only be applied to an
atom of special significance ( <em>e.g.</em> a hydrogen bond H atom).</p>
<p><em>Free refinement</em></p>
<p>The hydrogen atom is treated like any other atom. Requires good data,
and may be applied to atoms of special interest.</p>
<p>Note that the different methods can be mixed in any way, with some
hydrogens placed geometrically, and others refined.</p>
<p><strong>R-Factor and minimisation function definitions</strong></p>
<p><strong>Conventional R-value</strong></p>
<p>This is defined as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">Sum</span><span class="p">[</span><span class="o">//</span><span class="n">Fo</span><span class="o">/-/</span><span class="n">Fc</span><span class="o">//</span><span class="p">]</span><span class="o">/</span><span class="n">Sum</span><span class="p">[</span><span class="o">/</span><span class="n">Fo</span><span class="o">/</span><span class="p">]</span>
</pre></div>
</div>
<p>The summation is over all the reflections accepted by LIST 28. This
definition is used for both conventional and F-squared refinement.</p>
<p><strong>Weighted R-value</strong></p>
<p>The Hamilton weighted  R-value  is defined as :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">100</span><span class="o">*</span><span class="n">Sqrt</span><span class="p">(</span><span class="n">Sum</span><span class="p">[</span> <span class="n">w</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="s1">&#39;(i)*D&#39;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">]</span><span class="o">/</span><span class="n">SUM</span><span class="p">[</span> <span class="n">w</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">Fo</span><span class="s1">&#39;(i)*Fo&#39;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">])</span>

<span class="n">D</span><span class="s1">&#39;  = Fo&#39;</span><span class="o">-</span><span class="n">Fc</span><span class="s1">&#39;</span>
<span class="n">Fo</span><span class="s1">&#39; = Fo for normal refinement, Fsq for F-squared refinement.</span>
<span class="n">Fc</span><span class="s1">&#39; = Fc for normal refinement, Fc*Fc for F-squared refinement.</span>
</pre></div>
</div>
<p><em>Minimisation function</em></p>
<p>This is defined by :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MINFUNC</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">[</span> <span class="n">w</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">]</span>

<span class="n">D</span><span class="s1">&#39;, Fo&#39;</span><span class="p">,</span> <span class="n">Fc</span><span class="s1">&#39; defined above.</span>
</pre></div>
</div>
<p><em>Residual</em></p>
<p>The residual and weighted residual are defined by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">residual</span> <span class="o">=</span> <span class="n">Sum</span> <span class="n">D</span><span class="s1">&#39;(i)**2</span>
<span class="n">weighted</span> <span class="n">residual</span> <span class="o">=</span> <span class="n">Sum</span> <span class="n">w</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="s1">&#39;(i)**2</span>
</pre></div>
</div>
</section>
</section>
<section id="special-positions">
<span id="index-1"></span><h2>Special positions<a class="headerlink" href="#special-positions" title="Link to this heading"></a></h2>
<p>The second major purpose of the refinement directives is to
allow for atoms on special positions.
For example, the atom at the Wyckoff site  H  in the space group
P6(3)/mmc (no. 194) has coordinates  X,2X,Z .
In a least squares refinement, the  X  and  Y  coordinates of this atom
must be set to the same variable, i.e. they become equivalent.</p>
<p>The command
\SPECIAL (section <a class="reference internal" href="#special"><span class="std std-ref">Special position constraints - \SPECIAL</span></a>) can be used to generate the necessary
constraints or restraints,
and may be invoked automatically before structure factor calculations
by setting the appropriate parameters in  LIST 23 (structure factor
control settings, see section <a class="reference internal" href="#list23"><span class="std std-ref">Structure factor calculation control list  -  LIST 23</span></a>)</p>
<p>The user can do this manually via  the refinement directives, LIST 12.
The relationship is set up
by an  EQUIVALENCE  directive, which sets all the parameters
on the directive to the same least squares parameter.
In this example, it is also necessary to alter the contribution
of the  Y  coordinates to the normal matrix by multiplying the derivatives
by 2.
This facility is provided by the  WEIGHT  directive, which should not be confused
with the weight ascribed to each reflection in
the refinement.
For a full treatment of atoms on special positions, see
Crystallographic Computing, edited by F. R. Ahmed, page 187,
or Computing Methods in Crystallography, page 51.</p>
<p>Similar relationships also hold for the anisotropic temperature factors.</p>
<p>The relationships between the variable  parameters in a refinement
may also be defined by RESTRAINTS. These are held in LIST 17 (see <a class="reference internal" href="#list17"><span class="std std-ref">The special restraints  -  LIST 17</span></a>),
and are particularly usefull if a complex matrix has been defined (e.g.
using RIDE, LINK, EQUIVALENCE, WEIGHT, BLOCK, GROUP or COMBINE).</p>
</section>
<section id="atomic-parameter-refinement">
<span id="index-2"></span><h2>Atomic parameter refinement<a class="headerlink" href="#atomic-parameter-refinement" title="Link to this heading"></a></h2>
<p>Atomic parameters may be specified in three different ways.
Firstly, there is an  <strong>IMPLICIT</strong>  definition, in which parameters for all the
atoms are specified simply by giving the appropriate key or keys.</p>
<p>Hydrogen atoms are automatically excluded from implicit definitions.</p>
<p>Secondly, there is an  <strong>EXPLICIT</strong>  definition, in which the parameters of one
atom are specified by giving the atom name followed by the appropriate
keys.</p>
<p>Lastly, the parameters for a continuous group of atoms in LIST 5 may be
specified by an UNTIL sequence.
This type of parameter definition is taken to be implicit.</p>
<p><strong>KEY[1] … KEY[K]</strong></p>
<p>parameters defined by the keys KEY[1] . . KEY[K]
are included (or excluded) for all the atoms in LIST 5,
e.g. X U[ISO]  implies that the ‘X’ and ‘U[ISO]’
parameters of all the atoms in the current LIST 5
will be used. This is an <strong>implicit</strong> definition,
since parameters for
all the atoms in LIST 5 are specified simply by
giving the appropiate key.</p>
<p><strong>TYPE(SERIAL,KEY[1], . . ,KEY[K])</strong></p>
<p>parameters defined by the keys KEY[1] … KEY[K]
are included (or excluded) for the atom of type ‘TYPE’ with
the serial number ‘SERIAL’, e.g. C(21,X,U[ISO])
implies that the ‘X’ and ‘U[ISO]’ parameters of
atom C(21) will be used.
This is an  <strong>explicit</strong> definition.</p>
<p><strong>TYPE1(SERIAL1,KEY[1], . ,KEY[K])  UNTIL  TYPE2(SERIAL2)</strong></p>
<p>the parameters defined by the keys KEY[1] . . KEY[K]
are included (or excluded) for atoms in LIST 5 starting at the
atom with type ‘TYPE1’ and serial ‘SERIAL1’, and
finishing with the atom of type ‘TYPE2’ and
serial ‘SERIAL2’.
This definition is <strong>implicit,</strong>
since the number of atoms
included by this definition depends on the number
and order of the atoms in LIST 5.</p>
<p>Parameter definitions of all three types may appear on any directive
in any desired combination.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EXAMPLE</span>
      <span class="n">LIST</span> <span class="mi">5</span> <span class="n">contains</span>  <span class="n">FE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="n">N</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

      \<span class="n">LIST</span> <span class="mi">12</span>
      <span class="n">BLOCK</span> <span class="n">X</span><span class="s1">&#39;S C(1,U[ISO]) UNTIL C(6) FE(1,U&#39;</span><span class="n">S</span><span class="p">)</span>
      <span class="n">END</span>

     <span class="n">This</span> <span class="n">refines</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">u</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">...</span><span class="n">u</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="n">of</span> <span class="n">iron</span><span class="p">,</span> <span class="ow">and</span>
     <span class="n">u</span><span class="p">[</span><span class="n">iso</span><span class="p">]</span> <span class="n">of</span> <span class="n">the</span> <span class="n">other</span> <span class="n">atoms</span><span class="o">.</span>
</pre></div>
</div>
<p>The following parameter keys may be given in an atom
definition :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OCC</span>     <span class="n">X</span>       <span class="n">Y</span>         <span class="n">Z</span>
<span class="n">U</span><span class="p">[</span><span class="n">ISO</span><span class="p">]</span>  <span class="n">SIZE</span>    <span class="n">DECLINAT</span>  <span class="n">AZIMUTH</span>
<span class="n">U</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>   <span class="n">U</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span>   <span class="n">U</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span>     <span class="n">U</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span>    <span class="n">U</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>    <span class="n">U</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>

<span class="n">X</span><span class="s1">&#39;S      Indicating  X,Y,Z</span>
<span class="sa">U</span><span class="s1">&#39;S      Indicating  U[11],U[22],U[33],U[23],U[13],U[12]</span>
<span class="n">UII</span><span class="s1">&#39;S    Indicating  U[11],U[22],U[33]</span>
<span class="n">UIJ</span><span class="s1">&#39;S    Indicating  U[23],U[13],U[12]</span>
</pre></div>
</div>
</section>
<section id="overall-parameter-refinement">
<span id="index-3"></span><h2>Overall parameter refinement<a class="headerlink" href="#overall-parameter-refinement" title="Link to this heading"></a></h2>
<p>Overall parameters, apart from the layer scale factors and the
element scale factors, are specified  simply by their keys.
Such a specification is considered to be an explicit definition.
The following overall parameter keys may be given :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SCALE</span>       <span class="n">OU</span><span class="p">[</span><span class="n">ISO</span><span class="p">]</span>       <span class="n">DU</span><span class="p">[</span><span class="n">ISO</span><span class="p">]</span>
<span class="n">POLARITY</span>    <span class="n">ENANTIO</span>       <span class="n">EXTPARAM</span>
</pre></div>
</div>
</section>
<section id="scale-factor-definitions">
<h2>Scale factor definitions<a class="headerlink" href="#scale-factor-definitions" title="Link to this heading"></a></h2>
<p>The OVERALL scale factor is always applied to the structure factor
calculation, though it need not necessarily be refined.
LAYER and BATCH  scale factors are applied only if indicated in LIST 23
(structure factor control settings, see section <a class="reference internal" href="#list23"><span class="std std-ref">Structure factor calculation control list  -  LIST 23</span></a>),
and ELEMENT scales only if the crystal is marked as being twinned in LIST
13. Note that all of these scale factors can be expected to be correlated
with each other, and the overall parameters.</p>
<p>The layer scale factors, batch scale factors
and the element scale factors may be
given in three different ways, all of which are
considered to be explicit :</p>
<p><strong>LAYER(M), BATCH(M)   OR   ELEMENT(M)</strong></p>
<p>this indicates only scale factor ‘M’ of the specified type.
‘M’ must be in the correct range, which for ‘N’ layer scale factors
is 0 to ‘N-1’, and for ‘N’ element scale factors is
1 to N.</p>
<p><strong>LAYER(P) UNTIL LAYER(Q)   OR   BATCH(P) …..</strong></p>
<p>this indicates all the scale factors of the specified type from
‘P’ to ‘Q’.
‘P’ and ‘Q’ must be in the correct range, as defined for ‘M’
in the previous section.</p>
<p><strong>LAYER SCALES, BATCH SCALES   OR   ELEMENT SCALES</strong></p>
<p>this indicates all the scale factors of the given type.</p>
</section>
<section id="structure-factor-calculation-control-list-list-23">
<span id="list23"></span><span id="index-5"></span><span id="index-4"></span><h2>Structure factor calculation control list  -  LIST 23<a class="headerlink" href="#structure-factor-calculation-control-list-list-23" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">23</span>
<span class="n">MODIFY</span> <span class="n">ANOM</span><span class="o">=</span> <span class="n">EXTINCT</span><span class="o">=</span> <span class="n">LAYERSCALE</span><span class="o">=</span> <span class="n">BATCHSCALE</span><span class="o">=</span> <span class="n">PARTIAL</span><span class="o">=</span> <span class="n">UPDATE</span><span class="o">=</span> <span class="n">ENANTIO</span><span class="o">=</span>
<span class="n">MINIMISE</span> <span class="n">NSINGULARITY</span><span class="o">=</span> <span class="n">F</span><span class="o">-</span><span class="n">SQUARED</span><span class="o">=</span> <span class="n">REFLECTIONS</span><span class="o">=</span> <span class="n">RESTRAIN</span><span class="o">=</span>
<span class="n">REFINE</span>  <span class="n">SPECIAL</span><span class="o">=</span> <span class="n">UPDATE</span><span class="o">=</span> <span class="n">TOLERANCE</span><span class="o">=</span>
<span class="n">ALLCYCLES</span> <span class="n">MIN</span><span class="o">-</span><span class="n">R</span><span class="o">=</span> <span class="n">MAX</span><span class="o">-</span><span class="n">R</span><span class="o">=</span> <span class="o">*-</span><span class="n">WR</span><span class="o">=</span> <span class="o">*-</span><span class="n">SUMSQ</span><span class="o">=</span> <span class="o">*-</span><span class="n">MINFUNC</span><span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">MIN</span><span class="p">]</span><span class="o">=</span>
<span class="n">INTERCYCLE</span> <span class="n">MIN</span><span class="o">-</span><span class="n">DR</span><span class="o">=</span> <span class="n">MAX</span><span class="o">-</span><span class="n">DR</span><span class="o">=</span> <span class="o">*-</span><span class="n">DWR</span><span class="o">=</span> <span class="o">*-</span><span class="n">DSUMSQ</span><span class="o">=</span> <span class="o">*-</span><span class="n">DMINFUNC</span><span class="o">=</span>
<span class="n">END</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">23</span>
<span class="n">MODIFY</span> <span class="n">EXTINCTION</span><span class="o">=</span><span class="n">YES</span><span class="p">,</span> <span class="n">ANOMALOUS</span><span class="o">=</span><span class="n">YES</span>
<span class="n">END</span>
</pre></div>
</div>
<p>This LIST controls the structure factor calculation. The
default calculation involves the minimum of computation (atomic
parameters and overall sale factor).  More extensive calculations have
to be indicated by entries in this list. The presence of a parameter in
the parameter list (LIST 5) does not automatically mean that it will be
included in the structure factor calculation.</p>
<p>This list also controls the treatment of atoms on special positions,
the use of F or Fsq, and the use of restraints.</p>
<p>The presence of information in the DSC file does
not ensure that it will be used by the structure factor
routines. Thus, the operations corresponding to
RESTRAIN ,  ANOMALOUS ,  EXTINCTION ,  PARTIAL ,  BATCHSCALES,
LAYERSCALES and ENANTIO are not performed unless they are explicitly
asked for in a LIST 23.</p>
<section id="list-23">
<h3>\LIST 23<a class="headerlink" href="#list-23" title="Link to this heading"></a></h3>
<p><strong>MODIFY ANOM= EXTINCT= LAYERSCALE= BATCHSCALE= PARTIAL= UPDATE= ENANTIO=</strong></p>
<blockquote>
<div><p>This directive controls modifications that can be applied to Fo
and Fc.</p>
</div></blockquote>
<p><em>ANOMALOUS=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>   <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">YES</span>
</pre></div>
</div>
<p>If  ANOMALOUS  is  YES , the imaginary part of the anomalous dispersion
correction, input in LIST 3 (see section <a class="reference internal" href="initial.html#list03"><span class="std std-ref">Input of the atomic scattering factors  -  \LIST 3</span></a>, will be included in
the s.f.l.s. calculations.
For computational efficiency, it is recommended only to use the value YES
towards the end of a refinement. Note that the value YES should be used
even for centro-symmetric crystals if they contain a heavy atom.</p>
</div></blockquote>
<p><em>EXTINCTION=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>   <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">YES</span>
</pre></div>
</div>
<p>If  EXTINCTION  is  YES , the calculated structure factors are modified
to allow for the effects of extinction by the method of A. C. Larson.
See Atomic and Structural Parameters for the definition.</p>
</div></blockquote>
<p><em>LAYERSCALES=</em></p>
<p><em>BATCHSCALES=</em></p>
<blockquote>
<div><p>SCALE keys have two alternatives:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>   <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">YES</span>
</pre></div>
</div>
<p>If either SCALE key is  YES , the corresponding scale factors stored in
LIST 5 (the model parameters) are
applied to the reflection data. If this parameter is omitted, the
scale factors are not applied, even if they exist in LIST 5</p>
</div></blockquote>
<p><em>PARTIAL=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>   <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">YES</span>
</pre></div>
</div>
<p>If  PARTIAL  is  YES , the fixed partial contributions stored in LIST 6
(section <a class="reference internal" href="reflectiondata.html#list06"><span class="std std-ref">Simple input of F or Fsq data - LIST 6</span></a>) are
added in during the calculation of Fc and the phase.
The partial contributions must already be present in LIST 6, and should
have the keys  A-PART  and  B-PART . The atoms which have contributed to
the partial terms should be omitted from LIST 5 whenever  PARTIAL  is
YES .</p>
</div></blockquote>
<p><em>UPDATE=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>   <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">YES</span>
</pre></div>
</div>
<p>If  UPDATE  is  YES , the contributions of the atoms to  A  and  B  are
output to LIST 6 with the keys  A-PART  and  B-PART . If  UPDATE  is
NO , its default value, the partial contributions are not changed
during structure factor calculations.
This requires that LIST 6 contain the keys A-PART and B-PART.</p>
</div></blockquote>
<p><em>ENANTIO=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>   <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">YES</span>
</pre></div>
</div>
<p>If ENANTIO is YES, then Fc is computed with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Fc</span> <span class="o">=</span> <span class="n">SQRT</span><span class="p">(</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">F</span><span class="p">(</span><span class="o">-</span><span class="n">h</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
</pre></div>
</div>
<p>Where x is the enantiopole parameter from LIST 5. Once the correct
enantiomer has been established, set this parameter back to NO.</p>
</div></blockquote>
<p><strong>MINIMISE= NSINGULARITY= F-SQUARED= REFLECTIONS= RESTRAIN=</strong></p>
<blockquote>
<div><p>This directive controls modifications made to the minimisation
function during s.f.l.s.</p>
</div></blockquote>
<p><em>NSINGULARITY=</em></p>
<blockquote>
<div><p>The default value is zero.
If this parameter is omitted, any singularities  discovered during the
inversion of the normal matrix will cause the program to
terminate after the current cycle of refinement.
If  NSINGULARITY  is greater than zero, it represents the number of
singularities allowed before the program will terminate.</p>
</div></blockquote>
<p><em>F-SQUARED=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>   <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">YES</span>
</pre></div>
</div>
<p>If F-SQUARED is NO, the traditional minimisation function is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Minimisation</span> <span class="n">function</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">[</span> <span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">Fo</span> <span class="o">-</span> <span class="n">Fc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">]</span>
</pre></div>
</div>
<p>If  F-SQUARED  is  YES , the minimisation function is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Minimisation</span> <span class="n">function</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">[</span> <span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">Fo</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Fc</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">]</span>
</pre></div>
</div>
<p>If  F-SQUARED  is  YES , the weights given by  w  in the above expression
are assumed to be on the correct scale and to refer to Fsq
rather than Fo’s. Note that refinement can be against Fo or Fsq independent of
whether the input was Fo or Fsq.</p>
</div></blockquote>
<p><em>REFLECTIONS=</em></p>
<blockquote>
<div><p>REFLECTIONS has two alternatives:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>
<span class="n">YES</span>  <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
</pre></div>
</div>
<p>If REFLECTIONS is YES, the reflections stored in LIST 6 (and subject to the
checks in LIST 28) are used for computing structure factors and the
derivatives added into the matrix if required.</p>
<p>If REFLECTIONS is NO,  LIST 6 is not used, whether it is
present or not. This setting could be used for refinement against restraints
only. See the section DLS, ‘Distance Least Squares’.</p>
</div></blockquote>
<p><em>RESTRAIN=</em></p>
<blockquote>
<div><p>RESTRAIN has two alternatives:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>
<span class="n">YES</span>  <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
</pre></div>
</div>
<p>If  RESTRAIN  is  YES, the restraints in LIST 16 (section <a class="reference internal" href="#list16"><span class="std std-ref">Restraints  -  LIST 16</span></a>)
and LIST 17 (section <a class="reference internal" href="#list17"><span class="std std-ref">The special restraints  -  LIST 17</span></a>)
are added into the normal equations.</p>
</div></blockquote>
<p><strong>REFINE  SPECIAL= UPDATE= TOLERANCE=</strong></p>
<blockquote>
<div><p>This directive controls the  refinement of atoms on special positions
and the control of floating origins.
The default action for atoms is to try to constrain them.
However, if an atom is already the subject of a user defined constraint,
the symmetry requirements are imposed by restraints. The site occupancy,
positional and thermal parameters can be set to satisfy the
site symmetry. The site occupancy is indepentant of any chemical or
physical partial occupancy by an atom.</p>
<p>Floating origins are controlled by
restraining the center of gravity of the structure along the axis to remain
fixed.</p>
</div></blockquote>
<p><em>SPECIAL=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SPECIAL</span> <span class="o">=</span> <span class="n">NO</span>                  <span class="n">No</span> <span class="n">action</span>
        <span class="o">=</span> <span class="n">TEST</span>                <span class="n">Displays</span> <span class="n">but</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">store</span> <span class="nb">any</span> <span class="n">restrictions</span>
        <span class="o">=</span> <span class="n">ORIGIN</span>              <span class="n">Tests</span> <span class="k">for</span> <span class="ow">and</span> <span class="n">restrains</span> <span class="n">floating</span> <span class="n">origins</span>
        <span class="o">=</span> <span class="n">RESTRAIN</span>            <span class="n">Creates</span> <span class="ow">and</span> <span class="n">stores</span> <span class="n">restraints</span>
        <span class="o">=</span> <span class="n">CONSTRAIN</span> <span class="p">(</span><span class="n">Default</span><span class="p">)</span> <span class="n">Attempt</span> <span class="n">to</span> <span class="n">create</span> <span class="n">constraints</span>
</pre></div>
</div>
</div></blockquote>
<p><em>UPDATE=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="o">=</span> <span class="n">NO</span>                    <span class="n">Nothing</span> <span class="n">updated</span>
       <span class="o">=</span> <span class="n">OCCUPATION</span>            <span class="n">Site</span> <span class="n">occupancies</span> <span class="n">modified</span>
       <span class="o">=</span> <span class="n">PARAMETERS</span>  <span class="p">(</span><span class="n">Default</span><span class="p">)</span> <span class="n">All</span> <span class="n">adjustable</span> <span class="n">parameters</span> <span class="n">modified</span>
</pre></div>
</div>
</div></blockquote>
<p><em>REWEIGHT=</em></p>
<blockquote>
<div><p>Not currently used</p>
</div></blockquote>
<p><em>GROUPS=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>  <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">YES</span>
</pre></div>
</div>
<p>GROUPS is automatically set to YES if LIST 12
contains any GROUP directives. It forces the group derivatives
to be recalculated between each cycle or refinement.
Not currently used</p>
</div></blockquote>
<p><em>COMPOSITE=</em></p>
<blockquote>
<div><p>Not currently used</p>
</div></blockquote>
<p><em>TOLERANCE=</em></p>
<blockquote>
<div><p>Atoms within ‘TOLERANCE’ Angstrom of a symmetry equivalent atom are
regarded as being on a special position. The default is 0.6A. For high
symmetry spacegroups with disorder, the value might need reducing if
multiplicities are incorrectly calculated.</p>
</div></blockquote>
<p><strong>ALLCYCLES MIN-R= MAX-R= *-WR= *-SUMSQ= *-MINFUNC= U[MIN]=</strong></p>
<blockquote>
<div><p>This directive controls conditions that must be satisfied after
each cycle if refinement is to continue. It can be used to detect
converged or ‘blown-up’ refinements.
The heading has been abbreviated, the  *  representing  MIN  and  MAX .</p>
</div></blockquote>
<p><em>MIN-R=, MAX-R=</em></p>
<blockquote>
<div><p>The normal  R-value  must lie between  MIN-R  and  MAX-R, otherwise
refinement is terminated after
the current cycle.
The default values for
MIN-R  and  MAX-R  are 0.0 and 100.0 percent.</p>
</div></blockquote>
<p><em>MIN-WR MAX-WR</em></p>
<blockquote>
<div><p>The Hamilton weighted  R-VALUE  must lie between  MIN-WR  and
MAX-WR, otherwise the refinement is
terminated after the current cycle.
The default values for  MIN-WR  and  MAX-WR  are 0.0 and 100.0
percent respectively.</p>
</div></blockquote>
<p><em>MIN-SUMSQ=, MAX-SHUMSQ=</em></p>
<blockquote>
<div><p>The rms (shift/e.s.d.) fo all parameters in the refinement must
lie between  MIN-SUMSQ  and  MAX-SUMSQ, otherwise
the refinement is terminated after the current cycle.
The sum of the squares of the ratios is defined as :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="n">SUMSQ</span> <span class="o">=</span> <span class="n">SQRT</span><span class="p">(</span><span class="n">SIGMA</span><span class="p">(</span><span class="n">SHIFT</span><span class="o">/</span><span class="n">ESD</span><span class="p">))</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
 <span class="n">The</span> <span class="n">default</span> <span class="n">values</span>
<span class="n">of</span>  <span class="n">MIN</span><span class="o">-</span><span class="n">SUMSQ</span>  <span class="ow">and</span>  <span class="n">MAX</span><span class="o">-</span><span class="n">SUMSQ</span>  <span class="n">are</span> <span class="mf">0.03</span> <span class="ow">and</span> <span class="mf">10000.0</span><span class="p">,</span> <span class="o">.</span>
</pre></div>
</div>
</div></blockquote>
<p><em>MIN-MINFUNC= MAX-MINFUNC=</em></p>
<blockquote>
<div><p>The minimisation function, on the scale of Fo, must lie between
MIN-MINFUNC  and  MAX-MINFUNC, otherwise
the refinement is terminated after the current cycle.
The default values of  MIN-MINFUNC  and  MAX-MINFUNC  are 0.0 and
1000000000000000.0.</p>
</div></blockquote>
<p><em>U[MIN]=</em></p>
<blockquote>
<div><p>If Uiso or a principal component of the adp of any atom is
less than   U[MIN] , then a warning is issued and the idp
reset to u[min], or the components of the adp reset to MAX(Uii,U[MIN])
or MAX(Uij,0.01U[min]).
If this parameter
is omitted, a default value of 0.0 is assumed.</p>
</div></blockquote>
<p><strong>INTERCYCLE MIN-DR= MAX-DR= *-DWR= *-DSHIFT/ESD= *-DMINFUNC=</strong></p>
<blockquote>
<div><p>This directive refers to conditions that must be obeyed before the
next cycle of least squares refinement can proceed. (A quantity
undergoes a positive change if  OLD - NEW  is positive, not
NEW - OLD ). The definitions are similar to ALLCYCLES.
The abbreviation  ‘*’  represents  MIN  and  MAX .</p>
</div></blockquote>
<p><em>MIN-DR= MAX-DR=</em></p>
<blockquote>
<div><p>Between two cycles of least squares, the change in
R-VALUE  must lie between  MIN-DR  and  MAX-DR, otherwise
the refinement is terminated.
The default values are -5.0 and 100.0.</p>
</div></blockquote>
<p><em>MIN-DWR MAX-DWR</em></p>
<blockquote>
<div><p>The default values are -5.0 and 100.0.</p>
</div></blockquote>
<p><em>MIN-DSUMSQ MAX-DSUMSQ</em></p>
<blockquote>
<div><p>The default values are -10. and 10000.0.</p>
</div></blockquote>
<p><em>MIN-DMINFUNC MAX-DMINFUNC</em></p>
<blockquote>
<div><p>The default values are 0.0 and 1000000000000000.0.</p>
</div></blockquote>
</section>
</section>
<section id="printing-the-slfs-control-list">
<h2>Printing the SLFS control list<a class="headerlink" href="#printing-the-slfs-control-list" title="Link to this heading"></a></h2>
<section id="print-23">
<h3>\PRINT 23<a class="headerlink" href="#print-23" title="Link to this heading"></a></h3>
<blockquote>
<div><p>This prints LIST 23. There is no command for punching LIST 23.</p>
</div></blockquote>
</section>
</section>
<section id="special-position-constraints-special">
<span id="special"></span><span id="index-6"></span><h2>Special position constraints - \SPECIAL<a class="headerlink" href="#special-position-constraints-special" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">SPECIAL</span>  <span class="n">ACTION</span><span class="o">=</span> <span class="n">UPDATE</span><span class="o">=</span> <span class="n">TOLERANCE</span><span class="o">=</span>
<span class="n">END</span>

\<span class="n">SPECIAL</span>
<span class="n">END</span>
</pre></div>
</div>
<p>\SPECIAL can be issued at any time to get information about atoms on
special positions. However, normally it is called automatically by
setting the SPECIAL keyword in LIST 23 (section <a class="reference internal" href="#list23"><span class="std std-ref">Structure factor calculation control list  -  LIST 23</span></a>).</p>
<p>Atoms on special positions may be constrained through LIST 12
(section <a class="reference internal" href="#list12"><span class="std std-ref">Refinement directives  -  LIST 12</span></a>), or restrained through LIST 17 (section <a class="reference internal" href="#list17"><span class="std std-ref">The special restraints  -  LIST 17</span></a>).
CRYSTALS  will attempt to generate the special position conditions when
requested via the
SPECIAL command, and also  update coordinates of atoms on
special positions.</p>
<p>If the RESTRAIN option is chosen, then the special conditions are imposed
on the refinement by restraints, which are generated without reference to
what is being specified in LIST 12, the refined parameter definition list.</p>
<p>If the CONSTRAIN option is chosen, then CRYSTALS examines the site
restrictions as it processes LIST 12. If an atom on a special position is
being refined without any user defined conditions (EQUIVALENCE, RIDE, LINK,
COMBINE, GROUP, WEIGHT), and the related coordinates are in the same matrix
block, then the internal representation of LIST 12 (LIST 22)
is dynamically modified to include the necessary
constraints. If the atom is already the
object of a constraint,
then LIST 12 cannot safely be modified, and the special condition
is applied as a restraint. In either case, CRYSTALS warns the user about
what is being done.</p>
<p>The origins of polar space groups are always fixed by restraints, since this
produces a better conditioned matrix than one from just fixing atomic
coordinates.</p>
<p>The UPDATE directive controls whether parameters of atoms near special
positions will be modified to make them exact. The routine will update
just the site occupancies, or the occupancies and the other variable
parameters. The crystallographic site occupancy is held temporarily in the
key SPARE, leaving the key OCC available for a refinable chemical
occupancy. Take care if an atom refines onto (or off) a special position.</p>
<p>The function SPECIAL is actioned automatically for every round of least
squares refinement. Its action is then determined by values held in LIST 23
(structure factor control, see section <a class="reference internal" href="#list23"><span class="std std-ref">Structure factor calculation control list  -  LIST 23</span></a>)</p>
<section id="special-action-update-tolerance">
<h3>\SPECIAL  ACTION= UPDATE= TOLERANCE=<a class="headerlink" href="#special-action-update-tolerance" title="Link to this heading"></a></h3>
<p><em>ACTION</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ACTION</span> <span class="o">=</span> <span class="n">NONE</span>      <span class="n">No</span> <span class="n">action</span>
       <span class="o">=</span> <span class="n">TEST</span>      <span class="n">Displays</span> <span class="n">but</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">store</span> <span class="nb">any</span> <span class="n">restrictions</span>
       <span class="o">=</span> <span class="n">ORIGIN</span>    <span class="n">Tests</span> <span class="k">for</span> <span class="ow">and</span> <span class="n">restrains</span> <span class="n">floating</span> <span class="n">origins</span>
       <span class="o">=</span> <span class="n">RESTRAIN</span>  <span class="n">Creates</span> <span class="ow">and</span> <span class="n">store</span> <span class="n">a</span> <span class="n">LIST</span> <span class="mi">17</span>
       <span class="o">=</span> <span class="n">CONSTRAIN</span> <span class="n">Attempt</span> <span class="n">to</span> <span class="n">create</span> <span class="n">constraints</span><span class="o">.</span>
       <span class="o">=</span> <span class="n">LIST23</span>    <span class="p">(</span><span class="n">Default</span><span class="p">)</span> <span class="n">Takes</span> <span class="n">the</span> <span class="n">action</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">LIST</span> <span class="mi">23</span>
</pre></div>
</div>
</div></blockquote>
<p><em>UPDATE</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="o">=</span> <span class="n">NONE</span>        <span class="n">Nothing</span> <span class="n">updated</span>
       <span class="o">=</span> <span class="n">OCCUPATION</span>  <span class="n">Site</span> <span class="n">occupancies</span> <span class="n">modified</span>
       <span class="o">=</span> <span class="n">PARAMETERS</span>  <span class="n">All</span> <span class="n">adjustable</span> <span class="n">parameters</span> <span class="n">modified</span>
       <span class="o">=</span> <span class="n">LIST23</span>      <span class="p">(</span><span class="n">Default</span><span class="p">)</span> <span class="n">Takes</span> <span class="n">action</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">LIST</span> <span class="mi">23</span>
</pre></div>
</div>
</div></blockquote>
<p><em>TOLERANCE</em></p>
<blockquote>
<div><p>TOLERANCE is the maximum separation, in Angstrom, between nominally
equivalent sites. The default is 0.6A.</p>
</div></blockquote>
</section>
</section>
<section id="printing-the-special-position-information">
<h2>Printing the special position information<a class="headerlink" href="#printing-the-special-position-information" title="Link to this heading"></a></h2>
<p>Force the atom parameter list (LIST 5) to be updated and send it to
the PCH file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">SPECIAL</span> <span class="n">TEST</span> <span class="n">PARAMETER</span>
<span class="n">END</span>
\<span class="n">PUNCH</span> <span class="mi">5</span>  <span class="p">(</span><span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="n">listing</span> <span class="k">with</span> <span class="mi">5</span> <span class="n">decimal</span> <span class="n">places</span><span class="p">)</span>
<span class="n">END</span>
</pre></div>
</div>
</section>
<section id="refinement-directives-list-12">
<span id="list12"></span><span id="index-8"></span><span id="index-7"></span><h2>Refinement directives  -  LIST 12<a class="headerlink" href="#refinement-directives-list-12" title="Link to this heading"></a></h2>
<p>This list defines the parameters to be refined in the
least squares calculation, and
specifies relationships between those parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">12</span>
<span class="n">BLOCK</span>  <span class="n">PARAMETERS</span> <span class="o">...</span>
<span class="n">FIX</span>  <span class="n">PARAMETERS</span> <span class="o">...</span>
<span class="n">EQUIVALENCE</span>  <span class="n">PARAMETERS</span> <span class="o">...</span>
<span class="n">RIDE</span>  <span class="n">ATOM_PARAMETER</span> <span class="n">SPECIFICATIONS</span> <span class="o">...</span>
<span class="n">LINK</span> <span class="n">PARAMETER_LIST</span> <span class="n">AND</span> <span class="n">PARAMETER_LIST</span> <span class="n">AND</span> <span class="n">PARAMETER_LIST</span><span class="o">.</span>
<span class="n">COMBINE</span> <span class="n">PARAMETERS_LIST</span> <span class="n">AND</span> <span class="n">PARAMETERS_LIST</span>
<span class="n">GROUP</span>  <span class="n">ATOM</span> <span class="n">SPECIFICATIONS</span>
<span class="n">WEIGHT</span> <span class="n">F1</span> <span class="n">PARAMETERS</span> <span class="n">F2</span> <span class="n">PARAMETERS</span> <span class="o">...</span>
<span class="n">FULL</span>  <span class="n">PARAMETERS</span>
<span class="n">DIAGONAL</span>  <span class="n">PARAMETERS</span>
<span class="n">PLUS</span>  <span class="n">PARAMETERS</span>
<span class="n">SUMFIX</span> <span class="n">PARAMETERS</span>
<span class="n">REM</span> <span class="n">text</span>
<span class="n">END</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">12</span>
<span class="n">BLOCK</span> <span class="n">SCALE</span> <span class="n">X</span><span class="s1">&#39;S U&#39;</span><span class="n">S</span>
<span class="n">END</span>
</pre></div>
</div>
<section id="list-12">
<h3>\LIST 12<a class="headerlink" href="#list-12" title="Link to this heading"></a></h3>
<p><strong>BLOCK  PARAMETERS</strong></p>
<blockquote>
<div><p>This directive defines the start of a new matrix
block.
Any parameters that come on this directive and any directives until another BLOCK
directive are put into the same matrix block. If only one BLOCK directive is
given, then the refinement is ‘full matrix’.</p>
</div></blockquote>
<p><strong>FIX  PARAMETERS</strong></p>
<blockquote>
<div><p>The specified parameters are not to be refined.</p>
</div></blockquote>
<p><strong>EQUIVALENCE  PARAMETERS</strong></p>
<blockquote>
<div><p>Sets the given parameters to a single least squares parameter (see the
examples).</p>
</div></blockquote>
<p><strong>RIDE  ATOM_PARAMETER SPECIFICATIONS</strong></p>
<blockquote>
<div><p>This directive links corresponding parameters for all the atoms
specified on the directive.
The parameters specified for the first atom given on this directive
are each assigned to individual least squares parameters, and
parameters for subsequent atoms are EQUIVALENCED,
in the order given, to the corresponding least squares parameter.
Only explicit atom parameters can be used on this directive. Usually, the same
parameter keys will be given in the same order for all atoms referenced,
though this may not be true for high symmetry space groups.</p>
</div></blockquote>
<p><strong>LINK PARAMETER_LIST AND PARAMETER_LIST ( AND PARAMETER_LIST.)</strong></p>
<blockquote>
<div><p>Links the parameters defined after the AND with those specified in the
first parameter list. A least squares parameter is assigned to each
physical parameter in the first list. Physical parameters specified in the
second (and subsequent if present) lists are then assigned IN THE ORDER
GIVEN to these least squares parameters. There must be the same number
of parameters in each parameter list. The parameter list may contain
more than one atom, and is terminated by the ‘AND’ or the end of the
directive.  Overall and implicit parameters may  be given.</p>
</div></blockquote>
<p><strong>COMBINE PARAMETERS_1 AND PARAMETERS_2</strong></p>
<blockquote>
<div><p>Combines the parameters defined before the AND with those defined after.
Physical parameters are taken pairwise in the order given
from parameter list 1 and 2 and two least-squares parameters defined such
that one is the sum and the other is the difference of the physical
parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="s1">&#39; = x1 + x2</span>
<span class="n">x</span><span class="s2">&quot; = x1 - x2</span>
                  <span class="n">where</span> <span class="n">x1</span> <span class="ow">and</span> <span class="n">x2</span> <span class="n">are</span> <span class="n">physical</span> <span class="n">parameters</span><span class="p">,</span>
                    <span class="ow">and</span> <span class="n">x</span><span class="s1">&#39; and x&quot; are least squares parameters.</span>
</pre></div>
</div>
<p>Such a re-parameterisation is useful for dealing with certain sorts of ill-
conditioning, such as that due to pseudo-symmetry,
of the normal matrix (see Edward Prince, Mathematical Techniques in
Crystallography and Material Science, 1982, Springer-Verlag, page 113).
NOTE that only one AND can be given.</p>
</div></blockquote>
<p><strong>GROUP  ATOM SPECIFICATIONS</strong></p>
<blockquote>
<div><p>The positional coordinates of the
atoms given in the ATOM SPECIFICATIONS are refined as a rigid group.
Parameter specifications MUST NOT be included. The first atom specified
is taken as the pivot atom of the group. All atoms in the group may be
the subject of restraints to atoms in other parts of the structure, or in
other groups. Use LINK, RIDE or EQUIVALENCE to build a suitable model
for the temperature factors.</p>
<p>Because of the linearisation algorithm used, some distortion of the group
will occur if there are large parameter shifts. Use REGULARISE to re-form it.</p>
</div></blockquote>
<p><strong>WEIGHT w1 PARAMETERS w2 PARAMETERS . .</strong></p>
<blockquote>
<div><p>Before the contributions of the specified parameters
are included in the normal equations, they are
multiplied by the number wI .  Similarly ,
when the normal equations are solved, the shifts
and e.s.d.’s are multiplied by the same wI.
The default  value of wI is 1.0.
The parameters are multiplied by the value of
wI that precedes them (see the examples).</p>
</div></blockquote>
</section>
</section>
<section id="obsolete-refinement-directives">
<h2>Obsolete Refinement directives<a class="headerlink" href="#obsolete-refinement-directives" title="Link to this heading"></a></h2>
<p>The following directives may be removed in some future release.</p>
<p><strong>FULL  PARAMETERS</strong></p>
<p>The parameters on the directive directive plus
any other parameters defined on subsequent directives
are to be included in a full matrix refinement.
The scale factor is automatically included, while
the dummy overall isotropic temperature factor
is fixed. This is equivalent to:</p>
<p>BLOCK SCALE PARAMETERS</p>
<p><strong>PLUS  PARAMETERS</strong></p>
<p>The specified parameters are to be refined, and
they will be placed in the current block of
the normal matrix. This is equivalent to:</p>
<p>CONTINUE PARAMETERS after the BLOCK directive.</p>
<p><strong>DIAGONAL  PARAMETERS</strong></p>
<p>All the specified parameters in the LIST 12 are
included in a block diagonal approximation to
the full matrix, based on one block for each atom.
Both the SCALE FACTOR and the DUMMY OVERALL ISOTROPIC
TEMPERATURE FACTOR are automatically included.</p>
<p><strong>SUMFIX PARAMETERS [ AND PARAMETERS ] [ AND PARAMETERS ]…</strong></p>
<p>Constrains the sum of the specified parameters (or groups of parameters) to
be constant.
If no AND is given, then sum of the parameters specified is constrained, by
making the total of the shifts add to zero. If AND is given then the total of
the shifts for each group add to zero, and each group is equivalenced to a
single least squares parameter.
E.g. constrain sum of three occupancies to be constant.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">12</span>
<span class="n">BLOCK</span> <span class="n">SCALE</span> <span class="n">X</span><span class="s1">&#39;S</span>
<span class="n">SUMFIX</span> <span class="n">Fe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span> <span class="n">Al</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span> <span class="n">Si</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span>
<span class="n">END</span>
</pre></div>
</div>
<p>E.g. constrain sum of three disordered parts to be constant.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">12</span>
<span class="n">BLOCK</span> <span class="n">SCALE</span> <span class="n">X</span><span class="s1">&#39;S</span>
<span class="n">SUMFIX</span> <span class="n">PART</span><span class="p">(</span><span class="mi">1001</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span> <span class="n">AND</span> <span class="n">PART</span><span class="p">(</span><span class="mi">1002</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span> <span class="n">AND</span> <span class="n">PART</span><span class="p">(</span><span class="mi">1003</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span>
<span class="n">END</span>
</pre></div>
</div>
</section>
<section id="defining-the-least-squares-matrix">
<h2>Defining the least squares matrix<a class="headerlink" href="#defining-the-least-squares-matrix" title="Link to this heading"></a></h2>
<p>Parameters may be referred to either <em>implicitly,</em> by just giving the
parameter name (in which case that parameter is referenced for all
atoms), or <em>explicitly</em> by specifying the parameter for an atom
or group of atoms. All implicit specifications ignore H atoms.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span>
     <span class="n">IMPLICIT</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;s</span>
     <span class="n">EXPLICIT</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">),</span> <span class="n">O</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="sa">U</span><span class="s1">&#39;S) UNTIL O(14)</span>
</pre></div>
</div>
<p>A parameter may not be referenced more than once either explicitly or
implicitly. A parameter <em>may</em> be referenced both implicitly and
explicitly, in which case the explicit reference takes precedence.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span>
     <span class="n">BLOCK</span> <span class="n">x</span><span class="s1">&#39;s            (implicit reference)</span>
     <span class="n">FIX</span> <span class="n">Pb</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>          <span class="p">(</span><span class="n">explicit</span> <span class="n">reference</span><span class="p">)</span>
                 <span class="n">This</span> <span class="n">establishes</span> <span class="n">the</span> <span class="n">refinement</span> <span class="n">of</span> <span class="n">z</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">atoms</span>
                 <span class="k">except</span> <span class="n">Pb</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">for</span> <span class="n">which</span> <span class="n">only</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">z</span> <span class="n">are</span> <span class="n">refined</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EXAMPLES</span> <span class="p">:</span>
     <span class="mf">1.</span> <span class="n">BLOCK</span> <span class="n">SCALE</span> <span class="n">X</span>
        <span class="n">FIX</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">)</span>     <span class="n">ALLOWED</span>
     <span class="mf">2.</span> <span class="n">BLOCK</span> <span class="n">SCALE</span>  <span class="n">X</span>
        <span class="n">FIX</span> <span class="n">X</span>          <span class="n">NOT</span> <span class="n">ALLOWED</span>
</pre></div>
</div>
<p>The refinement directives are read and
stored on the disc.
Before the structure factor least squares routines
can use the information in LIST 12 (constraint directives), it is validated against
LIST 5 (the model parameters) and stored
symbolically as a LIST 22.
This is done automatically by the SFLS routines (section <a class="reference internal" href="#sfls"><span class="std std-ref">Structure Factor Least Squares Calculations  -  \SFLS</span></a>), but
the user can force the verification of LIST 12 by issuing the command
\LIST 22.</p>
</section>
<section id="printing-of-list-12">
<h2>Printing of LIST 12<a class="headerlink" href="#printing-of-list-12" title="Link to this heading"></a></h2>
<p>LIST 12 may be listed with either</p>
<section id="print-12">
<h3>\PRINT 12<a class="headerlink" href="#print-12" title="Link to this heading"></a></h3>
<blockquote>
<div><p>or</p>
</div></blockquote>
</section>
<section id="summary-12">
<h3>\SUMMARY 12<a class="headerlink" href="#summary-12" title="Link to this heading"></a></h3>
<blockquote>
<div><p>LIST 12 may be punched with</p>
</div></blockquote>
</section>
<section id="punch-12">
<h3>\PUNCH 12<a class="headerlink" href="#punch-12" title="Link to this heading"></a></h3>
</section>
</section>
<section id="creating-a-null-list-12">
<h2>Creating a null LIST 12<a class="headerlink" href="#creating-a-null-list-12" title="Link to this heading"></a></h2>
<p>A null LIST 12, containing no refinement directives, may be created with</p>
<section id="clear-12">
<h3>\CLEAR 12<a class="headerlink" href="#clear-12" title="Link to this heading"></a></h3>
</section>
</section>
<section id="processing-of-list-12">
<h2>Processing of LIST 12<a class="headerlink" href="#processing-of-list-12" title="Link to this heading"></a></h2>
<p>LIST 12 is processed to greate a LIST 22 with</p>
<section id="list-22">
<h3>\LIST 22<a class="headerlink" href="#list-22" title="Link to this heading"></a></h3>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Examples</span><span class="o">.</span>
<span class="mf">1.</span> <span class="n">Full</span> <span class="n">matrix</span> <span class="n">isotropic</span> <span class="n">refinement</span> <span class="n">of</span> <span class="n">a</span> <span class="n">structure</span> <span class="n">without</span> <span class="n">H</span> <span class="n">atoms</span>

     \<span class="n">LIST</span> <span class="mi">12</span>
     <span class="n">BLOCK</span> <span class="n">SCALE</span> <span class="n">X</span><span class="s1">&#39;S U[ISO]</span>
     <span class="n">END</span>

<span class="mf">2.</span> <span class="n">Full</span> <span class="n">matrix</span> <span class="n">anisotropic</span> <span class="n">of</span> <span class="n">a</span> <span class="n">structure</span> <span class="k">with</span> <span class="n">C</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span> <span class="k">as</span> <span class="n">the</span> <span class="n">last</span>
<span class="n">non</span><span class="o">-</span><span class="n">hydrogen</span><span class="p">,</span> <span class="ow">not</span> <span class="n">refining</span> <span class="n">the</span> <span class="n">H</span> <span class="n">atoms</span><span class="o">.</span>

     \<span class="n">LIST</span> <span class="mi">12</span>
     <span class="n">BLOCK</span> <span class="n">SCALE</span> <span class="n">FIRST</span><span class="p">(</span><span class="n">X</span><span class="s1">&#39;S,U&#39;</span><span class="n">S</span><span class="p">)</span> <span class="n">UNTIL</span> <span class="n">C</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
     <span class="n">END</span>

<span class="mf">3.</span> <span class="n">Refine</span> <span class="nb">all</span> <span class="n">positions</span><span class="p">,</span> <span class="n">aniso</span> <span class="n">non</span><span class="o">-</span><span class="n">H</span><span class="p">,</span> <span class="n">iso</span> <span class="n">H</span> <span class="n">atoms</span>

     \<span class="n">LIST</span> <span class="mi">12</span>
     <span class="n">BLOCK</span> <span class="n">SCALE</span> <span class="n">X</span><span class="s1">&#39;S</span>
     <span class="n">CONTINUE</span> <span class="n">FIRST</span><span class="p">(</span><span class="sa">U</span><span class="s1">&#39;S) UNTIL C(25)</span>
     <span class="n">CONTINUE</span> <span class="n">H</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">[</span><span class="n">ISO</span><span class="p">])</span> <span class="n">UNTIL</span> <span class="n">LAST</span>
     <span class="n">END</span>

<span class="mf">4.</span> <span class="n">Ride</span> <span class="n">H</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">positions</span> <span class="n">on</span> <span class="n">C</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span> <span class="n">positions</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span> <span class="n">There</span> <span class="n">are</span> <span class="mi">2</span> <span class="n">H</span> <span class="n">on</span> <span class="n">C</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>

     \<span class="n">LIST</span> <span class="mi">12</span>
     <span class="n">BLOCK</span> <span class="n">SCALE</span> <span class="n">X</span><span class="s1">&#39;S</span>
     <span class="n">CONTINUE</span> <span class="n">FIRST</span><span class="p">(</span><span class="sa">U</span><span class="s1">&#39;S) UNTIL C(25)</span>
     <span class="n">CONTINUE</span> <span class="n">H</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">[</span><span class="n">ISO</span><span class="p">])</span> <span class="n">UNTIL</span> <span class="n">LAST</span>
     <span class="n">RIDE</span> <span class="n">C</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="n">X</span><span class="s1">&#39;S) H(1,X&#39;</span><span class="n">S</span><span class="p">)</span>
     <span class="n">RIDE</span> <span class="n">C</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="n">X</span><span class="s1">&#39;S) H(2,X&#39;</span><span class="n">S</span><span class="p">)</span>
     <span class="n">RIDE</span> <span class="n">C</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="n">X</span><span class="s1">&#39;S) H(3,X&#39;</span><span class="n">S</span><span class="p">)</span>
     <span class="n">RIDE</span> <span class="n">C</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="n">X</span><span class="s1">&#39;S) H(4,X&#39;</span><span class="n">S</span><span class="p">)</span>
     <span class="n">RIDE</span> <span class="n">C</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="n">X</span><span class="s1">&#39;S) H(51,X&#39;</span><span class="n">S</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span><span class="n">X</span><span class="s1">&#39;S)</span>
     <span class="n">END</span>

<span class="mf">5.</span> <span class="n">A</span> <span class="n">fragment</span> <span class="ow">is</span> <span class="n">distributed</span> <span class="n">over</span> <span class="mi">2</span> <span class="n">sites</span><span class="o">.</span> <span class="n">The</span> <span class="n">fragments</span> <span class="n">are</span>
<span class="n">C</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span> <span class="n">O</span><span class="p">(</span><span class="mi">102</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">103</span><span class="p">)</span> <span class="ow">and</span> <span class="n">C</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">201</span><span class="p">)</span> <span class="n">O</span><span class="p">(</span><span class="mi">202</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">203</span><span class="p">)</span>

     \<span class="n">LIST</span> <span class="mi">12</span>
     <span class="n">BLOCK</span> <span class="n">SCALE</span> <span class="n">X</span><span class="s1">&#39;S</span>
     <span class="o">...</span> <span class="o">...</span>
     <span class="n">EQUIVALENCE</span> <span class="n">C</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span> <span class="n">UNTIL</span> <span class="n">C</span><span class="p">(</span><span class="mi">103</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span> <span class="n">UNTIL</span> <span class="n">C</span><span class="p">(</span><span class="mi">203</span><span class="p">)</span>
     <span class="n">WEIGHT</span> <span class="o">-</span><span class="mi">1</span> <span class="n">C</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span> <span class="n">UNTIL</span> <span class="n">C</span><span class="p">(</span><span class="mi">203</span><span class="p">)</span>
     <span class="n">END</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="restraints-list-16">
<span id="list16"></span><span id="index-10"></span><span id="index-9"></span><h2>Restraints  -  LIST 16<a class="headerlink" href="#restraints-list-16" title="Link to this heading"></a></h2>
<p>This list defines the restraint to be used as supplemental
observations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">16</span>
<span class="n">DISTANCES</span>  <span class="n">VALUE</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">=</span> <span class="n">BOND1</span><span class="p">,</span> <span class="n">BOND2</span>
<span class="n">A</span><span class="o">-</span><span class="n">DISTANCES</span>  <span class="n">VALUE</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">=</span> <span class="n">BOND1</span><span class="p">,</span> <span class="n">BOND2</span>
<span class="n">DISTANCES</span>  <span class="n">VALUE</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">=</span> <span class="n">MEAN</span> <span class="n">BOND1</span><span class="p">,</span> <span class="n">BOND2</span>
<span class="n">DISTANCES</span>  <span class="n">VALUE</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">=</span> <span class="n">DIFFERENCE</span> <span class="n">BOND1</span><span class="p">,</span> <span class="n">BOND2</span>
<span class="n">NONBONDED</span>  <span class="n">VALUE</span><span class="p">,</span> <span class="n">POWERFACTOR</span><span class="o">=</span>  <span class="n">BOND1</span><span class="p">,</span> <span class="n">BOND2</span>
<span class="n">ANGLES</span>     <span class="n">VALUE</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">=</span> <span class="n">ANGLE1</span><span class="p">,</span> <span class="n">ANGLE2</span>
<span class="n">ANGLES</span>     <span class="n">VALUE</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">=</span> <span class="n">MEAN</span> <span class="n">ANGLE1</span><span class="p">,</span> <span class="n">ANGLE2</span>
<span class="n">ANGLES</span>     <span class="n">VALUE</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">=</span> <span class="n">DIFFERENCE</span> <span class="n">ANGLE1</span><span class="p">,</span> <span class="n">ANGLE2</span>
<span class="n">VIBRATIONS</span> <span class="n">VALUE</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">=</span> <span class="n">BOND1</span><span class="p">,</span> <span class="n">BOND2</span>
<span class="n">U</span><span class="p">(</span><span class="n">IJ</span><span class="p">)</span><span class="s1">&#39;S    VALUE, E.S.D= BOND1, BOND2</span>
<span class="n">A</span><span class="o">-</span><span class="n">VIBRATIONS</span> <span class="n">VALUE</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">=</span> <span class="n">BOND1</span><span class="p">,</span> <span class="n">BOND2</span>
<span class="n">A</span><span class="o">-</span><span class="n">U</span><span class="p">(</span><span class="n">IJ</span><span class="p">)</span><span class="s1">&#39;S    VALUE, E.S.D= BOND1, BOND2</span>
<span class="n">UTLS</span>              <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">.</span> <span class="p">[</span> <span class="n">m</span> <span class="p">]</span> <span class="n">ATOM1</span> <span class="p">[</span> <span class="n">ATOM2</span> <span class="p">]</span> <span class="o">...</span>
<span class="n">UEQIV</span>             <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">.</span> <span class="n">ATOM1</span> <span class="p">[</span> <span class="n">ATOM2</span> <span class="p">]</span> <span class="o">...</span>
<span class="n">UVOL</span>              <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">.</span> <span class="n">ATOM1</span> <span class="p">[</span> <span class="n">ATOM2</span> <span class="p">]</span> <span class="o">...</span>
<span class="n">UQISO</span>             <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">.</span> <span class="n">ATOM1</span> <span class="p">[</span> <span class="n">ATOM2</span> <span class="p">]</span> <span class="o">...</span>
<span class="n">UEIG</span>              <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">.</span> <span class="n">ATOM1</span> <span class="p">[</span> <span class="n">ATOM2</span> <span class="p">]</span> <span class="o">...</span>
<span class="n">UALIGN</span>            <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">.</span> <span class="n">ATOM1</span> <span class="p">[</span> <span class="n">ATOM2</span> <span class="p">]</span> <span class="o">...</span>
<span class="n">URIGU</span>             <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">.</span> <span class="n">ATOM1</span> <span class="n">TO</span> <span class="n">ATOM2</span> <span class="p">[,</span> <span class="n">ATOM3</span> <span class="n">TO</span> <span class="n">ATOM4</span> <span class="p">]</span> <span class="o">...</span>
<span class="n">UPERP</span>             <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">.</span> <span class="n">ATOM1</span> <span class="n">TO</span> <span class="n">ATOM2</span> <span class="p">[</span> <span class="n">TO</span> <span class="n">ATOM3</span> <span class="p">]</span> <span class="p">[,</span> <span class="n">ATOM4</span> <span class="n">TO</span> <span class="n">ATOM5</span> <span class="p">[</span> <span class="n">TO</span> <span class="n">ATOM6</span> <span class="p">]</span> <span class="p">]</span> <span class="o">...</span>
<span class="n">UPLANE</span>            <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">.</span> <span class="n">ATOM1</span> <span class="n">TO</span> <span class="n">ATOM2</span> <span class="n">TO</span> <span class="n">ATOM3</span> <span class="p">[,</span> <span class="n">ATOM4</span> <span class="n">TO</span> <span class="n">ATOM5</span> <span class="n">TO</span> <span class="n">ATOM6</span> <span class="p">]</span> <span class="o">...</span>
<span class="n">ULIJ</span>              <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">.</span> <span class="n">ATOM1</span> <span class="n">TO</span> <span class="n">ATOM2</span> <span class="n">TO</span> <span class="n">ATOM3</span> <span class="p">[,</span> <span class="n">ATOM4</span> <span class="n">TO</span> <span class="n">ATOM5</span> <span class="n">TO</span> <span class="n">ATOM6</span> <span class="p">]</span> <span class="o">...</span>
<span class="n">PLANAR</span>            <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span>  <span class="n">FOR</span> <span class="s1">&#39;ATOM SPECIFICATIONS&#39;</span>
<span class="n">LIMIT</span>             <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span>  <span class="n">FOR</span> <span class="s1">&#39;PARAMETER SPECIFICATIONS&#39;</span>
<span class="n">ORIGIN</span>            <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span>  <span class="n">FOR</span> <span class="s1">&#39;PARAMETER SPECIFICATIONS&#39;</span>
<span class="n">SUM</span>               <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span>  <span class="n">FOR</span> <span class="s1">&#39;PARAMETER SPECIFICATIONS&#39;</span>
<span class="n">AVERAGE</span>           <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span>  <span class="n">FOR</span> <span class="s1">&#39;PARAMETER SPECIFICATIONS&#39;</span>
<span class="n">SAME</span>       <span class="n">BOND</span><span class="o">-</span><span class="n">ESD</span> <span class="n">ANGLE</span><span class="o">-</span><span class="n">ESD</span> <span class="n">FOR</span> <span class="n">GROUP</span><span class="o">-</span><span class="mi">1</span> <span class="n">AND</span> <span class="n">GROUP</span><span class="o">-</span><span class="mi">2</span> <span class="n">AND</span> <span class="o">...</span>
<span class="n">DELU</span>       <span class="n">ADP</span><span class="o">-</span><span class="n">ESD</span>  <span class="n">GROUP</span><span class="o">-</span><span class="mi">1</span> <span class="p">(</span><span class="n">AND</span> <span class="n">GROUP</span><span class="o">-</span><span class="mi">2</span> <span class="n">AND</span> <span class="o">...</span><span class="p">)</span>
<span class="n">SIMU</span>       <span class="n">ADP</span><span class="o">-</span><span class="n">ESD</span>  <span class="n">GROUP</span><span class="o">-</span><span class="mi">1</span> <span class="p">(</span><span class="n">AND</span> <span class="n">GROUP</span><span class="o">-</span><span class="mi">2</span> <span class="n">AND</span> <span class="o">...</span><span class="p">)</span>
<span class="n">RESTRAIN</span>   <span class="n">VALUE</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">D</span><span class="o">=</span> <span class="n">TEXT</span>
<span class="n">DEFINE</span> <span class="n">NAME</span> <span class="o">=</span> <span class="n">TEXT</span>
<span class="n">COMPILER</span>
<span class="n">EXECUTION</span>
<span class="n">END</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">16</span>
<span class="n">DIST</span>  <span class="mf">1.39</span> <span class="p">,</span> <span class="mf">.01</span> <span class="o">=</span>      <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">DIST</span>  <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">.01</span> <span class="o">=</span> <span class="n">MEAN</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">VIBR</span>  <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">.01</span> <span class="o">=</span>      <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">U</span><span class="p">(</span><span class="n">IJ</span><span class="p">)</span> <span class="mf">0.0</span>  <span class="p">,</span> <span class="mf">.02</span> <span class="o">=</span>      <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">to</span> <span class="n">C</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">PLANAR</span>                  <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">until</span> <span class="n">C</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">SUM</span>                     <span class="n">K</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">OCC</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span> <span class="n">K</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span>
<span class="n">SUM</span>                     <span class="n">ELEMENT</span> <span class="n">SCALES</span>  <span class="p">(</span><span class="n">twin</span> <span class="n">element</span> <span class="n">scale</span> <span class="n">factors</span><span class="p">)</span>
<span class="n">LIMIT</span>                   <span class="n">U</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="n">U</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="n">U</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span>
<span class="n">END</span>
</pre></div>
</div>
<p>The restraints that can be applied under this system are of a type
originally described by J. Waser, Acta Cryst. 1963, 16, 1091.
A good summary of the present facilities and aims is provided
by J.S. Rollett in Crystallographic Computing, p170.</p>
<p>In this method of restraints, the user provides  a set of
physical or chemical restraints that are to be applied to the
proposed model.
These restraints are usually based upon observations of similar
compounds (for example, bond lengths or bond angles) or upon
known physical laws (for example, the difference in mean square displacement
of two atoms along the bond that joins them).
These restraints are not
rigidly applied to the model, but each restraint has
associated with it an e.s.d., which is used to calculate a weight
so that the restraint can then be added into the normal
equations.
(The e.s.d.’s are provided on an absolute scale, and rescaled by the
program onto the same scale as the xray data).
In this way, the importance of the restraints, which are
treated as extra observations, can be varied with respect to the
importance of the X-ray data.
If the structure is required to adhere closely to the proposed
model, the restraints are given high weights (i.e. small e.s.d.’s)
otherwise they can be given smaller weights.</p>
<p>If, at the end of a refinement, the restraints are not compatible with
the Xray data, this is shown by a discrepancy
between the requested value for the restraint, and that computed from
the refine parameters.
If this is found, the validity of the restraints that have been imposed
should be carefully checked.</p>
<p>In order that the restraint routines should be completely general,
each atom that is part of a restraint can be modified by a set of
symmetry operators before the restraint is applied.
(This is vital for molecules that lie across a symmetry element,
as all the atoms that constitute the molecule are not present
in LIST 5).</p>
<p>If a structure uses symmetry related atoms to form bonds, the
command \DISTANCE with OUTPUT PUNCH=RESTRAIN can be used to set up a
proforma restraints list, including symmetry codes.
The distances and e.s.ds
will have to be edited to the correct target values. Use appropriate values
on the SELECT, INCLUDE and EXCLUDE directives for DISTANCE to
tailor the generated list.</p>
<p>Note that restraints may be used without
diffraction data, see the chapter ‘Distance Least Squares’ for examples.</p>
<p><strong>NOTE</strong></p>
<p>The restraint directives are read and
stored on the disc.
Before the structure factor least squares routines
can use the information in LIST 16 (restraints), it is validated against LIST 5
(the model parameters) and stored symbolically as a LIST 26 (see <a class="reference internal" href="#list26"><span class="std std-ref">Restraints in internal format  -  LIST 26</span></a>).
This is done automatically by the SFLS routines (section <a class="reference internal" href="#sfls"><span class="std std-ref">Structure Factor Least Squares Calculations  -  \SFLS</span></a>), but
the user can force the verification of LIST 16 by issuing the command
\CHECK (see later).</p>
</section>
<section id="parameter-atom-bond-and-angle-specifications">
<h2>Parameter, atom, bond and angle specifications<a class="headerlink" href="#parameter-atom-bond-and-angle-specifications" title="Link to this heading"></a></h2>
<p>Composite parameter specifications are not permitted ( <em>e.g.</em> U’s), atom
specifications are as in Chapter 4.</p>
<p>Two atoms that are bonded together are defined in the following
way :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">atom1</span> <span class="n">to</span> <span class="n">atom2</span><span class="p">,</span>
</pre></div>
</div>
<p>‘atom1’  and  ‘atom2’  are standard atom specifications as described
in chapter 4, and are separated from any other text on the line by
at least one space. If there is more than one bond specification on  a
line, it may be separated from another by either a space or a comma.
The ‘TO’  is mandatory, and is terminated by
one or more spaces.</p>
<p>The definition of an angle is an extension of the definition
of a bond:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">atom1</span> <span class="n">to</span> <span class="n">atom2</span> <span class="n">to</span> <span class="n">atom3</span><span class="p">,</span>
</pre></div>
</div>
<p>The angle is defined as the angle subtended at  atom2  by  atom1
and  atom3.
The restraints routines apply all the required symmetry if specified in
an atom definition, while still
conserving the partial derivatives in their correct form.</p>
<section id="list-16">
<h3>\LIST 16<a class="headerlink" href="#list-16" title="Link to this heading"></a></h3>
<blockquote>
<div><p>The restraints routines regard all
continuation directives as part of the original
directive, so that the column of a
character on a continuation directive will
have had ‘80*n’ added to it, where ‘n’ is
the number of directives between the current
continuation directive and the start of
the directive. The ‘,’, ‘=’ signs and separator ‘MEAN’ are mandatory
if shown in  the definition.</p>
</div></blockquote>
<p><strong>DISTANCES  VALUE, E.S.D. = BOND1, BOND2, … . .</strong></p>
<blockquote>
<div><p>The bonds specified after the ‘=’ sign are
restrained to have a length of ‘VALUE’, with
an e.s.d. of ‘E.S.D.’.</p>
</div></blockquote>
<p><strong>A-DISTANCES  VALUE, E.S.D. = BOND1, BOND2, … . .</strong></p>
<blockquote>
<div><p>Asymmetric distance restraint. The second atom in the bond is
restrained to be the given distance from the first, which is unrestrained.</p>
<p>Note that the qualifiers MEAN and DIFFERENCE cannot be used in this
context.</p>
</div></blockquote>
<p><strong>DISTANCES VALUE, E.S.D. = MEAN BOND1, BOND2, … .</strong></p>
<blockquote>
<div><p>Initially the restraints routines calculate the
‘MEAN’ value of all the bonds specified by
the directive. Each of the bonds
specified is then restrained to be
equal to ‘MEAN’ + ‘VALUE’, with an e.s.d. of
‘E.S.D.’. The ‘DELTA’ used in the
right hand sides of the normal equations is
defined by :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELTA</span> <span class="o">=</span> <span class="n">MEAN</span> <span class="o">+</span> <span class="n">VALUE</span> <span class="o">-</span> <span class="n">BOND</span> <span class="n">CALCULATED</span><span class="o">.</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>DISTANCES VALUE, E.S.D. = DIFFERENCE BOND1, BOND2, . .</strong></p>
<blockquote>
<div><p>Each of the bonds in this directive is restrained
to be equal to ‘VALUE’
plus the length of each of the bonds that
follow it.
The computed value of ‘DELTA’ used in
the right hand sides of the normal
equations is thus given by :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELTA</span> <span class="o">=</span> <span class="n">VALUE</span> <span class="o">+</span> <span class="n">BOND</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="n">BOND</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
<p>Where BOND(N) occurs after BOND(M) in
the directive.</p>
<p>Each such restraint is added into the
normal equations with an e.s.d. Of  E.S.D. .
However, as each bond is restrained to each
of the bonds that follow it,  (N*(N-1))/2
separate restraints are generated.
Many of these restraints involve the same
bond lengths and are thus not independent.
To be strictly accurate, a non-diagonal
weight matrix should be used with this
restraint but such a facility
is not available.</p>
<p>The letters  DIFFERENCE  are terminated
by one or more spaces and may be abbreviated to
DIFF.</p>
</div></blockquote>
<p><strong>NONBONDED  VALUE, POWERFACTOR =, BOND1, BOND2, … . .</strong></p>
<blockquote>
<div><p>This restraint is similar to the ‘DISTANCE’ restraint in that the pairs of
atoms defining the bond are restrained to be at the ‘VALUE’ distance appart.
However, the weight to be given to the restraint is computed from the
difference between the observed and the requested contact distance using the
expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">weight</span> <span class="o">=</span> <span class="mi">10000</span><span class="o">*</span><span class="p">(</span><span class="n">requested</span><span class="o">/</span><span class="n">observed</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">powerfactor</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p>When the observed equals the requested distance,
the weight corresponds to an e.s.d.
of .01. If the requested is less than the observed, the weight is reduced
slowly as a function of the discrepancy. If the requested is greater than the
observed, the weight rises rapidly with discrepancy. The function is like the
repulsive part of a 6-12 energy expression, having greatest effect on
anomalously short contacts. Powerfactors of between 1 and 4 seem to be
suitable.</p>
</div></blockquote>
<p><strong>ANGLES VALUE, E.S.D. = ANGLE1, ANGLE2, … .</strong></p>
<blockquote>
<div><p>Each of the angles given in the directive
is restrained to a value of ‘VALUE’,
with an e.s.d. of ‘E.S.D.’. The angles must
be in degrees.</p>
</div></blockquote>
<p><strong>ANGLES VALUE, E.S.D. = MEAN ANGLE1, ANGLE2, … . .</strong></p>
<blockquote>
<div><p>This is the analagous to the MEAN distance restaint,
except that the mean value is computed for
the specified angles and each of the angles
is then restrained to ‘MEAN’ + ‘VALUE’,
with an e.s.d. of ‘E.S.D.’.
The ‘DELTA’ values and the syntax rules are all the
same as for the equivalent distance restraint.</p>
</div></blockquote>
<p><strong>ANGLES VALUE, E.S.D. = DIFFERENCE ANGLE1, ANGLE2, . .</strong></p>
<blockquote>
<div><p>This restraint is analogous to the
DIFFERENCE restraint  for bond lengths.
Each of the angles in the directive is
restrained to be equal to ‘VALUE’ plus each of
the angles after it in the input.
Although each such restraint is applied with
an e.s.d. of ‘E.S.D.’, the same reservations about
the validity of the weighting scheme exist
here as for the equivalent distance restraint.</p>
</div></blockquote>
<p><strong>VIBRATIONS VALUE, E.S.D. = BOND1, BOND2, … .</strong></p>
<blockquote>
<div><p>The difference in mean square displacement
along the bond direction
of the two atoms that form the bond is
restrained to be ‘VALUE’, with an e.s.d. of
‘E.S.D.’. In general, ‘VALUE’ is assumed to be
zero, while the e.s.d. reflects the maximum
discrepancy  in m.s.d. that would be expected for
the type of bond being considered.
If either or both of the given atoms is
isotropic, the program will convert the m.s.d.
into the appropriate form and calculate the
derivatives for the isotropic atom correctly.</p>
<p>Note that the atoms defining a ‘bond’ need not actually be bonded, but
merely serve to define a direction. For really bonded atoms, try an esd
of  .002; for 1-3 atoms or diagonals of phenyl groups, try .005.</p>
</div></blockquote>
<p><strong>A-VIBRATIONS VALUE, E.S.D. = BOND1, BOND2, … .</strong></p>
<blockquote>
<div><p>Asymmetric vibration restraint. The second atom in the bond is
restrained to be similar to the first, which is unrestrained.</p>
</div></blockquote>
<p><strong>U(IJ)’S VALUE, E.S.D. =, BOND1, BOND2, … .</strong></p>
<blockquote>
<div><p>This is a similarity restraint, and may be used to ensure that the
vibration parameters of adjacent atoms are similar, as must be the case
even for flexible systems. The esd used must be softer than for a
VIBRATION restraint, typically 0.01.
In this restraint, the difference
between corresponding u(ii) and u(ij) terms
is restrained to be ‘VALUE’, with an
e.s.d. of ‘E.S.D.’.
Each bond that is specified generates therefore
six separate restraints, one for each of
the anisotropic temperature parameters. If
an atom with an isotropic temperature factor
is included in this restraint, the specified bond
and all six restraints are ignored.</p>
</div></blockquote>
<p><strong>A-U(IJ)’S VALUE, E.S.D. =, BOND1, BOND2, … .</strong></p>
<blockquote>
<div><p>Asymmetric Uij restraint. The second atom in the bond is
restrained to be similar to the first, which is unrestrained.</p>
</div></blockquote>
<p><strong>PLANAR E.S.D. FOR ‘ATOM SPECIFICATIONS’</strong></p>
<blockquote>
<div><p>This directive instructs the system to compute the mean plane
through the atoms given in the atom specifications,
and then to restrain each of the atoms to lie in the plane.
The ‘E.S.D.’ with which each atom is restrained to be on
the plane is given in angstrom.
This parameter is optional and has a default value of 0.01.
‘FOR’ is optional.
‘ATOM SPECIFICATIONS’ define the atoms that are on the plane.
Each ‘ATOM SPECIFICATIONS’ may consist of one atom, together
with symmetry data, or two atoms separated by ‘UNTIL’.
One or more specifications must be given.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Examples</span> <span class="p">:</span>
 <span class="n">PLANAR</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="n">UNTIL</span> <span class="n">C</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
 <span class="n">PLANAR</span> <span class="mf">0.05</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">UNTIL</span> <span class="n">C</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
 <span class="n">PLANAR</span> <span class="mf">0.05</span> <span class="n">FOR</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">UNTIL</span> <span class="n">C</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
 <span class="n">PLANAR</span> <span class="n">FOR</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="n">UNTIL</span> <span class="n">C</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>LIMIT E.S.D. FOR ‘PARAMETER SPECIFICATIONS’</strong></p>
<blockquote>
<div><p>This restraint seta a target shift of zero for the specified
parameters, with the specified esd, and thus tries to limit the shift
in the parameters.
Since it modifies the normal matrix, it does not have the same effect as
partial shifts (SHIFT,MAXIMUM,and FORCE in SFLS [section <a class="reference internal" href="#sfls"><span class="std std-ref">Structure Factor Least Squares Calculations  -  \SFLS</span></a>]).
In particular, the
e.s.d. on the parameter will depend upon the E.S.D. given to this restraint.
The default for E.S.D. is .001. Reducing this to about .00001 will have almost
the same effect as FIX in LIST 12. Increasing it to 10.0  will cause the
restraint to have almost no effect unless the parameter involved is almost
singular with respect to some other parameter. Note that this is only a
restraint, and if the medel and X-ray data are good, the specified parameters
will still shift. This restraint is valuable during the development of
a poor starting model.</p>
</div></blockquote>
<p><strong>ORIGIN E.S.D. FOR ‘PARAMETER SPECIFICATIONS’</strong></p>
<blockquote>
<div><p>This is used  for polar space groups,
where the singularity up the polar axis may be removed by  holding
the electron weighted sum of all the coordinates up that axis constant.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Example</span>
 <span class="n">ORIGIN</span> <span class="n">Y</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>SUM E.S.D. FOR ‘PARAMETER SPECIFICATIONS’</strong></p>
<blockquote>
<div><p>This restraint holds the sum of the parameters on the directive constant
during the refinement.
A typical case is where several (more than 2, which are better
treated with EQUIVALENCE, in LIST 12) atoms share a site.
‘E.S.D.’ is the e.s.d. with which the sum of the parameters is
held constant.
This is an optional parameter and has a default value of 0.0001.
‘FOR’ is optional.
‘PARAMETER SPECIFICATIONS’ define the parameters that are to be
summed. They may be given as :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">overall</span> <span class="n">parameters</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">SCALE</span><span class="p">,</span>
<span class="nb">all</span> <span class="n">atomic</span> <span class="n">parameters</span> <span class="n">of</span> <span class="n">one</span> <span class="nb">type</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span>
<span class="n">atomic</span> <span class="n">parameters</span> <span class="n">of</span> <span class="n">one</span> <span class="nb">type</span> <span class="k">for</span> <span class="n">a</span> <span class="n">group</span> <span class="n">of</span> <span class="n">atoms</span>
      <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">NA</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span> <span class="n">UNTIL</span> <span class="n">RB</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Examples</span> <span class="p">:</span>
 <span class="n">SUM</span> <span class="mf">0.0001</span> <span class="n">NA</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">OCC</span><span class="p">)</span> <span class="n">UNTIL</span> <span class="n">RB</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
 <span class="n">SUM</span> <span class="n">LAYER</span> <span class="n">SCALES</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>AVERAGE E.S.D. FOR ‘PARAMETER SPECIFICATIONS’</strong></p>
<blockquote>
<div><p>For this directive, the system computes the mean of the given
parameters,
and then restrains each to have the mean value
with an e.s.d. of ‘E.S.D.’.
The parameters are as for the ‘SUM’ directive above.</p>
</div></blockquote>
<p><strong>SAME BOND-ESD ANGLE-ESD FOR GROUP-1 AND GROUP-2 AND …</strong></p>
<blockquote>
<div><p>The first group on the card is the ‘target’ -
all following groups are mapped onto it (in order specified) and the distances and
angles restrained - using the connectivity of the first group.</p>
<p>The first two arguments are the e.s.d for bond length restraints and the e.s.d
for angle restraints. Groups are seperated by the word ‘AND’.
NOTE the absence of the usual ‘=’ sign.
I.E:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SAME</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span> <span class="n">FOR</span> <span class="n">RESI</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">AND</span> <span class="n">RESI</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">SAME</span>  <span class="n">PART</span><span class="p">(</span><span class="mi">1001</span><span class="p">)</span> <span class="n">PART</span><span class="p">(</span><span class="mi">1002</span><span class="p">)</span>
</pre></div>
</div>
<p>maps all atoms in the first argument onto all the atoms in
the second argument.</p>
<p>TAKE CARE
Although this shorthand is appealing, the order of the atoms in LIST
5 must be identical in both arguments, although the atoms do not have
to be adjacent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SAME</span> <span class="mf">0.01</span> <span class="p">,</span> <span class="mf">0.1</span>
<span class="n">CONT</span> <span class="n">C</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>  <span class="n">C</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>  <span class="n">H</span><span class="p">(</span><span class="mi">183</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">182</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span> <span class="n">AND</span>
<span class="n">CONT</span> <span class="n">C</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>  <span class="n">C</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>  <span class="n">H</span><span class="p">(</span><span class="mi">182</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">183</span><span class="p">)</span>
  <span class="n">imposes</span> <span class="mi">3</span><span class="o">-</span><span class="n">fold</span> <span class="n">symmetry</span> <span class="n">on</span> <span class="n">a</span> <span class="n">single</span> <span class="n">methyl</span> <span class="n">group</span><span class="o">.</span>

<span class="n">SAME</span> <span class="mf">0.01</span> <span class="p">,</span> <span class="mf">0.1</span>
<span class="n">CONT</span> <span class="n">C</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>  <span class="n">C</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>  <span class="n">H</span><span class="p">(</span><span class="mi">183</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">182</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span> <span class="n">AND</span>
<span class="n">CONT</span> <span class="n">C</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>  <span class="n">C</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>  <span class="n">H</span><span class="p">(</span><span class="mi">193</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">191</span><span class="p">)</span> <span class="n">AND</span>
<span class="n">CONT</span> <span class="n">C</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>   <span class="n">C</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>   <span class="n">H</span><span class="p">(</span><span class="mi">93</span><span class="p">)</span>  <span class="n">H</span><span class="p">(</span><span class="mi">92</span><span class="p">)</span>  <span class="n">H</span><span class="p">(</span><span class="mi">91</span><span class="p">)</span> <span class="n">AND</span>
<span class="n">CONT</span> <span class="n">C</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>   <span class="n">C</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="n">H</span><span class="p">(</span><span class="mi">103</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">102</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span> <span class="n">AND</span>
<span class="n">CONT</span> <span class="n">C</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>  <span class="n">C</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>  <span class="n">H</span><span class="p">(</span><span class="mi">153</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">152</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">151</span><span class="p">)</span> <span class="n">AND</span>
<span class="n">CONT</span> <span class="n">C</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>  <span class="n">C</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>  <span class="n">H</span><span class="p">(</span><span class="mi">163</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">162</span><span class="p">)</span> <span class="n">H</span><span class="p">(</span><span class="mi">161</span><span class="p">)</span>
  <span class="n">restrains</span> <span class="n">six</span> <span class="n">methyl</span> <span class="n">groups</span> <span class="n">to</span> <span class="n">have</span> <span class="n">the</span> <span class="n">same</span> <span class="n">geometry</span> <span class="k">as</span> <span class="n">each</span>
  <span class="n">other</span><span class="o">.</span> <span class="n">Combining</span> <span class="n">the</span> <span class="n">last</span> <span class="n">two</span> <span class="n">restraints</span> <span class="n">would</span> <span class="n">make</span> <span class="nb">all</span> <span class="n">the</span>
  <span class="n">methyls</span> <span class="n">have</span> <span class="mi">3</span> <span class="n">fold</span> <span class="n">symmetry</span><span class="p">,</span> <span class="ow">and</span> <span class="nb">all</span> <span class="n">be</span> <span class="n">the</span> <span class="n">same</span><span class="o">.</span>
</pre></div>
</div>
<p>Errors are generated if
1) the size of any of the groups on the SAME card is not the
same as the first group.
2) the element type in a group does not match the corresponding
element type in the first group.</p>
<p>Warnings are printed if there are zero bonds to any of the atoms
in the first group.</p>
<p>The comma separating the e.s.d arguments, and the ‘FOR’ separating the
e.s.d.s from the atom specifications are optional.
The second e.s.d is optional, the default is 0.1 degrees.
The first e.s.d is optional unless you wish to specify the second, the
default is 0.01 Angstroms.</p>
<p>List 41 (bonds) is loaded by the restraint generating routine, if it
does not exist an error will occur. (By default L41 is kept up to date
with the current model.)</p>
</div></blockquote>
<p><strong>DELU ADP-ESD  FOR GROUP-1 (AND GROUP-2 AND …)</strong></p>
<blockquote>
<div><p>The adps of all pairs of bonded atoms in each group are restrained
to be equal in the direction of the bond.  Unlike SAME, a single
group can be given.  The RESIDUES are NOT restrained to be similar.</p>
<p>The first argument is the e.s.d for adp-restraint,
I.E:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELU</span> <span class="mf">0.01</span>  <span class="n">FOR</span> <span class="n">RESI</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">AND</span> <span class="n">RESI</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Errors are generated if
1) the size of any of the groups on the DELU card is not the
same as the first group.
2) the element type in a group does not match the corresponding
element type in the first group.</p>
<p>Warnings are printed if there are zero bonds to any of the atoms
in the first group.</p>
<p>The  ‘FOR’ separating the
e.s.d.s from the atom specifications is optional.
The e.s.d is optional, the  default is 0.01 Angstroms.</p>
<p>List 41 (bonds) is loaded by the restraint generating routine, if it
does not exist an error will occur. (By default L41 is kept up to date
with the current model.)</p>
</div></blockquote>
<p><strong>SIMU ADP-ESD  FOR GROUP-1 (AND GROUP-2 AND …)</strong></p>
<blockquote>
<div><p>Restrains equivalent elements of the  adps of all pairs on bonded atoms
in each residue. The RESIDUES are NOT restrained to be similar. Unlike
SAME, a single group can be given</p>
<p>The first argument is the e.s.d for adp-restraint.
I.E:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SIMU</span> <span class="mf">0.04</span>  <span class="n">FOR</span> <span class="n">RESI</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">AND</span> <span class="n">RESI</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Errors are generated if
1) the size of any of the groups on the DELU card is not the
same as the first group.
2) the element type in a group does not match the corresponding
element type in the first group.</p>
<p>Warnings are printed if there are zero bonds to any of the atoms
in the first group.</p>
<p>The  ‘FOR’ separating the
e.s.d.s from the atom specifications is optional.
The e.s.d is optional, the  default is 0.04 Angstroms.</p>
<p>List 41 (bonds) is loaded by the restraint generating routine, if it
does not exist an error will occur. (By default L41 is kept up to date
with the current model.)</p>
</div></blockquote>
<p><strong>UTLS              E.S.D. [ m ] ATOM1 [ ATOM2 ] …</strong></p>
<blockquote>
<div><p>Restrain ADPs of all or the m first atoms listed to calculated ADPs derived
from a TLS model from all the atom list.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UTLS</span> <span class="mf">0.01</span> <span class="mi">3</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>A TLS model is generated using F(1), F(2), F(3), C(1) and C(2). This model
is then used to calculate theoritical ADPs. These ADPs are then used as targets
for the restraints on atoms F(1), F(2) and F(3) with an e.s.d. of 0.01.</p>
</div></blockquote>
<p><strong>UEQIV             E.S.D. ATOM1 [ ATOM2 ] …</strong></p>
<blockquote>
<div><p>Restrain Ueqiv of the ADPs of all the atom listed to be equal</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UEQIV</span> <span class="mf">0.01</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Ueq is the arthmetic mean of the principal axes of an ADP.
the current Ueq is calculated for each atom and an average calculated.
If an atom is non positive definite, its Ueq is not used for the calculation of the mean
but the atom is included in the restraint. Ueq of each atom is then restrained to
the average.</p>
</div></blockquote>
<p><strong>UVOL              E.S.D. ATOM1 [ ATOM2 ] …</strong></p>
<blockquote>
<div><p>Restrain Ugeom of the ADPs of all the atom listed to be equal</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UVOL</span> <span class="mf">0.01</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Ugeom is the geometric mean of the principal axes of an ADP.
the current Ugeom is calculated for each atom and an average calculated.
If an atom is non positive definite, the atom is excluded from the restraint.
Ugeom of each atom is then restrained to the average.</p>
</div></blockquote>
<p><strong>UQISO             E.S.D. ATOM1 [ ATOM2 ] …</strong></p>
<blockquote>
<div><p>Restrain each atom listed to be isotropic</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UQISO</span> <span class="mf">0.01</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The length of the principal component of each atom are restrained to its average.
Each atom is treated independantly.</p>
</div></blockquote>
<p><strong>UEIG              E.S.D. ATOM1 [ ATOM2 ] …</strong></p>
<blockquote>
<div><p>Restrain each atom listed to be spheroid (2 smallest principle axes to be equal)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UEIG</span> <span class="mf">0.01</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The length of the two smallest principal component of each atom are restrained to its average.
Each atom is treated independantly and the third principal component is free.</p>
</div></blockquote>
<p><strong>UALIGN            E.S.D. ATOM1 [ ATOM2 ] …</strong></p>
<blockquote>
<div><p>Restrain the ADPs of all the atom listed to be aligned to their average direction</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UALIGN</span> <span class="mf">0.01</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">F</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The matrix of eigenvectors is calculated for each ADP and an average calculated.
If an atom is non positive definite, the atom is excluded from average but keep for the restraint.
Each matrix of eigenvectors is then restrained to the average. The eigenvalues remain free.</p>
</div></blockquote>
<p><strong>URIGU             E.S.D. ATOM1 TO ATOM2 [, ATOM3 TO ATOM4 ] …</strong></p>
<blockquote>
<div><p>Restrain the ADPs listed using enhanced rigibody restraints</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">URIGU</span> <span class="mf">0.01</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">TO</span> <span class="n">F</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Implementation of the RIGU restraint from SHELXL. See</p>
<p>Uhttps://dx.doi.org/10.1107%2FS0108767312014535 Thorn, A., et. al., Acta Cryst. Sect A, 2012, Vol. 68, pp. 448-451#</p>
</div></blockquote>
<p><strong>UPERP             E.S.D. ATOM1 TO ATOM2 [ TO ATOM3 ] [, ATOM4 TO ATOM5 [ TO ATOM6 ] ] …</strong></p>
<blockquote>
<div><p>Restrain the ADP of the first atom of the group to be perpendicular to the direction
of the 2 atoms of the group or the bissector define by ATOM1 TO ATOM2 and ATOM1 TO ATOM3</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPERP</span> <span class="mf">0.01</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The ADP of the atom F(1) and F(2) are restrained to be perpendicular to the direction
F(1)-C(1) and F(2)-C(2) respectively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPERP</span> <span class="mf">0.01</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The ADP of the atom C(2) is restrained to be perpendicular to the direction
define by the bissector of C(1)-C(2)-C(3).</p>
</div></blockquote>
<p><strong>UPLANE            E.S.D. ATOM1 TO ATOM2 TO ATOM3 [, ATOM4 TO ATOM5 TO ATOM6 ] …</strong></p>
<blockquote>
<div><p>Restrain the ADP of the first atom of the group to be perpendicular to the plane
formed by the 3 atoms of the group</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPLANE</span> <span class="mf">0.01</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>The ADP of the atom F(1) is restrained to be colinear to the direction
define by the normal of the plane defined by F(1), C(1) and C(2).</p>
</div></blockquote>
<p><strong>ULIJ              E.S.D. ATOM1 TO ATOM2 TO ATOM3 [, ATOM4 TO ATOM5 TO ATOM6 ] …</strong></p>
<blockquote>
<div><p>Restrain the ADP of all the first atom (ATOM1, ATOM4…) of the groups to be equal in the local coordinate
basis defined by all the atom of each group (ATOM1, ATOM2, ATOM3; ATOM4, ATOM5, ATOM6…).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ULIJ</span> <span class="mf">0.01</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>The Uij terms of the ADP of the atom F(1) and F(2) are restrained to be equal
in their repesctive local coordinate system defined by F(1), C(1), C(2) and
F(2), C(1), C(2).</p>
</div></blockquote>
</section>
</section>
<section id="general-restraints">
<h2>General restraints<a class="headerlink" href="#general-restraints" title="Link to this heading"></a></h2>
<p>The ‘general restraint’ enables
the user to write out a restraining equation explicitly.
The system
automatically calculates the value of the restraint and then
evaluates the partial derivatives for each of the refinable  parameters</p>
<p>Thes restraints look like  simple
fortran statements involving operators and operands.</p>
<p><strong>OPERATORS</strong></p>
<p>The available operators are :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
<span class="p">)</span>
<span class="o">**</span>            <span class="n">must</span> <span class="n">be</span> <span class="n">followed</span> <span class="n">by</span> <span class="n">an</span> <span class="n">operand</span><span class="o">.</span>
<span class="o">*</span>             <span class="n">must</span> <span class="n">join</span> <span class="n">two</span> <span class="n">operands</span><span class="o">.</span>
<span class="o">/</span>             <span class="n">must</span> <span class="n">join</span> <span class="n">two</span> <span class="n">operands</span><span class="o">.</span>
<span class="o">+</span>             <span class="n">must</span> <span class="n">precede</span> <span class="n">an</span> <span class="n">operand</span><span class="o">.</span>
<span class="o">-</span>             <span class="n">must</span> <span class="n">precede</span> <span class="n">an</span> <span class="n">operand</span><span class="o">.</span>
</pre></div>
</div>
<p>An operand may be a simple variable or
an expression enclosed in parentheses.</p>
<p>The operators above assume their normal FORTRAN meanings,
and the combination of operands and operators is the same as in
standard FORTRAN, except that all calculations are done
in floating point.</p>
<p><strong>ATOMIC COORDINATES</strong></p>
<p>These are specified by a modified form of the
atom definition given above. This is :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span><span class="p">(</span><span class="n">SERIAL</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">TX</span><span class="p">,</span><span class="n">TY</span><span class="p">,</span><span class="n">TZ</span><span class="p">,</span><span class="n">KEY</span><span class="p">)</span>
</pre></div>
</div>
<p>KEY  Specifies the relevant coordinate of the
atom. The  KEY  is regarded as an
obligatory parameter, but for the remaining
symmetry parameters, the drop
out rules and default
settings described under the atom definition may be
applied, so that the simplest form of
coordinate definition is  TYPE(SERIAL,KEY), similar to a LIST 12
definition .
The usual parameter keys are recognized.</p>
<p><strong>OVERALL PARAMETERS</strong></p>
<p>The usual overall paameter keys are recognized.</p>
<p><strong>VARIABLES</strong></p>
<p>These are unsubscripted variables specified by up to
8 characters, of which the first must be a letter.
Many commonly occurring crystallographic
quantities are already prestored by the system,
and the user has the ability to declare new
constants with a ‘DEFINE’ directive, which
is described below.
When a user defines a new variable, he must not use a name that
has already been declared by the system.
The system variables are:</p>
<p><strong>ARRAY VARIABLES</strong></p>
<p>The system has pre-stored various arrays and variables holding
useful crystallographic information, and
users may not define or declare  new arrays.
The addressing is done in
the normal Fortran manner, except that
the element required must be specified by numeric
arguments, and not variables.
Thus A(3,1) is allowed, but A(I,J) is illegal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>       <span class="n">the</span> <span class="n">cell</span> <span class="n">parameters</span> <span class="p">(</span><span class="n">angles</span> <span class="ow">in</span> <span class="n">radians</span><span class="p">)</span>
<span class="n">CV</span>         <span class="n">real</span> <span class="n">cell</span> <span class="n">volume</span>
<span class="n">AR</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>      <span class="n">reciprocal</span> <span class="n">cell</span> <span class="n">parameters</span> <span class="p">(</span><span class="n">angles</span> <span class="ow">in</span> <span class="n">radians</span><span class="p">)</span>
<span class="n">RCV</span>        <span class="n">reciprocal</span> <span class="n">cell</span> <span class="n">volume</span>
<span class="n">G</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>     <span class="n">real</span> <span class="n">metric</span> <span class="n">tensor</span>
<span class="n">GR</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>    <span class="n">reciprocal</span> <span class="n">metric</span> <span class="n">tensor</span>
<span class="n">L</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>     <span class="n">real</span> <span class="n">orthogonalization</span> <span class="n">matrix</span>
<span class="n">LR</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>    <span class="n">reciprocal</span> <span class="n">orthogonalization</span> <span class="n">matrix</span>
<span class="n">CONV</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>    <span class="n">conversion</span> <span class="n">factor</span> <span class="k">for</span> <span class="n">the</span> <span class="s1">&#39;U(ij)&#39;</span><span class="n">s</span><span class="s1">&#39; from &#39;</span><span class="n">U</span><span class="p">[</span><span class="n">iso</span><span class="p">]</span><span class="s1">&#39;</span>
<span class="n">RIJ</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>     <span class="n">coefficients</span> <span class="n">needed</span> <span class="n">to</span> <span class="n">calculate</span> <span class="p">[</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">/</span><span class="n">l</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="n">ANIS</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>    <span class="n">coefficients</span> <span class="n">needed</span> <span class="n">to</span> <span class="n">calculate</span> <span class="n">the</span> <span class="n">temperature</span>
           <span class="n">factor</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">anisotropic</span> <span class="n">temperature</span> <span class="n">factors</span>
<span class="n">SM</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>  <span class="n">symmetry</span> <span class="n">matrix</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">where</span> <span class="n">the</span> <span class="n">translational</span>
           <span class="n">part</span> <span class="ow">is</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">sm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<span class="n">SMI</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="n">inverse</span> <span class="n">symmetry</span> <span class="n">operators</span>
<span class="n">NPLT</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>  <span class="n">non</span><span class="o">-</span><span class="n">primitive</span> <span class="n">lattice</span> <span class="n">translations</span>
<span class="n">PI</span>         <span class="mf">3.141</span><span class="o">.........</span> <span class="n">etc</span><span class="o">.</span>
<span class="n">TPI</span>        <span class="mi">2</span><span class="o">*</span><span class="n">Pi</span>
<span class="n">TPIS</span>       <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pi</span>
<span class="n">DTR</span>        <span class="n">conversion</span> <span class="n">of</span> <span class="n">degrees</span> <span class="n">to</span> <span class="n">radians</span>
<span class="n">RTD</span>        <span class="n">conversion</span> <span class="n">of</span> <span class="n">radians</span> <span class="n">to</span> <span class="n">degrees</span>
<span class="n">ZERO</span>       <span class="mf">0.0</span>
</pre></div>
</div>
<p>The following functions
are also recognized :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SIN</span><span class="p">(</span><span class="n">ARG</span><span class="p">)</span>      <span class="n">COS</span><span class="p">(</span><span class="n">ARG</span><span class="p">)</span>      <span class="n">TAN</span><span class="p">(</span><span class="n">ARG</span><span class="p">)</span>      <span class="n">ACOS</span><span class="p">(</span><span class="n">ARG</span><span class="p">)</span>
<span class="n">ASIN</span><span class="p">(</span><span class="n">ARG</span><span class="p">)</span>     <span class="n">ATAN</span><span class="p">(</span><span class="n">ARG</span><span class="p">)</span>     <span class="n">EXP</span><span class="p">(</span><span class="n">ARG</span><span class="p">)</span>      <span class="n">SQRT</span><span class="p">(</span><span class="n">ARG</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id1">
<h2>General restraints<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<p>There are two directives.</p>
<p><strong>DEFINE NAME = TEXT</strong></p>
<p>This may be used to set up a user-defined constant which is evaluated
at run time, and  which may be referred to later on by ‘NAME’.
The text comprises  a series of variables and
numeric constants interspersed with operators.
The ‘NAME’ must not be one of the standard functions or
variables, and may be overwritten several times  -  i.e.
its value may be redefined. Derivatives of a DEFINEd constant are not
evaluated as part of the restraint, though its numerical value will
change in successive cycles of refinement.</p>
<p><strong>RESTRAIN VALUE, E.S.D. = TEXT</strong></p>
<p>The physical or chemical quantity defined by the
‘TEXT’ is restrained to be ‘VALUE’, with
an e.s.d. of ‘E.S.D.’.
The text is comprised of operands separated by
operators.
The system will differentiate the ‘TEXT’ with
respect to each of the refinable coordinates
that it contains and add the derivatives to
the normal matrix in the usual way.</p>
</section>
<section id="debugging-restraints">
<h2>Debugging restraints<a class="headerlink" href="#debugging-restraints" title="Link to this heading"></a></h2>
<p>Debugging commands are available to help with the creation of general
restraints</p>
<p><strong>COMPILER</strong></p>
<p>During the formation of LIST 26 (see <a class="reference internal" href="#list26"><span class="std std-ref">Restraints in internal format  -  LIST 26</span></a>),
the input directives are listed, together
with various internal stacks.</p>
<p><strong>EXECUTION</strong></p>
<p>During the application of the restraints to
the normal equations, various stacks are
printed and all the calculated derivatives
are printed (use with care).</p>
</section>
<section id="printing-the-contents-of-list-16">
<h2>Printing the contents of LIST 16<a class="headerlink" href="#printing-the-contents-of-list-16" title="Link to this heading"></a></h2>
<p>The contents of LIST 16 may be listed with:</p>
<section id="print-16">
<h3>\PRINT 16<a class="headerlink" href="#print-16" title="Link to this heading"></a></h3>
<blockquote>
<div><p>or</p>
</div></blockquote>
</section>
<section id="summary-list-16">
<h3>\SUMMARY LIST 16<a class="headerlink" href="#summary-list-16" title="Link to this heading"></a></h3>
<blockquote>
<div><p>LIST 16 may be punched with:</p>
</div></blockquote>
</section>
<section id="punch-16">
<h3>\PUNCH 16<a class="headerlink" href="#punch-16" title="Link to this heading"></a></h3>
</section>
</section>
<section id="creating-a-null-list-16">
<h2>Creating a null LIST 16<a class="headerlink" href="#creating-a-null-list-16" title="Link to this heading"></a></h2>
<p>A null LIST 16, containing no restraints, may be created with</p>
<section id="clear-16">
<h3>\CLEAR 16<a class="headerlink" href="#clear-16" title="Link to this heading"></a></h3>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">restrain</span> <span class="n">a</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">distances</span> <span class="n">to</span> <span class="mf">1.5</span> <span class="n">angstrom</span> <span class="k">with</span> <span class="n">an</span>
<span class="n">e</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">d</span><span class="o">.</span> <span class="n">of</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">note</span> <span class="n">the</span> <span class="n">use</span> <span class="n">of</span> <span class="n">symmetry</span> <span class="n">indicators</span><span class="o">.</span>

     <span class="n">DISTANCE</span> <span class="mf">1.5</span> <span class="p">,</span> <span class="mf">0.03</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="n">TO</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
     <span class="n">CONT</span>                  <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">restrain</span> <span class="n">the</span> <span class="n">first</span> <span class="n">distance</span> <span class="n">above</span> <span class="n">explicitly</span><span class="p">,</span> <span class="n">by</span> <span class="n">a</span> <span class="n">user</span> <span class="n">defined</span>
<span class="n">restraint</span>

     <span class="n">RESTRAIN</span> <span class="mf">1.5</span> <span class="p">,</span> <span class="mf">0.03</span> <span class="o">=</span> <span class="n">SQRT</span>
     <span class="n">CONT</span> <span class="p">((</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">))</span><span class="o">*</span><span class="n">G</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
     <span class="n">CONT</span> <span class="o">+</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">))</span><span class="o">*</span><span class="n">G</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
     <span class="n">CONT</span> <span class="o">+</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span><span class="o">*</span><span class="n">G</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
     <span class="n">CONT</span> <span class="o">+</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">))</span><span class="o">*</span><span class="n">G</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
     <span class="n">CONT</span> <span class="o">+</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">))</span><span class="o">*</span><span class="n">G</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
     <span class="n">CONT</span> <span class="o">+</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span><span class="o">*</span><span class="n">G</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
     <span class="n">CONT</span> <span class="o">+</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">X</span><span class="p">))</span><span class="o">*</span><span class="n">G</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
     <span class="n">CONT</span> <span class="o">+</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Y</span><span class="p">))</span><span class="o">*</span><span class="n">G</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
     <span class="n">CONT</span> <span class="o">+</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span><span class="o">*</span><span class="n">G</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="n">restrain</span> <span class="n">some</span> <span class="n">distances</span> <span class="n">to</span> <span class="n">their</span> <span class="n">mean</span>

     <span class="n">DISTANCE</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.03</span> <span class="o">=</span> <span class="n">MEAN</span> <span class="n">O</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">O</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">TO</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
     <span class="n">CONT</span>                       <span class="n">O</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="n">TO</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">O</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span> <span class="n">TO</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">vibration</span> <span class="n">restraints</span> <span class="n">along</span> <span class="n">a</span> <span class="n">bond</span>

     <span class="n">VIBRATION</span> <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.01</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="n">TO</span> <span class="n">O</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
     <span class="n">CONT</span>                  <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">O</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">thermal</span> <span class="n">similarity</span> <span class="n">restraints</span>

     <span class="n">U</span><span class="p">(</span><span class="n">IJ</span><span class="p">)</span>  <span class="mf">0.0</span> <span class="p">,</span> <span class="mf">0.01</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="n">TO</span> <span class="n">O</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
     <span class="n">CONT</span>                <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">O</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">user</span> <span class="n">defined</span> <span class="n">restraints</span> <span class="n">to</span> <span class="n">some</span> <span class="n">of</span> <span class="n">the</span> <span class="n">U</span><span class="p">(</span><span class="n">IJ</span><span class="p">)</span><span class="s1">&#39;S. This might cure a npd</span>
<span class="n">atom</span>

     <span class="n">RESTRAIN</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.01</span><span class="o">=</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">[</span><span class="mi">33</span><span class="p">])</span>
     <span class="n">RESTRAIN</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.01</span><span class="o">=</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
     <span class="n">RESTRAIN</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.01</span><span class="o">=</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
     <span class="n">RESTRAIN</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">0.01</span><span class="o">=</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">[</span><span class="mi">23</span><span class="p">])</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="the-special-restraints-list-17">
<span id="list17"></span><h2>The special restraints  -  LIST 17<a class="headerlink" href="#the-special-restraints-list-17" title="Link to this heading"></a></h2>
<section id="list-17">
<h3>\LIST 17<a class="headerlink" href="#list-17" title="Link to this heading"></a></h3>
<blockquote>
<div><p>LIST 17 is  generated automatically
by the command \SPECIAL (section <a class="reference internal" href="#special"><span class="std std-ref">Special position constraints - \SPECIAL</span></a>),
and is intended to take care of floating
origins and atoms on special positions.
The user may create their own LIST 17, but this will be over written by
SPECIAL unless it this is deactivated.</p>
</div></blockquote>
</section>
</section>
<section id="printing-and-punching-list-17">
<h2>Printing and punching LIST 17<a class="headerlink" href="#printing-and-punching-list-17" title="Link to this heading"></a></h2>
<p>LIST 17 may be printed with:</p>
<section id="print-17">
<h3>\PRINT 17<a class="headerlink" href="#print-17" title="Link to this heading"></a></h3>
<blockquote>
<div><p>or</p>
</div></blockquote>
</section>
<section id="summary-list-17">
<h3>\SUMMARY LIST 17<a class="headerlink" href="#summary-list-17" title="Link to this heading"></a></h3>
<blockquote>
<div><p>It is punched with:</p>
</div></blockquote>
</section>
<section id="punch-17">
<h3>\PUNCH 17<a class="headerlink" href="#punch-17" title="Link to this heading"></a></h3>
</section>
</section>
<section id="creating-a-null-list-17">
<h2>Creating a null LIST 17<a class="headerlink" href="#creating-a-null-list-17" title="Link to this heading"></a></h2>
<p>A null LIST 17, containing no restraints, may be created with</p>
<section id="clear-17">
<h3>\CLEAR 17<a class="headerlink" href="#clear-17" title="Link to this heading"></a></h3>
</section>
</section>
<section id="checking-restraints-check">
<h2>Checking restraints - CHECK<a class="headerlink" href="#checking-restraints-check" title="Link to this heading"></a></h2>
<p>\CHECK LEVEL=
END</p>
<p>\CHECK HI
END</p>
<p>The target values for the restraints can be checked against
the calculated values by issuing the following command :</p>
<section id="check-level">
<h3>\CHECK LEVEL=<a class="headerlink" href="#check-level" title="Link to this heading"></a></h3>
<p><em>LEVEL=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOW</span>      <span class="n">Default</span> <span class="n">value</span>
<span class="n">HIGH</span>
</pre></div>
</div>
<p>This command causes the restraints to be calculated,
but not added into the normal equations.
The observed and calculated values are output to the listing file,
with a summary on the terminal. If the LEVEL is LOW, only restraints
where the calculated value differs significantly from the target are
printed, otherwise all restraints are printed.</p>
<p>If a cycle of refinement is done before issuing the command, the leverages
of all the restraints are calculated and printed on the screen and the lis file.
A leverage of 0 means that the restraint has no influence on the parameter,
a leverage of 1 means that the restraint completely determine the value of the parameter,
a value between 0 and 1 indicate that bot the X-ray data and the restraint contribute to the parameter.</p>
</div></blockquote>
</section>
</section>
<section id="weighting-schemes-for-refinement-list-4">
<span id="list04"></span><span id="index-12"></span><span id="index-11"></span><h2>Weighting schemes for refinement-  LIST 4<a class="headerlink" href="#weighting-schemes-for-refinement-list-4" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">4</span>
<span class="n">SCHEME</span> <span class="n">NUMBER</span><span class="o">=</span> <span class="n">NPARAMETERS</span><span class="o">=</span> <span class="n">TYPE</span><span class="o">=</span> <span class="n">WEIGHT</span><span class="o">=</span> <span class="n">MAXIMUM</span><span class="o">=</span>
<span class="n">PARAMETERS</span> <span class="n">P</span><span class="o">=</span>
<span class="n">END</span>

\<span class="n">LIST</span> <span class="mi">4</span>
<span class="n">SCHEME</span> <span class="mi">14</span> <span class="mi">3</span>
<span class="n">END</span>
</pre></div>
</div>
<p>The weighting of least squares refinement is still very controversial.
The matter is discussed at some length by Schwartzenbach <em>et</em> <em>al</em> in
Statistical Descriptors, and further insights may be gleaned from
Numerical Recipies. Weighting the refinement can serve several purposes,
and the weighting
may need to be changed as the refinement proceeds. The weighting of Fo
and Fsq refinements will be different. To a first approximation,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">w</span><span class="p">(</span><span class="n">Fsq</span><span class="p">)</span> <span class="o">=</span> <span class="n">w</span><span class="p">(</span><span class="n">Fo</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="n">Fo</span>
                        <span class="n">note</span> <span class="n">the</span> <span class="n">problem</span> <span class="k">as</span> <span class="n">Fo</span> <span class="n">approaches</span> <span class="mf">0.0</span>
</pre></div>
</div>
<p>Initially the analyst
must choose a scheme which will hasten the rate of convergence, and
reduce the risk of the refinement falling
into a false minimum.
Towards the end of the refinement, once all the parameters have been
approximately refined, a different scheme will be necessary to generate
reliable parameter s.u.s (e.s.d.s)</p>
<p>My advice (DJW,1996) is
to use unit weights for Fo refinement (1./4Fsq for Fsq refinement) until
the structure is fully parameterised, and then an empirical scheme for
the final refinement. It seems that pure ‘statistical’ weights are
rarely satisfactory. The crucial thing is to look at the analysis of
variance (/ANALYSE). The weighted residual (see definition of Fo’ etc above)
w(Fo’-Fc’)**2 should be invariant for any rational
ranking of the data. If there are any trends, then either the model is
wrong or the estimates of w are wrong. If the model is believed to be
full parameterised and substantially correct, the trend in residual can
be used to estimate the weights.</p>
</section>
<section id="weighting-for-refinement-against-fo">
<h2>Weighting for refinement against Fo<a class="headerlink" href="#weighting-for-refinement-against-fo" title="Link to this heading"></a></h2>
<p>This set of weighting schemes should be selected when
the minimisation function that is to be used during the least squares
process is given by :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SUM</span><span class="p">(</span> <span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">Fo</span> <span class="o">-</span> <span class="n">Fc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
</pre></div>
</div>
<p>Where the summation is over all the reflections.</p>
</section>
<section id="weighting-for-refinement-against-fsq">
<h2>Weighting for refinement against Fsq<a class="headerlink" href="#weighting-for-refinement-against-fsq" title="Link to this heading"></a></h2>
<p>Refinement against Fo or Fsq is also controversial. The controversy is
not really concerned with negative observations, since Fo can be given
the sign of Io. The real problem is that the error distribution for Fo
is not the same as that of Fsq, and is not simply related to it for very
weak reflections. However, the argument is academic, since the error
estimates for Fsq are not really known.</p>
<p>CRYSTALS provides two different alternatives for the case in which the
minimisation function is given by :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SUM</span><span class="p">(</span> <span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">Fo</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Fc</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
</pre></div>
</div>
<p>In the first of these options, the weights are calculated normally for Fo,
and then converted so that they apply to Fsq
by the operation :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">w</span><span class="s1">&#39; = w/(4*Fo*Fo)</span>
</pre></div>
</div>
<p>Where w’ is the weight for Fsq and  w  is the weight for Fo.
This option is selected by the parameter  TYPE  =  1/2Fo
in the  SCHEME  directive above.
For example, pseudo unit weights are selected by the input :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">4</span>
<span class="n">SCHEME</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="n">Fo</span>
<span class="n">END</span>
</pre></div>
</div>
<p>This option may be used with any of the weighting schemes above.</p>
<p>The second option also uses the weighting scheme types for Fo, except
that Fsq is substituted for Fo in the equations.
This option is selected by the parameter  TYPE  =  Fo**2
in the  SCHEME  directive above. This choice would be suitable for the
Chebychev weighting schemes.</p>
<section id="list-4">
<h3>\LIST 4<a class="headerlink" href="#list-4" title="Link to this heading"></a></h3>
<p><strong>SCHEME NUMBER= NPARAMETERS= TYPE= WEIGHT= MAXIMUM=</strong></p>
<p><em>NUMBER</em></p>
<blockquote>
<div><p>The number of the weighting scheme to be used
(see below). The default value is  9 (unit weights).</p>
</div></blockquote>
<p><em>NPARAMETERS=</em></p>
<blockquote>
<div><p>The number of parameters to be provided for the weighting
scheme. The default value is zero,</p>
</div></blockquote>
<p><em>TYPE</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NORMAL</span>
<span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="n">Fo</span>
<span class="n">Fo</span><span class="o">**</span><span class="mi">2</span>
<span class="n">CHOOSE</span>    <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
</pre></div>
</div>
<p>The value of  NORMAL  indicates that the weighting scheme type
is for refinement against Fo.
If  TYPE  is  1/2Fo  or  Fo**2  the weighting scheme type is for
refinement against Fsq (see above).</p>
<p>If TYPE equals CHOOSE, one of the three previous type is chosen depending
on the scheme number and the refinement type set in LIST 23 (structure
factor control, see section <a class="reference internal" href="#list23"><span class="std std-ref">Structure factor calculation control list  -  LIST 23</span></a>).</p>
</div></blockquote>
<p><em>WEIGHT=</em></p>
<blockquote>
<div><p>This parameter determines the weight assigned to reflections during the
determination of Chebychev coefficients.
For each reflection the weight with which it is added into the
Chebychev normal equations is given by :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">W</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">Fo</span><span class="o">**</span><span class="n">WEIGHT</span><span class="p">]</span><span class="o">.</span>
</pre></div>
</div>
<p>Thus if WEIGHT is equal to zero, all the weights will be the same and equal
to  0.5.
The default value is 2.0</p>
</div></blockquote>
<p><em>MAXIMUM=</em></p>
<blockquote>
<div><p>This parameter is used to set the maximum weight that can be applied, and
is usefull for the Dunitz-Seiler scheme (13), and the Chebyshev
schemes (10 and 14).</p>
</div></blockquote>
<p><strong>PARAMETERS P=</strong></p>
<blockquote>
<div><p>The parameters that are to be used to compute the weight for a given
reflection are specified with this directive.</p>
</div></blockquote>
<p><em>P=</em></p>
<blockquote>
<div><p>This directive contains  NPARAMETERS  values. If this parameter is omitted,
default values of zero are assumed for  P.</p>
<p>The parameters must always be provided on the scale of Fo, not
on the scale of Fc.
For example, the agreement analysis programs can work on the scale
of Fc, so that constants derived from such output must be put
on the scale of Fo by multiplying them by the scale factor in LIST 5
(the model parameters).</p>
</div></blockquote>
</section>
</section>
<section id="weights-stored-in-list-6">
<h2>Weights stored in LIST 6<a class="headerlink" href="#weights-stored-in-list-6" title="Link to this heading"></a></h2>
<p>If w is the weight to be applied to a reflection in the least squares
refinement, the value to be stored in LIST 6  (section <a class="reference internal" href="reflectiondata.html#list06"><span class="std std-ref">Simple input of F or Fsq data - LIST 6</span></a>)
is sqrt(w), given the key
SQRTW. If weights are computed by some external utiity, then either is
should generate sqrt(w), or the values be converted after input to
CRYSTALS - see scheme 5 below.</p>
</section>
<section id="weighting-schemes">
<h2>Weighting schemes<a class="headerlink" href="#weighting-schemes" title="Link to this heading"></a></h2>
<p>In the equations and explanations below,  NP  is an
abbreviation of  NPARAMETERS , the number of parameters required
to define the weighting scheme, P(1) is the first such
parameter and P(NP) the last parameter.</p>
<p>The available weighting schemes are :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span>     <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">Fo</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">Fo</span> <span class="o">&lt;</span> <span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OR</span> <span class="n">Fo</span> <span class="o">=</span> <span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
       <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Fo</span><span class="p">,</span> <span class="n">Fo</span> <span class="o">&gt;</span> <span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="mf">2.</span>     <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>      <span class="p">,</span> <span class="n">Fo</span> <span class="o">&lt;</span> <span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OR</span> <span class="n">Fo</span> <span class="o">=</span> <span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
       <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Fo</span><span class="p">,</span> <span class="n">Fo</span> <span class="o">&gt;</span> <span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="mf">3.</span>     <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[(</span><span class="n">Fo</span> <span class="o">-</span> <span class="n">P</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="mf">4.</span>     <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">[</span><span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fo</span> <span class="o">+</span> <span class="n">P</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Fo</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="o">.</span> <span class="o">.</span> <span class="o">+</span> <span class="n">P</span><span class="p">(</span><span class="n">NP</span><span class="p">)</span><span class="o">*</span><span class="n">Fo</span><span class="o">**</span><span class="n">NP</span><span class="p">])</span>

       <span class="k">try</span> <span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">FMIN</span> <span class="ow">and</span> <span class="n">P</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="n">FMAX</span><span class="p">,</span>
       <span class="n">Cruickshank</span><span class="p">,</span> <span class="n">Computing</span> <span class="n">Methods</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">Phase</span>
       <span class="n">Problem</span><span class="p">,</span> <span class="n">Pepinsky</span> <span class="n">et</span> <span class="n">al</span><span class="p">,</span> <span class="mi">1961</span><span class="p">,</span> <span class="n">page</span> <span class="mi">45</span>

<span class="mf">5.</span>     <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">SQRT</span><span class="p">(</span><span class="n">data</span> <span class="k">with</span> <span class="n">the</span> <span class="n">key</span> <span class="s1">&#39;SQRTW&#39;</span> <span class="ow">in</span> <span class="nb">list</span> <span class="mi">6</span><span class="p">)</span>

<span class="mf">6.</span>     <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="k">with</span> <span class="n">the</span> <span class="n">key</span> <span class="s1">&#39;SQRTW&#39;</span> <span class="ow">in</span> <span class="nb">list</span> <span class="mi">6</span><span class="p">)</span>

<span class="mf">7.</span>     <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">SQRT</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">data</span> <span class="k">with</span> <span class="n">the</span> <span class="n">key</span> <span class="s1">&#39;sigma(Fo)&#39;</span> <span class="ow">in</span> <span class="n">LIST</span> <span class="mi">6</span><span class="p">))</span>

<span class="mf">8.</span>     <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">DATA</span> <span class="n">WITH</span> <span class="n">THE</span> <span class="n">KEY</span> <span class="s1">&#39;SIGMA(Fo)&#39;</span> <span class="n">IN</span> <span class="n">LIST</span> <span class="mi">6</span><span class="p">)</span>
                 <span class="o">**</span> <span class="n">remember</span> <span class="n">that</span> <span class="k">for</span> <span class="n">schemes</span> <span class="mi">7</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">LIST</span> <span class="mi">6</span>  <span class="o">**</span>
                 <span class="o">**</span> <span class="n">must</span> <span class="n">store</span> <span class="n">both</span> <span class="n">weight</span> <span class="ow">and</span> <span class="n">sigma</span><span class="o">.</span>        <span class="o">**</span>

<span class="mf">9.</span>     <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="p">(</span><span class="n">Unit</span> <span class="n">weights</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

<span class="mf">10.</span>    <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="s1">&#39;(X) + A[1]*T[1]&#39;</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">.</span> <span class="o">.</span>
                 <span class="o">+</span><span class="n">A</span><span class="p">[</span><span class="n">NP</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">T</span><span class="p">[</span><span class="n">NP</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="s1">&#39;(X)])</span>
                 <span class="n">Chebychev</span> <span class="n">weighting</span> <span class="o">-</span> <span class="n">see</span> <span class="n">below</span> <span class="k">for</span> <span class="n">details</span>

<span class="mf">11.</span>     <span class="n">As</span> <span class="k">for</span> <span class="mi">10</span><span class="p">,</span> <span class="n">but</span> <span class="n">only</span> <span class="n">applying</span> <span class="n">previously</span> <span class="n">determined</span> <span class="n">parameters</span><span class="o">.</span>

<span class="mf">12.</span>    <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">([</span><span class="n">SIN</span><span class="p">(</span><span class="n">THETA</span><span class="p">)</span><span class="o">/</span><span class="n">LAMBDA</span><span class="p">]</span><span class="o">**</span><span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                 <span class="n">If</span>  <span class="n">NP</span>  <span class="ow">is</span> <span class="n">zero</span><span class="p">,</span> <span class="n">a</span> <span class="n">value</span> <span class="n">of</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">assumed</span> <span class="k">for</span> <span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">.</span>

<span class="mf">13.</span>    <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">([</span><span class="n">weight</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">[</span><span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
                 <span class="n">Dunitz</span> <span class="n">Seiler</span> <span class="n">weighting</span> <span class="o">-</span> <span class="n">see</span> <span class="n">below</span> <span class="k">for</span> <span class="n">details</span>

<span class="mf">14.</span>    <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="s1">&#39; * (1. - (delta(F)/ 6* del(F)est)**2)**2)</span>
            <span class="n">W</span><span class="s1">&#39; = 1.0/[A[0]*T[0]&#39;</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="s1">&#39;(X) . .</span>
                 <span class="o">+</span><span class="n">A</span><span class="p">[</span><span class="n">NP</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">T</span><span class="p">[</span><span class="n">NP</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="s1">&#39;(X)]</span>
                  <span class="n">Robust</span><span class="o">-</span><span class="n">resistant</span> <span class="n">refinement</span> <span class="o">-</span> <span class="n">see</span> <span class="n">below</span>

<span class="mf">15.</span>     <span class="n">As</span> <span class="k">for</span> <span class="mi">14</span><span class="p">,</span> <span class="n">but</span> <span class="n">only</span> <span class="n">applying</span> <span class="n">previously</span> <span class="n">determined</span> <span class="n">parameters</span><span class="o">.</span>

<span class="mf">16.</span>     <span class="n">sqrt</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">=</span> <span class="n">Sheldrick</span> <span class="n">SHELX</span><span class="o">-</span><span class="mi">97</span> <span class="n">weights</span> <span class="p">(</span><span class="n">page</span> <span class="mi">7</span><span class="o">-</span><span class="mi">31</span><span class="p">)</span><span class="o">.</span> <span class="n">The</span> <span class="n">P1</span><span class="o">-</span><span class="n">P6</span>
                  <span class="n">correspond</span> <span class="n">to</span> <span class="n">Sheldricks</span> <span class="n">parameters</span> <span class="n">a</span><span class="o">-</span><span class="n">f</span><span class="p">,</span> <span class="n">but</span> <span class="n">are</span> <span class="ow">not</span>
                  <span class="n">refined</span> <span class="n">automatically</span><span class="o">.</span> <span class="n">Fo</span> <span class="ow">and</span> <span class="n">Fc</span> <span class="n">replace</span> <span class="n">Fosq</span> <span class="ow">and</span>
                  <span class="n">Fcsq</span> <span class="k">for</span> <span class="n">Fo</span> <span class="n">refinement</span><span class="o">.</span>
                  <span class="n">Use</span> <span class="mf">0.1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mf">.333</span> <span class="n">to</span> <span class="n">get</span> <span class="n">Sheldrick</span> <span class="n">defaults</span><span class="o">.</span>

<span class="mf">17.</span>    <span class="n">Automatically</span> <span class="n">determine</span> <span class="n">the</span> <span class="n">parameters</span> <span class="k">for</span> <span class="mi">16</span>
</pre></div>
</div>
</section>
<section id="dunitz-seiler-weighting-scheme-13">
<h2>Dunitz Seiler weighting - scheme 13<a class="headerlink" href="#dunitz-seiler-weighting-scheme-13" title="Link to this heading"></a></h2>
<p>S is sin(theta)/lambda, pi is 3.141…  Use p(1) = 1 and
p(2) = 4 to simulate p=3, q=9 in Dunitz and Seiler
Acta(1973),B29,589. Set MAXIMUM to 100. This scheme may be used for
refinement before looking for bonding electrons.</p>
</section>
<section id="chebychev-weighting-schemes-10-11">
<h2>Chebychev weighting schemes 10, 11<a class="headerlink" href="#chebychev-weighting-schemes-10-11" title="Link to this heading"></a></h2>
<p>A[i] are the coefficients of a Chebyshev series in t[i]’(x),
where x = Fo/Fo(max).
(There is an account of CHEBYSHEV series in Computing Methods
in Crystallography, edited by J.S. Rollett, p40).
For this weighting scheme, the coefficients a[i] are calculated
by the program using a least squares procedure which
minimizes sum[(Fo - Fc)**4] over all the reflections.
The resulting coefficients are stored in a new LIST 4
as weighting scheme type 11 (see below),
and then used to calculate the weights
for each of the reflections.
It is recommended that several different values of
NP  are used (e.g 3 to 5), so that series of various orders are tested
to see which gives the best fit. If negative or very small reciprocal
weights are computed (i.e. the computed curve fall close to or crosses
the ordinate axis), the parameter MAXIMUM can be used to restrict the
maximum weight. For data on ‘ordinary’ scales, this will require a value
of about 100.
(This is best seen by computing an agreement analysis
once the new weights have been calculated).
The parameters P(i) need not be given,  because they are to be computed.
When the Chebyshev coefficients have been determined, p(1) is
overwritten by the value determined for a[1]. (Carruthers and Watkin,
Acta Cryst (1979) A35, 698).
Scheme 10 generates the parameters needed for a scheme 11.</p>
</section>
<section id="robust-resistant-weighting-schemes-14-15">
<h2>Robust-resistant weighting schemes 14, 15<a class="headerlink" href="#robust-resistant-weighting-schemes-14-15" title="Link to this heading"></a></h2>
<p>This scheme should only be used towards the end of a refinement, when
all of the expected variables have been introduced.
It is usefull when there is suspicion of uncorrelated but significant
errors in the data, and its effect is similar to scheme 10 in the absence
of such errors.
The expression for W’ is as in Scheme 10 above, except that X is Fc/Fc(max).
This weight is then modified by a function expressing confidence in
Fo-Fc. If the observed delta is large compared with the delta estimated
from the Chebychev fitting, the reflection is down weighted. It it is more
than 6 times the estimate, the weight is set to zero and the reflection
flagged as an ‘OUTLIER’. This scheme is recommended in preference to Scheme
10, which is kept for old times sake. See E. Prince, Mathematical Techniques
in Crystallography, Springer-Verlag, for the background.</p>
</section>
<section id="statistical-weights-16">
<h2>Statistical Weights, 16<a class="headerlink" href="#statistical-weights-16" title="Link to this heading"></a></h2>
<p>This scheme can in principle be introduced at any time, but the
parameters P(i) are best optimised near the end of a refinement.
Typical values for CAD4 data are: p(1)=.001, p(2)=3.0 and p(4)=1.</p>
</section>
<section id="auto-statistical-weights-17">
<h2>Auto-Statistical Weights, 17<a class="headerlink" href="#auto-statistical-weights-17" title="Link to this heading"></a></h2>
<p>This scheme can in principle be introduced at any time, but the
parameters P(i) are best optimised near the end of a refinement.
The parameters are optimised automatically by a grid-search of
the residual as a function of intensity and resolution.</p>
</section>
<section id="printing-list-4">
<h2>Printing LIST 4<a class="headerlink" href="#printing-list-4" title="Link to this heading"></a></h2>
<p>of LIST 4 may be printed with:</p>
<section id="print-4">
<h3>\PRINT 4<a class="headerlink" href="#print-4" title="Link to this heading"></a></h3>
<blockquote>
<div><p>There is no command for punching LIST 4.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Example</span>
     \ <span class="n">Weighting</span> <span class="n">scheme</span> <span class="nb">type</span> <span class="mi">10</span> <span class="p">(</span><span class="n">Chebyshev</span><span class="p">)</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">parameters</span>
     \<span class="n">LIST</span> <span class="mi">4</span>
     <span class="n">SCHEME</span> <span class="n">NUMBER</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span><span class="n">NPARAM</span> <span class="o">=</span> <span class="mi">3</span>
     <span class="n">END</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="weighting-the-reflections-weight">
<h2>Weighting the reflections - WEIGHT<a class="headerlink" href="#weighting-the-reflections-weight" title="Link to this heading"></a></h2>
<p>If the weighting scheme is changed, new weights are automatically
computed for the next structure factor calculation. The computation of
weights can be forced at any time with \WEIGHT.</p>
<section id="weight-input-factor">
<h3>\WEIGHT INPUT= FACTOR=<a class="headerlink" href="#weight-input-factor" title="Link to this heading"></a></h3>
<p><em>INPUT</em></p>
<blockquote>
<div><p>Indicates which reflection list to use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">6</span>      <span class="n">Default</span>
<span class="mi">7</span>      <span class="n">Alternative</span> <span class="n">reflection</span> <span class="nb">list</span>
</pre></div>
</div>
</div></blockquote>
<p><em>FACTOR</em></p>
<blockquote>
<div><p>If FACTOR is less or equal zero, the code tries to compute a value
which will make S (GoF) about unity.  It is important that the GoF
stored in LIST 30 is up to date. The SCRIPT REWEIGHT will try to do this
for you.</p>
<p>If FACTOR is unity, the re-weighting factor is taken from LIST 4.
This is the default action</p>
<p>If FACTOR is greater than zero and not exactly unity,
all weights will be multiplied by this amount.</p>
</div></blockquote>
<p><strong>LIST LEVEL=</strong></p>
<p><em>LEVEL</em></p>
<blockquote>
<div><p>LEVEL is OFF, LOW, MEDIUM or HIGH</p>
</div></blockquote>
</section>
</section>
<section id="reflection-restriction-list-list-28">
<span id="list28"></span><span id="index-16"></span><span id="index-15"></span><span id="index-14"></span><span id="index-13"></span><h2>Reflection restriction list  -  LIST 28<a class="headerlink" href="#reflection-restriction-list-list-28" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">28</span>
<span class="n">MINIMA</span> <span class="n">COEFFICIENT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span> <span class="n">COEFFICIENT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span> <span class="o">...</span>
<span class="n">MAXIMA</span> <span class="n">COEFFICIENT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span> <span class="n">COEFFICIENT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span> <span class="o">...</span>
<span class="n">READ</span> <span class="n">NSLICES</span><span class="o">=</span> <span class="n">NOMISSION</span><span class="o">=</span> <span class="n">NCONDITION</span><span class="o">=</span>
<span class="n">SLICE</span> <span class="n">P</span><span class="o">=</span> <span class="n">Q</span><span class="o">=</span> <span class="n">R</span><span class="o">=</span> <span class="n">S</span><span class="o">=</span> <span class="n">T</span><span class="o">=</span> <span class="n">TYPE</span><span class="o">=</span>
<span class="n">OMIT</span> <span class="n">H</span><span class="o">=</span> <span class="n">K</span><span class="o">=</span> <span class="n">L</span><span class="o">=</span>
<span class="n">CONDITION</span> <span class="n">P</span><span class="o">=</span> <span class="n">Q</span><span class="o">=</span> <span class="n">R</span><span class="o">=</span> <span class="n">S</span><span class="o">=</span> <span class="n">T</span><span class="o">=</span> <span class="n">TYPE</span>
<span class="n">SKIP</span> <span class="n">STEP</span><span class="o">=</span>
<span class="n">END</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">28</span>
<span class="n">MINIMA</span> <span class="n">RATIO</span><span class="o">=</span><span class="mi">3</span>
<span class="n">READ</span> <span class="n">NOMIS</span><span class="o">=</span><span class="mi">1</span>
<span class="n">OMIT</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="n">END</span>
</pre></div>
</div>
<p>LIST 6 (section <a class="reference internal" href="reflectiondata.html#list06"><span class="std std-ref">Simple input of F or Fsq data - LIST 6</span></a>) should contain all the reflections,
including negative ones.
LIST 28 can then be used to dynamically select which ones are to be
omitted from a calculation. Several conditions may be specified, and
ALL the conditions must be satisfied for a reflection to be used,
i.e. the conditions are ANDed  together.</p>
<p>It is also possible to specify individual reflections which
are to be omitted.</p>
<p>TAKE CARE WHEN CHANGING LIST 28. If the conditions are relaxed, reflections
may become acceptable for which Fc and phase have not been recomputed
because they were rejected at an earlier stage. Recompute them all.</p>
<section id="list-28">
<h3>\LIST 28<a class="headerlink" href="#list-28" title="Link to this heading"></a></h3>
<p><strong>MINIMA COEFFICIENT(1)= COEFFICIENT(2)= .  .</strong></p>
<blockquote>
<div><p>This defines the coefficients whose minimum values are
to be restricted.</p>
</div></blockquote>
<p><em>COEFFICIENT=  VALUE</em></p>
<blockquote>
<div><p>Each such parameter defines one coefficient and its minimum value.
The following are known to the system, BUT REMEMBER, with the exception of
(sintheta/lambda)**2, which is computed for each reflection from the cell
parameters, only those coefficients specifically stored in the LIST 6
(see section <a class="reference internal" href="reflectiondata.html#list06"><span class="std std-ref">Simple input of F or Fsq data - LIST 6</span></a>) will have values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">H</span>             <span class="n">K</span>             <span class="n">L</span>             <span class="o">/</span><span class="n">FO</span><span class="o">/</span>
<span class="n">SQRTW</span>         <span class="n">FCALC</span>         <span class="n">PHASE</span>         <span class="n">A</span><span class="o">-</span><span class="n">PART</span>
<span class="n">B</span><span class="o">-</span><span class="n">PART</span>        <span class="n">TBAR</span>          <span class="n">FOT</span>           <span class="n">ELEMENTS</span>
<span class="n">SIGMA</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>      <span class="n">BATCH</span>         <span class="n">INDICES</span>       <span class="n">BATCH</span><span class="o">/</span><span class="n">PHASE</span>
<span class="n">SINTH</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span>    <span class="n">FO</span><span class="o">/</span><span class="n">FC</span>         <span class="n">JCODE</span>         <span class="n">SERIAL</span>
<span class="n">RATIO</span>         <span class="n">THETA</span>         <span class="n">OMEGA</span>         <span class="n">CHI</span>
<span class="n">PHI</span>           <span class="n">KAPPA</span>         <span class="n">PSI</span>           <span class="n">CORRECTIONS</span>
<span class="n">FACTOR1</span>       <span class="n">FACTOR2</span>       <span class="n">FACTOR3</span>       <span class="n">RATIO</span><span class="o">/</span><span class="n">JCODE</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>MAXIMA COEFFICIENT(1) COEFFICIENT(2) .  .</strong></p>
<blockquote>
<div><p>This defines the coefficients whose maximum values are
to be restricted. See MINIMA above.</p>
</div></blockquote>
<p><strong>READ NSLICES= NOMISSION= NCONDITION=</strong></p>
<blockquote>
<div><p>This gives the number of conditional directives to follow.</p>
</div></blockquote>
<p><em>NSLICES</em></p>
<blockquote>
<div><p>This specifies the number of  SLICE directives, default is zero.</p>
</div></blockquote>
<p><em>NOMISSIONS</em></p>
<blockquote>
<div><p>This specifies the number of OMIT directives, default is zero.</p>
</div></blockquote>
<p><em>NCONDITION</em></p>
<blockquote>
<div><p>This specifies the number of  CONDITION directives, default is zero.</p>
</div></blockquote>
<p><strong>SLICE P= Q= R= S= T= TYPE=</strong></p>
<blockquote>
<div><p>This directive selects reflections to those giving
values of (h*p + k*q + l*r) in the range s to t.
The number
of such directives is specified on the  READ  directive above. TYPE
indicates whether the selected reflections are accepted or rejected.</p>
<p>The records are processed in the order given. If a reflection matches
the conditions, the specified action is taken and no further slice
directives are considered. This enables quite fancy intersections to be
specified.</p>
<p>For example, a single layer of
reciprocal points, or a set of adjacent layers, oriented in any
desired crystallographic direction, can be selected.</p>
</div></blockquote>
<p><em>P= Q= R= S= T=</em></p>
<blockquote>
<div><p>These parameters, whose default values are zero, specify selected
slices of reciprocal space.</p>
</div></blockquote>
<p><em>TYPE=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">REJECT</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span> <span class="n">causes</span> <span class="n">rejection</span> <span class="n">of</span> <span class="n">selected</span> <span class="n">reflections</span><span class="o">.</span>
<span class="n">ACCEPT</span>           <span class="n">accepts</span> <span class="n">reflections</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>OMIT H= K= L=</strong></p>
<blockquote>
<div><p>This directive causes the reflection with the indices H, K, and L
to be omitted.</p>
</div></blockquote>
<p><em>H= K= L=</em></p>
<blockquote>
<div><p>These parameters specify the indices of the reflection to be omitted.</p>
</div></blockquote>
<p><strong>CONDITION P= Q= R= S= T= TYPE=</strong></p>
<blockquote>
<div><p>This directive causes selection of reflections giving
values of (h*p + k*q + l*r + s) exact multiples of ‘t’.  TYPE
indicates whether the selected reflections are accepted or rejected.
The number
of such directives is specified on the  READ  directive above.
The records are processed in the order given. If a reflection matches
the conditions, the specified action is taken and no further slice
directives are considered. This enables quite fancy intersections to be
specified.</p>
<p>For example, l odd layers can be rejected by setting
‘r’ and ‘s’ to 1, ‘t’ to 2.</p>
</div></blockquote>
<p><em>P= Q= R= S= T=</em></p>
<blockquote>
<div><p>These parameters, whose default values are zero, specify selected
slices of reciprocal space.</p>
</div></blockquote>
<p><em>TYPE=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">REJECT</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span> <span class="n">causes</span> <span class="n">rejection</span> <span class="n">of</span> <span class="n">selected</span> <span class="n">reflections</span><span class="o">.</span>
<span class="n">ACCEPT</span>           <span class="n">accepts</span> <span class="n">reflections</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>SKIP STEP=</strong></p>
<blockquote>
<div><p>This directive can be used sample the data by skipping through LIST 6,
(reflections, section <a class="reference internal" href="reflectiondata.html#list06"><span class="std std-ref">Simple input of F or Fsq data - LIST 6</span></a>) and may be usefull to speed up
initial refinement.</p>
</div></blockquote>
<p><em>STEP=</em></p>
<blockquote>
<div><p>This is the skip step length, and has a default of 1, i.e. all reflections
are accepted. A value of 3 selects every third reflection for use in
calculations (i.e. 2 out of 3 are skipped).</p>
</div></blockquote>
</section>
</section>
<section id="creating-a-null-list-28">
<h2>Creating a null LIST 28<a class="headerlink" href="#creating-a-null-list-28" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">LIST</span> <span class="mi">28</span>
<span class="n">END</span>
</pre></div>
</div>
<p>Allows all the reflections in LIST 28 to be used.</p>
</section>
<section id="printing-the-contents-of-list-28">
<h2>Printing the contents of LIST 28<a class="headerlink" href="#printing-the-contents-of-list-28" title="Link to this heading"></a></h2>
<p>LIST 28 may be listed by the command :</p>
<section id="print-28">
<h3>\PRINT 28<a class="headerlink" href="#print-28" title="Link to this heading"></a></h3>
<blockquote>
<div><p>There is no command for punching LIST 28.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Example</span> <span class="mi">1</span>
\<span class="n">LIST</span> <span class="mi">28</span>
\ <span class="n">Set</span> <span class="n">the</span> <span class="n">minimum</span> <span class="n">ratio</span> <span class="n">I</span><span class="o">/</span><span class="n">sigma</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="n">to</span> <span class="mf">3.0</span><span class="p">,</span>
\ <span class="n">a</span> <span class="n">maximum</span> <span class="n">Fo</span> <span class="n">to</span> <span class="mi">1000</span>
\ <span class="ow">and</span> <span class="n">omit</span> <span class="n">the</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span> <span class="n">reflection</span>
\
<span class="n">MINIMA</span> <span class="n">Ratio</span><span class="o">=</span><span class="mi">3</span>
<span class="n">MAXIMA</span> <span class="n">Fo</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">READ</span> <span class="n">NOMIS</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">OMIT</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">0</span>
<span class="n">END</span>

<span class="n">Example</span> <span class="mf">2.</span> <span class="n">To</span> <span class="n">reject</span> <span class="n">h</span> <span class="ow">and</span> <span class="n">k</span> <span class="n">simultaneously</span> <span class="n">even</span><span class="p">:</span>

<span class="n">condit</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span> <span class="nb">type</span><span class="o">=</span><span class="n">accept</span>    \<span class="n">lets</span> <span class="n">ALL</span> <span class="k">with</span> <span class="n">h</span> <span class="n">odd</span> <span class="n">through</span>
<span class="n">condit</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span> <span class="nb">type</span><span class="o">=</span><span class="n">accept</span>    \<span class="n">lets</span> <span class="n">ALL</span> <span class="k">with</span> <span class="n">k</span> <span class="n">odd</span> <span class="n">through</span>
<span class="n">condit</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span> <span class="nb">type</span><span class="o">=</span><span class="n">reject</span>        \<span class="n">rejects</span> <span class="n">remaining</span><span class="o">.</span>

<span class="n">Example</span> <span class="mf">3.</span> <span class="n">To</span> <span class="n">reject</span> <span class="nb">all</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span>

<span class="nb">slice</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span> <span class="nb">type</span><span class="o">=</span><span class="n">reject</span>
<span class="nb">slice</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span> <span class="n">t</span><span class="o">=</span><span class="mi">2</span> <span class="nb">type</span><span class="o">=</span><span class="n">reject</span>

<span class="n">Example</span> <span class="mf">4.</span> <span class="n">To</span> <span class="n">reject</span> <span class="nb">all</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span> <span class="n">but</span> <span class="n">keep</span> <span class="n">the</span> <span class="n">l</span><span class="o">=</span><span class="mi">0</span> <span class="n">row</span><span class="p">:</span>

<span class="nb">slice</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span> <span class="nb">type</span><span class="o">=</span><span class="n">accept</span>
<span class="nb">slice</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span> <span class="nb">type</span><span class="o">=</span><span class="n">reject</span>
<span class="nb">slice</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span> <span class="n">t</span><span class="o">=</span><span class="mi">2</span> <span class="nb">type</span><span class="o">=</span><span class="n">reject</span>

<span class="n">Example</span> <span class="mf">5.</span> <span class="n">To</span> <span class="n">only</span> <span class="n">allow</span> <span class="n">specific</span> <span class="n">zones</span><span class="p">,</span> <span class="n">the</span> <span class="n">ones</span> <span class="n">wanted</span> <span class="n">are</span>
<span class="n">selected</span><span class="p">,</span> <span class="ow">and</span> <span class="n">then</span> <span class="n">the</span> <span class="n">rest</span> <span class="n">rejected</span><span class="p">,</span> <span class="n">eg</span> <span class="k">for</span> <span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">:</span>

<span class="nb">slice</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span> <span class="nb">type</span><span class="o">=</span><span class="n">accept</span>              \ <span class="n">accept</span> <span class="n">the</span> <span class="n">h00</span> <span class="n">zone</span>
<span class="nb">slice</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span> <span class="n">r</span><span class="o">=</span><span class="mi">1</span> <span class="n">s</span><span class="o">=-</span><span class="mi">500</span> <span class="n">t</span><span class="o">=</span><span class="mi">500</span> <span class="nb">type</span><span class="o">=</span><span class="n">reject</span> \ <span class="n">reject</span> <span class="n">everything</span> <span class="k">else</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="structure-factor-least-squares-calculations-sfls">
<span id="sfls"></span><span id="index-18"></span><span id="index-17"></span><h2>Structure Factor Least Squares Calculations  -  \SFLS<a class="headerlink" href="#structure-factor-least-squares-calculations-sfls" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">SFLS</span>  <span class="n">INPUT</span><span class="o">=</span>
<span class="n">CALCULATE</span> <span class="n">LIST</span><span class="o">=</span> <span class="n">MAP</span><span class="o">=</span> <span class="o">/</span><span class="n">Fo</span><span class="o">/=</span> <span class="n">THRESHHOLD</span><span class="o">=</span>
<span class="n">SCALE</span> <span class="n">LIST</span><span class="o">=</span> <span class="n">MAP</span><span class="o">=</span> <span class="o">/</span><span class="n">Fo</span><span class="o">/=</span>
<span class="n">REFINE</span> <span class="n">LIST</span><span class="o">=</span> <span class="n">MAP</span><span class="o">=</span> <span class="o">/</span><span class="n">Fo</span><span class="o">/=</span> <span class="n">PUNCH</span><span class="o">=</span> <span class="n">MATRIX</span><span class="o">=</span> <span class="n">MONITOR</span><span class="o">=</span> <span class="n">INVERTOR</span><span class="o">=</span> <span class="n">CALCULATE</span><span class="o">=</span>
<span class="n">SHIFT</span>  <span class="n">KEY</span><span class="o">=</span> <span class="n">KEY</span><span class="o">=</span>
<span class="n">MAXIMUM</span>  <span class="n">KEY</span><span class="o">=</span> <span class="n">KEY</span><span class="o">=</span>
<span class="n">FORCE</span>  <span class="n">KEY</span><span class="o">=</span> <span class="n">KEY</span><span class="o">=</span>
<span class="n">SOLVE</span> <span class="n">MONITOR</span><span class="o">=</span> <span class="n">MA</span><span class="o">=</span><span class="n">P</span> <span class="o">/</span><span class="n">Fo</span><span class="o">/=</span> <span class="n">PUNCH</span><span class="o">=</span> <span class="n">MATRIX</span><span class="o">=</span>
<span class="n">VECTOR</span> <span class="n">MONITOR</span><span class="o">=</span> <span class="n">MAP</span><span class="o">=</span> <span class="o">/</span><span class="n">Fo</span><span class="o">/=</span> <span class="n">PUNCH</span><span class="o">=</span> <span class="n">MATRIX</span><span class="o">=</span>
<span class="n">HUGE</span><span class="o">=</span>
<span class="n">END</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">SFLS</span>
<span class="n">REFINE</span>
<span class="n">REFINE</span>
<span class="n">END</span>
</pre></div>
</div>
</section>
<section id="definitions">
<h2>Definitions<a class="headerlink" href="#definitions" title="Link to this heading"></a></h2>
<p><strong>Minimisation funtion for Fsq</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Minimisation</span> <span class="n">function</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">[</span> <span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">Fo</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Fc</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">]</span>
</pre></div>
</div>
<p><strong>Minmisation function for Fo</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Minimisation</span> <span class="n">function</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">[</span> <span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">Fo</span> <span class="o">-</span> <span class="n">Fc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">]</span>
</pre></div>
</div>
<p><strong>R-factor for Fo</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">Sum</span><span class="p">[</span><span class="o">//</span><span class="n">Fo</span><span class="o">/-/</span><span class="n">Fc</span><span class="o">//</span><span class="p">]</span><span class="o">/</span><span class="n">Sum</span><span class="p">[</span><span class="o">/</span><span class="n">Fo</span><span class="o">/</span><span class="p">]</span>
</pre></div>
</div>
<p>The summation is over all the reflections accepted by LIST 28. This
definition is used for both conventional and F-squared refinement.</p>
<p><strong>R-Factor, Hamilton weighted</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">100</span><span class="o">*</span><span class="n">Sqrt</span><span class="p">(</span><span class="n">Sum</span><span class="p">[</span> <span class="n">w</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="s1">&#39;(i)*D&#39;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">]</span><span class="o">/</span><span class="n">SUM</span><span class="p">[</span> <span class="n">w</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">Fo</span><span class="s1">&#39;(i)*Fo&#39;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">])</span>

<span class="n">Fo</span><span class="s1">&#39; = Fo for normal refinement, Fsq for F-squared refinement.</span>
<span class="n">Fc</span><span class="s1">&#39; = Fc for normal refinement, Fc*Fc for F-squared refinement.</span>
<span class="n">D</span><span class="s1">&#39;  = Fo&#39;</span><span class="o">-</span><span class="n">Fc</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>The weighted R-factor stored in  LIST 6 (section <a class="reference internal" href="reflectiondata.html#list06"><span class="std std-ref">Simple input of F or Fsq data - LIST 6</span></a>) and LIST 30
(section <a class="reference internal" href="initial.html#list30"><span class="std std-ref">Input of General Crystallographic Data - LIST 30</span></a>) is that computed
during a structure factor calculation. The conventional R-factor is
updated by either an SFLS calculation or a SUMMARY of LIST 6.</p>
<p><strong>Minimisation function</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Fo</span><span class="s1">&#39; = Fo for normal refinement, Fo*Fo for F-squared refinement.</span>
<span class="n">Fc</span><span class="s1">&#39; = Fc for normal refinement, Fc*Fc for F-squared refinement.</span>
<span class="n">D</span><span class="s1">&#39;  = Fo&#39;</span><span class="o">-</span><span class="n">Fc</span><span class="s1">&#39;</span>

<span class="n">MINFUNC</span> <span class="o">=</span> <span class="n">Sum</span><span class="p">[</span> <span class="n">w</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
</div>
<p>Good references to the theory and practice of structure factor least squares
are in the chapters by J. S. Rollett and D. W. J.
Cruickshank in Crystallographic Computing, edited by F. R. Ahmed, and
chapters 4, 5 and 6 in Computing Methods in Crystallography, edited by
J. S. Rollett.</p>
</section>
<section id="unstable-refinements">
<h2>Unstable refinements<a class="headerlink" href="#unstable-refinements" title="Link to this heading"></a></h2>
<p>If a refinement ‘blows up’, i.e. diverges rapidly, the user should
seek out the physical cause (wrong space group, pseudo symmetry,
incorrect data processing, disorder, twinning etc). If the cause of the
divergence is simply that the model is too inaccurate, the divergence
can by controlled by limiting the shifts applied in the first few
cycles. The modern way to do this is via ‘shift limiting restraints’
(Marquardt modifier) in LIST 16. An older method was to use partial
shift factors. These are set up by directives to the \SFLS command
(section <a class="reference internal" href="#sfls"><span class="std std-ref">Structure Factor Least Squares Calculations  -  \SFLS</span></a>).</p>
<p>During the solution of the normal equations, the user may specify
that more or less than the whole calculated shift should be
applied.
Alternatively, the program can be instructed to scale the shifts so that
the maximum shift for any parameter group is limited to a given value.
(The  SHIFT ,  MAXIMUM  and  FORCE  directives).</p>
</section>
<section id="sorting-of-list-6-for-structure-factor-calculations">
<h2>Sorting of LIST 6 for structure factor calculations<a class="headerlink" href="#sorting-of-list-6-for-structure-factor-calculations" title="Link to this heading"></a></h2>
<p>During a structure factor least squares calculation, the values
for the real and imaginary parts of  A  and  B  and their derivatives
are computed and stored.
These values are then taken and formed into Fc and its derivatives,
which are added into the normal matrix.
Between reflections, the values for A and B and their derivatives are
retained.
If the next reflection in LIST 6 (section <a class="reference internal" href="reflectiondata.html#list06"><span class="std std-ref">Simple input of F or Fsq data - LIST 6</span></a>) has a set of indices
which are equivalent
to the
last reflection, the same values for the real and imaginary parts of A and B
and their derivatives can be used.</p>
<p>This type of situation can arise either when anomalous scatterers
are present, implying that F(h,k,l) is not equal to F(-h,-k,-l), or
when an extinction parameter is being refined and formally equivalent
reflections have different Fo values and mean path lengths.
In this sort of case, the time for a structure factor calculation
can be significantly reduced if reflections with symmetry related sets
of indices are adjacent in LIST 6, when the conserved values
of A and B can be used repeatedly.</p>
<p>In a similar way,
during a structure factor calculation for a twinned crystal, the
contribution and derivatives for each element are stored as they are
calculated and then combined to produce /FCT/ when all the contributions
have been accumulated.
Between reflections this stored information is retained, so that if the
next reflection contains contributions from elements with the same
indices as the previous reflection,
it is unnecessary to re-compute  the A and B parts.
Obviously,
reflections with common contributors must again be adjacent in LIST 6,
in which case a structure factor calculation, with or without least
squares, takes only slightly longer than the corresponding normal calculation
with the same number of observations.</p>
<section id="id2">
<h3>\SFLS<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<blockquote>
<div><p>The directives are carried out in the order in
which they appear.</p>
<p>The directives  REFINE,  SCALE,  and CALCULATE
initiate cycles of S.F.L.S. calculations. If one of the
directives  SHIFT ,  MAXIMUM  or  FORCE  is given following  REFINE,
a scaled shift will be applied to that cycle of refinement.</p>
</div></blockquote>
<p><strong>SFLS INPUT=</strong></p>
<p><em>INPUT</em></p>
<blockquote>
<div><p>Indicates which reflection list to use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">6</span>      <span class="n">Default</span>
<span class="mi">7</span>      <span class="n">Alternative</span> <span class="n">reflection</span> <span class="nb">list</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>CALCULATE LIST= MAP= /Fo/= THRESHOLD=</strong></p>
<blockquote>
<div><p>If CALCULATE is included with other commands within a single \SFLS
block, it <strong>MUST</strong> <strong>BE</strong> the last command.</p>
<p>This directive indicates that structure factors should be
calculated, but that no refinement of any type should be done.
Structure factors are computed for every reflection and used to compute
R and Rw for all data. R and Rw are also computed for reflections with
I&gt;threshold Sigma(I).  The default value for the threshold is 4.</p>
<p>The directives
SHIFT ,  MAXIMUM  and  FORCE  may not be given before the next
REFINE directive.</p>
</div></blockquote>
<p><em>LIST</em></p>
<blockquote>
<div><p>Controls the listing of reflection information.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OFF</span>   <span class="o">-</span>  <span class="n">Default</span>
<span class="n">MEDIUM</span>
<span class="n">HIGH</span>
</pre></div>
</div>
<p>The value OFF  indicates that the
discrepancy for each reflection <span class="math notranslate nohighlight">\(|F_o-F_c|/F_o\)</span> is computed and if greater than
3*(overall R factor) from the previous cycle of structure factors, a warning
is printed. Only the first 25 such reflections are listed.</p>
<p>If the ENANTIOPOLE parameter is activated in LIST 23 (structure factor
control, see section <a class="reference internal" href="#list23"><span class="std std-ref">Structure factor calculation control list  -  LIST 23</span></a>), sensitive reflections,
for which <span class="math notranslate nohighlight">\(|F_+-F_-| &gt; .05 |F_++F_-|/2\)</span> are also listed.</p>
<p>If  LIST  is  MEDIUM , the structure factors are listed as they
are computed. The output contains h, k, l, <span class="math notranslate nohighlight">\(F_o\)</span>
(on the scale of <span class="math notranslate nohighlight">\(F_c\)</span>), <span class="math notranslate nohighlight">\(F_c\)</span>, the phase and <span class="math notranslate nohighlight">\(\sin\theta/\lambda\)</span>,
the unweighted and weighted delta’s.
(<span class="math notranslate nohighlight">\(F_o - F_c\)</span> or <span class="math notranslate nohighlight">\(F_o^2 - F_c^2\)</span>, depending upon the type of refinement
being done), and information which is useful when anomalous
dispersion effects are present, and contains the real part of <span class="math notranslate nohighlight">\(F_c\)</span> (<span class="math notranslate nohighlight">\(F_c^\prime\)</span>),
the imaginary part of <span class="math notranslate nohighlight">\(F_c\)</span> (<span class="math notranslate nohighlight">\(F_c^{\prime\prime}\)</span>), the computed difference between
<span class="math notranslate nohighlight">\(F_{hkl}^2\)</span> and <span class="math notranslate nohighlight">\(F_{-h-k-l}^2\)</span>, and the calculated or theoretical
Bijvoet ratio (t.b.r.).</p>
<p>When a twinned crystal structure is being refined,  LIST  =  HIGH
gives FoT and /FcT/ in place of Fo and Fc, respectively.
Also, the contributions of each element to each reflection of a twinned
crystal are listed. As well as /FcT/ and the indices,
Fc, multiplied by the square root of the element scale factor, and the
element number are also printed for each component under the column headed
by /FC’/. This option is only obeyed if LIST 13 (section <a class="reference internal" href="initial.html#list13"><span class="std std-ref">Input of the crystal and data collection details  -  LIST 13</span></a>)
indicates that a twinned crystal structure is being refined.</p>
<p>List MEDIUM and HIGH produces one line of output for each reflection.</p>
</div></blockquote>
<p><em>MAP</em></p>
<blockquote>
<div><p>Controls printing of the memory map - mainly used by programmers</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NONE</span>  <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">PART</span>
<span class="n">FULL</span>
</pre></div>
</div>
<p>If  MAP  is  PART , a list of core addresses is printed,
together with any unused locations. If  MAP  is  FULL , the addresses and
contents of the areas of code claimed by each list as it is brought down
are printed on the line printer as the list is loaded.
This option produces reams of output and should never be used
except by programmers.
If  MAP  is  NONE , its default value, a core map is
not printed.</p>
</div></blockquote>
<p><em>/Fo/</em></p>
<blockquote>
<div><p>Controls the treatment of twinned data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FoT</span>        <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">Scaled</span><span class="o">-</span><span class="n">FoT</span>
</pre></div>
</div>
<p>In the refinement of a twinned crystal, if  /Fo/  =  FoT , its
default value, the FoT is output as the data for the key  /Fo/ , the
corresponding /FcT/ is output for  Fc , and the phase is arbitrarily
set to zero. If  /Fo/  is  SCALED-FoT , the data for  Fo ,  Fc
and  PHASE  contain an estimate of the required quantities for the
element in whose reference system the nominal indices are given, i.e.
estimates of the resolved data are produced.</p>
</div></blockquote>
<p><em>THRESHOLD</em></p>
<blockquote>
<div><p>Sets a sigma(I) threshold for computing the restricted Rfactor. The
default value is 4.0</p>
</div></blockquote>
<p><strong>SCALE LIST= MAP= /Fo/=</strong></p>
<blockquote>
<div><p>This directive indicates that structure factors should be calculated
and the overall scale factor should be refined.
The directives
SHIFT ,  MAXIMUM  and  FORCE  may not be given before the next
REFINE directive.</p>
</div></blockquote>
<p><em>LIST</em></p>
<blockquote>
<div><p>This parameter has the same options as for
the  CALCULATE  directive above.</p>
</div></blockquote>
<p><em>MAP</em></p>
<blockquote>
<div><p>This parameter has the same options as for
the  CALCULATE  directive above.</p>
</div></blockquote>
<p><em>Fo</em></p>
<blockquote>
<div><p>This parameter has the same options as for
the  CALCULATE  directive above.</p>
</div></blockquote>
<p><strong>REFINE LIST= MAP= /Fo/= PUNCH= MATRIX= MONITOR= INVERTOR=</strong></p>
<blockquote>
<div><p>This directive indicates a complete structure factor least squares
calculation.</p>
</div></blockquote>
<p><em>LIST</em></p>
<blockquote>
<div><p>This parameter has the same options as for
the  CALCULATE  directive above.</p>
</div></blockquote>
<p><em>MAP</em></p>
<blockquote>
<div><p>This parameter has the same options as for
the  CALCULATE  directive above.</p>
</div></blockquote>
<p><em>Fo</em></p>
<blockquote>
<div><p>This parameter has the same options as for
the  CALCULATE  directive above.</p>
</div></blockquote>
<p><em>PUNCH</em></p>
<blockquote>
<div><p>Controls punching results to files</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>  <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">YES</span>  <span class="o">-</span>  <span class="n">write</span> <span class="n">the</span> <span class="n">model</span> <span class="n">parameters</span> <span class="n">to</span> <span class="n">a</span> <span class="o">*.</span><span class="n">pch</span> <span class="n">file</span>
<span class="n">MATLAB</span>  <span class="o">-</span> <span class="n">write</span> <span class="n">the</span> <span class="n">design</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">normal</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">inversion</span> <span class="ow">and</span> <span class="n">weights</span> <span class="n">to</span> <span class="n">matlabs</span> <span class="n">files</span> <span class="o">*.</span><span class="n">m</span>
<span class="n">TEXT</span>  <span class="o">-</span> <span class="n">write</span> <span class="n">the</span> <span class="n">design</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">normal</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">inversion</span> <span class="ow">and</span> <span class="n">weights</span> <span class="n">to</span> <span class="n">ASCII</span> <span class="n">files</span> <span class="o">*.</span><span class="n">dat</span>
<span class="n">NUMPY</span>  <span class="o">-</span> <span class="n">write</span> <span class="n">numpy</span> <span class="n">files</span> <span class="k">for</span> <span class="n">python</span> <span class="n">plus</span> <span class="n">a</span> <span class="n">python</span> <span class="n">script</span> <span class="k">for</span> <span class="n">the</span> <span class="n">user</span> <span class="n">to</span> <span class="n">use</span>
</pre></div>
</div>
</div></blockquote>
<p><em>MATRIX</em></p>
<blockquote>
<div><p>Controls re-use of the normal matrix</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NEW</span>  <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">OLD</span>
</pre></div>
</div>
<p>If MATRIX is NEW, a new matrix is computed for the current cycle.</p>
<p>If  MATRIX  is  OLD , the left hand side of the normal matrix is not
accumulated during the cycle of refinement. Instead, the version that
already exists is used with the new right hand sides. This option
is particularly useful at the end of a refinement of a large structure
when the left hand side does not change appreciably from cycle to cycle.
It greatly reduces the time for a cycle.</p>
</div></blockquote>
<p><em>MONITOR</em></p>
<blockquote>
<div><p>Controls the shift information printed out.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOW</span>  <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">MEDIUM</span>
</pre></div>
</div>
<p>The MEDIUM listing outputs details about all parameters refined, and lists
the values, shifts and e.s.d.s of all parameters in LIST 5. The LOW
listing outputs information only for those l.s. parameters for which the
SHIFT RATIO exceeds 3.0, and/or the SHIFT/ESD  exceeds 1.0 . Only those
atoms in LIST 5 containing one or more refinable parameters are listed.</p>
</div></blockquote>
<p><em>INVERTOR</em></p>
<blockquote>
<div><p>Six matrix inversion methods are provided.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AUTO</span> <span class="o">-</span> <span class="n">Default</span> <span class="n">value</span> <span class="p">(</span><span class="n">Auto</span><span class="o">-</span><span class="n">adaptive</span> <span class="n">single</span> <span class="n">precision</span><span class="o">/</span><span class="n">double</span> <span class="n">precision</span> <span class="n">LDLT</span> <span class="n">inversion</span><span class="p">)</span>
<span class="n">LDLT</span> <span class="o">-</span> <span class="n">single</span> <span class="n">precision</span> <span class="n">Robust</span> <span class="n">Cholesky</span> <span class="n">decomposition</span> <span class="n">of</span> <span class="n">a</span> <span class="n">matrix</span> <span class="k">with</span> <span class="n">pivoting</span>
<span class="n">EIGENVALUE</span> <span class="o">-</span> <span class="n">Eigenvalue</span> <span class="n">decomposition</span> <span class="o">+</span> <span class="n">filtering</span> <span class="n">on</span> <span class="n">small</span> <span class="n">eigenvalues</span> <span class="n">then</span> <span class="n">inversion</span>
<span class="n">DP_LDLT</span> <span class="o">-</span> <span class="n">double</span> <span class="n">precision</span> <span class="n">Robust</span> <span class="n">Cholesky</span> <span class="n">decomposition</span> <span class="n">of</span> <span class="n">a</span> <span class="n">matrix</span> <span class="k">with</span> <span class="n">pivoting</span>
<span class="n">XCHOLESKY</span> <span class="o">-</span> <span class="n">original</span> <span class="n">crystals</span> <span class="n">Cholesky</span> <span class="n">decomposition</span>
<span class="n">CHOLESKY</span> <span class="o">-</span> <span class="n">Standard</span> <span class="n">Cholesky</span> <span class="n">inversion</span>
</pre></div>
</div>
<p>The AUTO method is suitable for most problem including moderatly ill condition problems.
Crystals will switch automatically from single precision to double precision for the inversion when needed.
The eigenvalue decomposition should be used with care, the XCHOLESKY method is kept for historical purpose,
The LDLT and DP_LDLT can be use to forced crystals to use single or double precision. Beware of precision loss
in single precision. The CHOLESKY method is deprecated.</p>
</div></blockquote>
<p><strong>SHIFT  KEY = VALUE  KEY = VALUE .  .  .  .</strong></p>
<blockquote>
<div><p>This directive sets the shift factor for the specified cycle of
refinement. (The shift factor is the amount by which the calculated
shift is multiplied before it is applied to generate the new parameters).
For each of the parameters given by the  KEYS  on the directive,
the shift factor is changed to the value given by  VALUE.
The  =  sign is not optional.</p>
<p>If more
than one shift directive ( SHIFT ,  MAXIMUM  or  FORCE ) is given for
the same parameter, only the last is obeyed.</p>
<p>The following  KEYS  are recognized :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GENERAL</span>   <span class="n">This</span> <span class="n">refers</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">atomic</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">and</span> <span class="n">element</span> <span class="n">parameters</span>
<span class="n">OVERALL</span>   <span class="n">This</span> <span class="n">refers</span> <span class="n">to</span> <span class="n">the</span> <span class="n">overall</span> <span class="n">parameters</span>

<span class="n">OCC</span>     <span class="n">U</span><span class="p">[</span><span class="n">ISO</span><span class="p">]</span>      <span class="n">X</span>       <span class="n">Y</span>       <span class="n">Z</span>
<span class="n">U</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>   <span class="n">U</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span>   <span class="n">U</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span>   <span class="n">U</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span>   <span class="n">U</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>   <span class="n">U</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
<span class="n">SPISO</span>   <span class="n">SPSIZE</span>  <span class="n">LINISO</span>  <span class="n">LINSIZE</span> <span class="n">LINDEC</span>  <span class="n">LINAZI</span>
<span class="n">RINGISO</span> <span class="n">RINGSIZ</span> <span class="n">RINGDEC</span> <span class="n">RINGAZI</span>
</pre></div>
</div>
<p>This is the default for GENERAL, OVERALL and
SPECIAL parameters, with default shift factors 1.0.</p>
</div></blockquote>
<p><strong>MAXIMUM  KEY = VALUE  KEY = VALUE .  .  .  .</strong></p>
<blockquote>
<div><p>This directive is similar to the directive  SHIFT  above, except that the
maximum shift that is applied for the given parameters cannot be
greater than  VALUE. The units of  VALUE  are conventional,
WITH x, y, z measured in angstrom, and ADPs in Angstrom sq. If none of
the shifts exceend VALUE, then they are applied unmodified.
This provides a
method of automatically scaling down the applied shifts if the matrix
inversion has become unstable. Shift limiting restraints (LIST 16) are a
more controlled alternative</p>
<p>The KEYS are the same as in SHIFT above, and this is the default
action for Occ, adps and positions, with maximal values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OCC</span> <span class="mf">1.0</span>
<span class="n">U</span><span class="o">*</span>  <span class="mf">0.05</span> <span class="p">(</span><span class="n">Angstrom</span> <span class="n">sq</span><span class="p">)</span>
<span class="n">X</span><span class="s1">&#39;s 1.0  (Angstom)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>FORCE  KEY = VALUE  KEY = VALUE .  .  .  .</strong></p>
<blockquote>
<div><p>This is similar to MAXIMUM  above, except that the
maximum shift is scaled to VALUE even if it is less than VALUE.</p>
<p>The KEYS are the same as in SHIFT above. There is no default
shift.</p>
</div></blockquote>
<p><strong>VECTOR MONITOR MAP Fo PUNCH MATRIX</strong></p>
<blockquote>
<div><p>This is an obsolete feature, and will be removed at a later date.</p>
<p>This directive indicates that structure factors are to be calculated
and then the shift vector stored in LIST 24 (see <a class="reference internal" href="#list24"><span class="std std-ref">Least squares shift list  -  LIST 24</span></a>) is to be applied.
This is used to apply a shift vector calculated from one of
the eigenvalues of the normal matrix. Although no new matrix is produced
by this directive, sufficient space must be allocated for the normal
matrix, since it is loaded when the new coordinates are calculated.</p>
</div></blockquote>
<dl>
<dt><em>HUGE</em></dt><dd><p>This directive tuned the refinement for big structures. It performs the
the normal matrix accumulation in single precision,
the accumulation of the right and side is also done in single precision.
The inversion is still using double precision but with a
Cholesky decomposition faster than the default auto-adaptive LDL^t decomposition.
Bigger structures tend to be more ill-conditioned so inversion needs to be done in double precision.
These changes could potentially lead to a less stable refinement but it is unlikely,
the default refinement is just very conservative.</p>
</dd>
<dt><em>CALCULATE</em></dt><dd><p>LEVERAGES  - CALCULATE the leverages and t-values. Warning: shifts are not applied in this case;
default output is numpy but can be changed to TEXT using PUNCH. MATLAB and pch is not supported at the moment.</p>
<p>This directive CALCULATE is differente from the previous directive and is applied under REFINE.</p>
</dd>
<dt><em>P1</em></dt><dd><p>Parameter passed to CALCULATE (see Above).</p>
<p>If CALCULATE=LEVERAGES then P1 is the parameter number on which the leverages are calculated.</p>
</dd>
</dl>
<p><em>MONITOR</em></p>
<blockquote>
<div><p>This parameter has the same options as for
the  CALCULATE  directive above.</p>
</div></blockquote>
<p><em>MAP</em></p>
<blockquote>
<div><p>This parameter has the same options as for
the  CALCULATE  directive above.</p>
</div></blockquote>
<p><em>Fo</em></p>
<blockquote>
<div><p>This parameter has the same options as for
the  CALCULATE  directive above.</p>
</div></blockquote>
<p><em>PUNCH</em></p>
<blockquote>
<div><p>This parameter has the same options as for
the  REFINE directive above.</p>
</div></blockquote>
<p><em>MATRIX</em></p>
<blockquote>
<div><p>This parameter has the same options as for
the  REFINE  directive above.</p>
</div></blockquote>
</section>
</section>
<section id="processing-of-the-refinement-directives">
<h2>Processing of the refinement directives<a class="headerlink" href="#processing-of-the-refinement-directives" title="Link to this heading"></a></h2>
<p>The program expands the CALCULATE, SCALE or REFINE directives into
sub-directives. These sub-directives <strong>MUST</strong> <strong>NOT</strong> be
given by a user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span>   \<span class="n">REFINE</span>
                 <span class="n">Compute</span> <span class="n">structure</span> <span class="n">factors</span> <span class="ow">and</span>
                 <span class="n">derivatives</span><span class="o">.</span> <span class="n">No</span> <span class="n">refinement</span> <span class="ow">is</span>
                 <span class="n">actually</span> <span class="n">done</span><span class="o">.</span>
<span class="mf">2.</span>   \<span class="n">SCALE</span>
                 <span class="n">Calculate</span> <span class="n">structure</span> <span class="n">factors</span> <span class="ow">and</span>
                 <span class="n">refine</span> <span class="n">the</span> <span class="n">overall</span> <span class="n">scale</span> <span class="n">factor</span><span class="o">.</span>
<span class="mf">3.</span>   \<span class="n">CALCULATE</span>
                 <span class="n">Calculate</span> <span class="n">structure</span> <span class="n">factors</span><span class="o">.</span>
<span class="mf">4.</span>   \<span class="n">RESTRAIN</span>
                 <span class="n">Apply</span> <span class="n">the</span> <span class="n">restraints</span> <span class="n">stored</span> <span class="ow">in</span>
                 <span class="n">the</span> <span class="n">current</span> <span class="n">lists</span> <span class="mi">16</span> <span class="ow">and</span> <span class="mf">17.</span>
<span class="mf">5.</span>   \<span class="n">INVERT</span>
                 <span class="n">Invert</span> <span class="n">the</span> <span class="n">current</span> <span class="n">normal</span> <span class="n">matrix</span>
                 <span class="ow">and</span> <span class="n">store</span> <span class="n">a</span> <span class="n">shift</span> <span class="nb">list</span> <span class="k">as</span> <span class="nb">list</span> <span class="mf">24.</span>
<span class="mf">6.</span>   \<span class="n">SOLVE</span>
                 <span class="n">Take</span> <span class="n">the</span> <span class="n">current</span> <span class="nb">list</span> <span class="mi">5</span> <span class="p">(</span><span class="n">the</span> <span class="n">model</span> <span class="n">parameters</span><span class="p">)</span>
                 <span class="ow">and</span> <span class="n">apply</span> <span class="n">the</span> <span class="n">shifts</span> <span class="n">given</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">current</span>
                 <span class="nb">list</span> <span class="mf">24.</span>
<span class="mf">7.</span>   \<span class="n">NEWSHIFTS</span>
                 <span class="n">Allocate</span> <span class="n">space</span> <span class="k">for</span> <span class="nb">list</span> <span class="mf">24.</span>
<span class="mf">8.</span>   \<span class="n">CYCLENDS</span>
</pre></div>
</div>
</section>
<section id="analysis-of-residuals-analyse">
<span id="index-20"></span><span id="index-19"></span><h2>Analysis of residuals -  \ANALYSE<a class="headerlink" href="#analysis-of-residuals-analyse" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">ANALYSE</span> <span class="n">INPUT</span><span class="o">=</span>
<span class="n">FO</span> <span class="n">INTERVAL</span><span class="o">=</span> <span class="n">TYPE</span><span class="o">=</span> <span class="n">SCALE</span><span class="o">=</span>
<span class="n">THETA</span> <span class="n">INTERVAL</span><span class="o">=</span>
<span class="n">LIST</span> <span class="n">LEVEL</span><span class="o">=</span>
<span class="n">LAYERSCALE</span> <span class="n">AXIS</span><span class="o">=</span> <span class="n">APPLY</span><span class="o">=</span> <span class="n">ANALYSE</span><span class="o">=</span>
<span class="n">END</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">ANALYSE</span>
<span class="n">LIST</span> <span class="n">HIGH</span>
<span class="n">END</span>
</pre></div>
</div>
<p>ANALYSE provides a comparison between Fo and Fc as a
function of the indices, various parity groups, ranges of F and
ranges of sin(theta)/lambda. For a well refined structure with suitable
weights, &lt;Fo&gt;/&lt;Fc&gt; should be about unity for all ranges, and &lt;wdeltasq&gt;
should also be about unity for all ranges. A serious imbalance in Fo/Fc
may mean the structure is incomplete, or unsuitable data reduction
(section <a class="reference internal" href="reflectiondata.html#datareduc"><span class="std std-ref">Data Reduction - Lp</span></a>). A
systemstic trend in &lt;wdeltasw&gt; may mean unsuitable weights are being
used.</p>
<p>The monitor listing is always just as a funtion of F. The output to
the listing file is user controlled.</p>
<p>This routine will also compute approximate layer scale factors for
data which has been collected by layers. These can be refined in the
least squares to complete a refinement.</p>
<section id="analyse-input">
<h3>\ANALYSE INPUT=<a class="headerlink" href="#analyse-input" title="Link to this heading"></a></h3>
<p><em>INPUT</em></p>
<blockquote>
<div><p>Indicates which reflection list to use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">6</span>      <span class="n">Default</span>
<span class="mi">7</span>      <span class="n">Alternative</span> <span class="n">reflection</span> <span class="nb">list</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>FO INTERVAL= TYPE= SCALE=</strong></p>
<blockquote>
<div><p>Controls the analysis as a function of F.</p>
</div></blockquote>
<p><em>INTERVAL=</em></p>
<blockquote>
<div><p>The interval between successive ranges of F.
Its value should be determined in combination with the
parameter  TYPE.</p>
</div></blockquote>
<p><em>TYPE</em></p>
<blockquote>
<div><p>Controls how F is sampled.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqrt</span><span class="p">(</span><span class="n">Fc</span><span class="p">)</span>  <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">Fc</span>
<span class="n">sqrt</span><span class="p">(</span><span class="n">Fo</span><span class="p">)</span>
<span class="n">Fo</span>
</pre></div>
</div>
<p>If  TYPE  is  sqrt(Fc),
(its default value), the interval between successive F ranges is based
on ‘the square root of Fc’ Values of Fc in the interval
‘0 to INTERVAL**2’ will be analysed in the first range, Fc values that lie
in the range INTERVAL**2 to 4*INTERVAL**2 in the second and so on).
INTERVAL  is thus the increment in the square root of Fc between
successive ranges and, in this case, has a default value of 1.
If  TYPE  is  Fc , the interval between successive Fc ranges is
based on the value of Fc. In this case  INTERVAL  is the increment
in Fc and has a default value of 2.5.</p>
</div></blockquote>
<p><em>SCALE</em></p>
<blockquote>
<div><p>Controls the scale of the listing</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Fo</span>  <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">Fc</span>
</pre></div>
</div>
<p>If  SCALE  is  Fo, the reflection information
is printed on the scale of Fo.
(This is useful as the weighting parameters in LIST 4 (section <a class="reference internal" href="#list04"><span class="std std-ref">Weighting schemes for refinement-  LIST 4</span></a>)
must be provided on the scale of Fo).
If  SCALE  is  Fc, the reflection information is printed on the scale
of Fc.</p>
</div></blockquote>
<p><strong>THETA INTERVAL=</strong></p>
<blockquote>
<div><p>This directive determines the interval between successive
sin(theta)/lambda squared ranges.</p>
</div></blockquote>
<p><em>INTERVAL=</em></p>
<blockquote>
<div><p>The default is 0.04.</p>
</div></blockquote>
<p><strong>LAYERSCALE AXIS= APPLY= ANALYSE=</strong></p>
<blockquote>
<div><p>This directive allows the results of layer scaling to be
investigated.</p>
</div></blockquote>
<p><em>AXIS=</em></p>
<blockquote>
<div><p>Selects the axis for layer scaling</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NONE</span>  <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">H</span>
<span class="n">K</span>
<span class="n">L</span>
</pre></div>
</div>
<p>The default value of  NONE  indicates that no layer scaling is to be
done.  H,  K  and  L  indicate the axes up which layer scaling
is to be done.</p>
</div></blockquote>
<p><em>APPLY=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>   <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
<span class="n">YES</span>
</pre></div>
</div>
<p>When layer scaling has been completed and the results printed,
the calculated scale factors will be applied to the stored Fo data
if  APPLY  is  YES . If  APPLY  is  NO , its default setting,
then the new scales will not be applied to the data.
If  AXIS  is  NONE , then  APPLY  is ignored.</p>
</div></blockquote>
<p><em>ANALYSE</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span>
<span class="n">YES</span>  <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
</pre></div>
</div>
<p>If  ANALYSE  is  YES, a second agreement analysis
will be performed after the layer scaling so that the results of the
new scales can be seen. (This is true whether the new scales are
applied or not, i.e. independent of the value of  APPLY ).
In this way the effects of layer scaling can be seen without damaging
the data. If  ANALYSE  is  NO , the second agreement analysis is
suppressed.</p>
</div></blockquote>
<p><strong>LIST LEVEL=</strong></p>
<blockquote>
<div><p>This directive determines the amount of output produced.</p>
</div></blockquote>
<p><em>LEVEL=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HIGH</span>
<span class="n">LOW</span>   <span class="o">-</span>  <span class="n">Default</span> <span class="n">value</span>
</pre></div>
</div>
<p>If LEVEL is LOW the  analysis is against Fo and sin theta only.</p>
</div></blockquote>
</section>
</section>
<section id="least-squares-absorption-correction-difabs">
<span id="difabs"></span><span id="index-22"></span><span id="index-21"></span><h2>Least squares absorption correction  - \DIFABS<a class="headerlink" href="#least-squares-absorption-correction-difabs" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">DIFABS</span>  <span class="n">ACTION</span><span class="o">=</span> <span class="n">MODE</span><span class="o">=</span> <span class="n">INPUT</span><span class="o">=</span>
<span class="n">CORRECTION</span> <span class="n">THETA</span><span class="o">=</span>
<span class="n">DIFFRACTION</span> <span class="n">GEOMETRY</span><span class="o">=</span> <span class="n">MODE</span><span class="o">=</span>
<span class="n">END</span>

\<span class="n">DIFABS</span> <span class="n">ACTION</span><span class="o">=</span><span class="n">NEW</span> <span class="n">MODE</span><span class="o">=</span><span class="n">FC</span>
<span class="n">END</span>
</pre></div>
</div>
<p>Although this is a least squares fitting technique for an arbitary
model, it does not form part of the main refinement module. The DIFABS
parameters cannot be refined simultaneously with the atomic parameters.</p>
<p>A low order term Fourier series is used to model an absorption surface for
differences between the observed structure factors and those obtained from a
structure factor calculation after isotropic least squares refinement.</p>
<p>For SERIAL diffractometrs (e.g. CAD4)
Spherical polar angles are used to define the incident and diffracted
beam path
directions so that each reflection is characterised by four angles - viz.
PHI(p),
MU(p), PHI(s), and MU(s).  A theta-dependent correction is evaluated to allow
for diffracted beams with different path lengths occurring at the same polar
angles.  A low order term Fourier series is used in Bragg angle THETA,
but is highly correlated with the temperature factors, and not normally
recommended.
This version is general for any SERIAL diffractometer data collection
geometry.</p>
<p>For AREA detector diffractometers equivalent reflections are usually
measured at different setting angles and then averaged.
The concept of incident and emergent beams has no meaning for merged
data, so instead DIFABS computes the azimuth and declination of the
scattering vector.  This cannot be reliably used as the basis for a
correction, but the “absorption” surface is a measure of the mis-match
between Fo and Fc.</p>
<p>The quantity minimised is the sum of the squares of the residuals, Rj, where</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Rj</span> <span class="o">=</span> <span class="p">(</span> <span class="o">//</span><span class="n">Fc</span><span class="o">/-/</span><span class="n">Fo</span><span class="o">//</span><span class="p">)</span><span class="n">wj</span>
</pre></div>
</div>
<p>The weighting function, wj, used is derived from the overall scale factor,
the counting statistics standard deviation, and the Lorentz-polarisation
factor.</p>
<p>In the original implementation, the correction factor was applied to
Fo. This lead to criticism in the literature that the observations were
being tampered with. In the current implementaion in CRYSTALS, the
correction can be applied to Fo or Fc.</p>
<p>References:
N. Walker and D. Stuart, 1983, Acta Cryst., A39, 158 - 166.
The code is incorporated with the permission of Dr N. Walker</p>
<p>Implementation</p>
<p>The correction is evaluated using observed structure factors, /Fo/, corrected
for Lorentz-polarisation effects and any decay in intensity standards during
data collection, with systematically absent reflections removed. Since
equivalent reflections will be measured at different diffractometer
settings, the  correction should be  calculated and  applied to the data set
without any transformation of the reflection indices, and without
symmetry- equivalent or Friedel-pair reflections being averaged.
Calculated  amplitudes must be obtained from  the  isotropic
refinement of an as-complete a model as practical from the unique (merged)
data set. Such a LIST 6 (reflections, section <a class="reference internal" href="reflectiondata.html#list06"><span class="std std-ref">Simple input of F or Fsq data - LIST 6</span></a>) will probably be
unsuitable for Fourier or
difference maps (since these expect a unique segment of data only) unless
you then remerge the data. The best maps must be computed
with the correction applied to Fo before the data is merged.  In addition,
the most reliable merging R factor (Rint) must be computed from
corrected Fos.</p>
<p><strong>WARNING</strong></p>
<p>To use DIFABS most successfully, you should probably do data-reduction
again from scratch, inhibiting the merging of all but exactly equivalent
reflections.</p>
<p>In favourable cases, when the observed data is the unique segment plus a
small redundant volume (e.g. often the -1 layers at Oxford), you may get away
with applying the correction to normally (merged) processed data during
structure development.</p>
<p>Once the structure is fully developed (ie all atoms found
and partially refined with an extinction correction if necessary), data
reduction should be repeated inhibiting all index transformations.
New values of Fc must be computed from
isotropic atoms (Use UEQUIV in \EDIT to recover equivalent isotropic
temperature factors, and then do a few cylces of isotropic refinement)
and the DIFABS correction applied to Fc. Anisotropic refinement can be
computed to completion (including optimisation of weights) using
unmerged data. If you wish to see an  absorption correctd Rint
and compute a final difference map, the data must be re-merged. Use
DIFABS with MODE = TRANSFER to move the correction onto Fo before
transforming indices, sorting and merging the data.</p>
<section id="difabs-action-mode-input">
<h3>\DIFABS  ACTION= MODE= INPUT=<a class="headerlink" href="#difabs-action-mode-input" title="Link to this heading"></a></h3>
<p><em>INPUT</em></p>
<blockquote>
<div><p>Indicates which reflection list to use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">6</span>      <span class="n">Default</span>
<span class="mi">7</span>      <span class="n">Alternative</span> <span class="n">reflection</span> <span class="nb">list</span>
</pre></div>
</div>
</div></blockquote>
<p><em>ACTION=</em></p>
<blockquote>
<div><p>Controls the action on LIST 6 (reflections, section <a class="reference internal" href="reflectiondata.html#list06"><span class="std std-ref">Simple input of F or Fsq data - LIST 6</span></a>), and
has three values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span>   <span class="o">-</span>   <span class="n">Computes</span> <span class="n">the</span> <span class="n">correction</span><span class="p">,</span> <span class="n">but</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">apply</span> <span class="n">it</span>
<span class="n">UPDATE</span> <span class="o">-</span>   <span class="n">Tries</span> <span class="n">to</span> <span class="n">update</span> <span class="n">LIST</span> <span class="mi">6</span>
<span class="n">NEW</span>    <span class="o">-</span>   <span class="n">DEFAULT</span><span class="o">.</span> <span class="n">Creates</span> <span class="n">new</span> <span class="n">LIST</span> <span class="mi">6</span>
</pre></div>
</div>
<p>If UPDATE is specified, the stored values of Fo are over written. If
NEW is specified, a new LIST 6 is written to disc. The
disc will be extended sufficiently to accommodate the new list.</p>
</div></blockquote>
<p><em>MODE=</em></p>
<blockquote>
<div><p>Controls the mode of application of the correction, and
has three values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FO</span>        <span class="o">-</span> <span class="n">Applies</span> <span class="n">the</span> <span class="n">correction</span> <span class="n">to</span> <span class="n">Fo</span>
<span class="n">FC</span>        <span class="o">-</span> <span class="n">Applies</span> <span class="n">the</span> <span class="n">correction</span> <span class="n">to</span> <span class="n">Fc</span>
<span class="n">TRANSFER</span>  <span class="o">-</span> <span class="n">Applies</span> <span class="n">the</span> <span class="n">inverse</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Fc</span> <span class="n">correction</span> <span class="n">to</span> <span class="n">Fo</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>CORRECTION THETA=</strong></p>
<blockquote>
<div><p>Controls whether a theta-dependent correction is to be
applied. - NOT RECOMMENDED.</p>
</div></blockquote>
<p><em>THETA=</em></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NO</span> <span class="o">-</span> <span class="n">Default</span> <span class="n">value</span>
<span class="n">YES</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>DIFFRACTION GEOMETRY= MODE=</strong></p>
<blockquote>
<div><p>Controls the geometry used for data collection to be input.</p>
</div></blockquote>
<p><em>GEOMETRY=</em></p>
<blockquote>
<div><p>The type of diffractometer used is specified:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CAD4</span>          <span class="o">-</span> <span class="n">Default</span> <span class="n">value</span>
<span class="n">SYNTEX</span><span class="o">-</span><span class="n">P1</span>
<span class="n">SYNTEX</span><span class="o">-</span><span class="n">P21</span>
<span class="n">PICKER</span>        <span class="o">-</span> <span class="n">Picker</span> <span class="n">FACS</span><span class="o">-</span><span class="n">I</span>
<span class="n">PW1100</span>        <span class="o">-</span> <span class="n">Philips</span> <span class="n">PW1100</span>
<span class="n">AREA</span>          <span class="o">-</span> <span class="n">Any</span> <span class="n">Area</span> <span class="n">detector</span> <span class="n">instrument</span>
</pre></div>
</div>
</div></blockquote>
<p><em>MODE=</em></p>
<blockquote>
<div><p>The mode of data collection is given:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BISECTING</span>      <span class="o">-</span> <span class="n">Default</span> <span class="n">value</span>
<span class="n">PARALLEL</span>
<span class="n">GENERAL</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="n">example</span> <span class="n">assumes</span> <span class="n">that</span> <span class="n">there</span> <span class="n">are</span> <span class="n">no</span> <span class="n">equivalent</span> <span class="n">reflections</span><span class="o">.</span>
     \<span class="n">DIFABS</span>
     <span class="n">DIFFRACTION</span> <span class="n">GEOMETRY</span><span class="o">=</span><span class="n">SYNTEX</span><span class="o">-</span><span class="n">P1</span>
     <span class="n">END</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="n">example</span> <span class="n">demonstrates</span> <span class="n">a</span> <span class="n">total</span> <span class="n">re</span><span class="o">-</span><span class="n">processing</span> <span class="n">of</span> <span class="n">the</span> <span class="n">data</span><span class="p">,</span> <span class="n">including</span>
<span class="n">converting</span> <span class="n">atoms</span> <span class="n">to</span> <span class="n">isotropic</span> <span class="k">if</span> <span class="n">they</span> <span class="n">have</span> <span class="n">previously</span> <span class="n">been</span> <span class="n">refined</span>
<span class="n">anisotropically</span><span class="o">.</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">a</span> <span class="n">theta</span> <span class="n">dependent</span> <span class="n">correction</span> <span class="kn">from</span>
<span class="nn">International</span> <span class="n">Tables</span> <span class="ow">is</span> <span class="n">applied</span> <span class="n">during</span> <span class="n">data</span> <span class="n">reduction</span><span class="o">.</span> <span class="n">The</span> <span class="n">theta</span>
<span class="n">dependant</span> <span class="n">correction</span> <span class="ow">in</span> <span class="n">DIFABS</span> <span class="ow">is</span> <span class="n">ill</span><span class="o">-</span><span class="n">conditioned</span> <span class="ow">and</span> <span class="n">unstable</span><span class="o">.</span>

     \ <span class="n">save</span> <span class="n">the</span> <span class="n">contents</span> <span class="n">of</span> <span class="n">the</span> <span class="n">old</span> <span class="n">dsc</span> <span class="n">file</span>
     \<span class="n">PURGE</span> <span class="n">NEW</span>
     <span class="n">END</span>
     \ <span class="n">Connect</span> <span class="n">the</span> <span class="n">reflection</span> <span class="n">file</span> <span class="n">to</span> <span class="n">HKLI</span>
     \<span class="n">OPEN</span> <span class="n">HKLI</span> <span class="n">ZNCPD</span><span class="o">.</span><span class="n">HKL</span>
     \ <span class="n">Use</span> <span class="n">an</span> \<span class="n">HKLI</span> <span class="n">command</span> <span class="n">to</span> <span class="n">apply</span> <span class="n">the</span> <span class="n">tabulated</span> <span class="n">theta</span> <span class="n">correction</span>
     \<span class="n">HKLI</span>
     <span class="n">READ</span> <span class="n">NCOEF</span><span class="o">=</span><span class="mi">12</span> <span class="n">FORMAT</span><span class="o">=</span><span class="n">FIXED</span> <span class="n">UNIT</span><span class="o">=</span><span class="n">HKLI</span> <span class="sa">F</span><span class="s1">&#39;S=FSQ CHECK=NO</span>
     <span class="n">INPUT</span> <span class="n">H</span> <span class="n">K</span> <span class="n">L</span> <span class="o">/</span><span class="n">FO</span><span class="o">/</span> <span class="n">SIGMA</span><span class="p">(</span><span class="o">/</span><span class="n">FO</span><span class="o">/</span><span class="p">)</span> <span class="n">JCODE</span> <span class="n">SERIAL</span> <span class="n">BATCH</span> <span class="n">THETA</span> <span class="n">PHI</span> <span class="n">OMEGA</span> <span class="n">KAPPA</span>
     <span class="n">FORMAT</span> <span class="p">(</span><span class="mi">5</span><span class="n">X</span><span class="p">,</span><span class="mi">3</span><span class="n">F4</span><span class="mf">.0</span><span class="p">,</span><span class="n">F9</span><span class="mf">.0</span><span class="p">,</span><span class="n">F7</span><span class="mf">.0</span><span class="p">,</span><span class="n">F4</span><span class="mf">.0</span><span class="p">,</span><span class="n">F9</span><span class="mf">.0</span><span class="p">,</span><span class="n">F4</span><span class="mf">.0</span><span class="p">,</span><span class="mi">4</span><span class="n">F7</span><span class="mf">.2</span><span class="p">)</span>
     <span class="n">STORE</span> <span class="n">NCOEF</span><span class="o">=</span><span class="mi">6</span>
     <span class="n">OUTPUT</span> <span class="n">INDICES</span> <span class="o">/</span><span class="n">FO</span><span class="o">/</span> <span class="n">BATCH</span> <span class="n">RATIO</span><span class="o">/</span><span class="n">JCODE</span> <span class="n">SIGMA</span><span class="p">(</span><span class="o">/</span><span class="n">FO</span><span class="o">/</span><span class="p">)</span> <span class="n">CORRECTIONS</span> <span class="n">SERIAL</span>
     <span class="n">ABSORPTION</span> <span class="n">PHI</span><span class="o">=</span><span class="n">NO</span>  <span class="n">THETA</span><span class="o">=</span><span class="n">YES</span> <span class="n">PRINT</span><span class="o">=</span><span class="n">NONE</span>
     <span class="n">THETA</span> <span class="mi">16</span>
     <span class="n">THETAVALUES</span>
     <span class="n">CONT</span> <span class="mi">0</span>  <span class="mi">5</span> <span class="mi">10</span> <span class="mi">15</span> <span class="mi">20</span> <span class="mi">25</span> <span class="mi">30</span> <span class="mi">35</span> <span class="mi">40</span> <span class="mi">45</span> <span class="mi">50</span> <span class="mi">55</span> <span class="mi">60</span> <span class="mi">65</span> <span class="mi">70</span> <span class="mi">75</span>
     <span class="n">THETACURVE</span>
     <span class="n">CONT</span> <span class="mf">3.61</span>  <span class="mf">3.60</span>  <span class="mf">3.58</span>  <span class="mf">3.54</span>  <span class="mf">3.50</span>  <span class="mf">3.44</span>  <span class="mf">3.37</span>  <span class="mf">3.30</span>
     <span class="n">CONT</span> <span class="mf">3.23</span>  <span class="mf">3.16</span>  <span class="mf">3.09</span>  <span class="mf">3.02</span>  <span class="mf">2.96</span>  <span class="mf">2.91</span>  <span class="mf">2.86</span>  <span class="mf">2.82</span>
     <span class="n">END</span>
     \<span class="n">LP</span>
     <span class="n">END</span>
     \<span class="n">SYSTEMATIC</span>
     \ <span class="n">preserve</span> <span class="n">the</span> <span class="n">original</span> <span class="n">indices</span>
     <span class="n">STORE</span> <span class="n">NEWINDICES</span><span class="o">=</span><span class="n">NO</span>
     <span class="n">END</span>
     \<span class="n">SORT</span>
     <span class="n">END</span>
     \ <span class="n">copy</span> <span class="kn">from</span> <span class="nn">workfile</span> <span class="n">to</span> <span class="n">disk</span>
     \<span class="n">LIST</span> <span class="mi">6</span>
     <span class="n">READ</span> <span class="n">TYPE</span><span class="o">=</span><span class="n">COPY</span>
     <span class="n">END</span>
     \ <span class="n">unit</span> <span class="n">weights</span>
     \<span class="n">LIST</span> <span class="mi">4</span>
     <span class="n">END</span>
     \<span class="n">WEIGHT</span>
     <span class="n">END</span>
     \<span class="n">EDIT</span>
     <span class="n">UEQUIV</span> <span class="n">FIRST</span> <span class="n">UNTIL</span> <span class="n">LAST</span>
     <span class="n">END</span>
     \<span class="n">LIST</span> <span class="mi">28</span>
     <span class="n">MINIMA</span> <span class="n">RATIO</span> <span class="o">=</span>  <span class="mf">3.0</span>
     <span class="n">END</span>
     \<span class="n">SFLS</span>
     <span class="n">SCALE</span>
     <span class="n">END</span>
     \ <span class="n">assume</span> <span class="n">there</span> <span class="n">are</span> <span class="n">no</span> <span class="n">H</span> <span class="n">atoms</span>
     \<span class="n">LIST</span> <span class="mi">12</span>
     <span class="n">FULL</span> <span class="n">FIRST</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">ISO</span><span class="p">])</span> <span class="n">UNTIL</span> <span class="n">LAST</span>
     <span class="n">END</span>
     \<span class="n">SFLS</span>
     <span class="n">REFINE</span>
     <span class="n">REFINE</span>
     <span class="n">CALC</span>
     <span class="n">END</span>
     \<span class="n">LIST</span> <span class="mi">28</span>
     \ <span class="n">remove</span> <span class="nb">all</span> <span class="n">restrictions</span> <span class="n">to</span> <span class="n">get</span> <span class="n">Fcs</span><span class="o">.</span>
     <span class="n">END</span>
     \<span class="n">DIFABS</span> <span class="n">UPDATE</span> <span class="n">FC</span>
     <span class="n">END</span>
     \ <span class="n">Complete</span> <span class="n">anisotropic</span> <span class="n">refinement</span><span class="p">,</span> <span class="n">produce</span> <span class="n">publication</span> <span class="n">tables</span> <span class="n">etc</span>
     \<span class="n">LIST</span> <span class="mi">12</span>
     <span class="n">FULL</span> <span class="n">X</span><span class="s1">&#39;S U&#39;</span><span class="n">S</span>
     <span class="n">END</span>
     \<span class="n">LIST</span> <span class="mi">28</span>
     <span class="n">MINIMA</span> <span class="n">RATIO</span><span class="o">=</span><span class="mi">3</span>
     <span class="n">END</span>
     \<span class="n">SFLS</span>
     <span class="n">REFINE</span>
     <span class="o">.....</span>
     \<span class="n">CIF</span>
     <span class="n">END</span>
     \ <span class="n">reprocess</span> <span class="n">data</span> <span class="n">so</span> <span class="n">that</span> <span class="n">it</span> <span class="n">can</span> <span class="n">be</span> <span class="n">merged</span> <span class="k">for</span> <span class="n">the</span> <span class="n">final</span>
     \ <span class="n">difference</span> <span class="nb">map</span>
     \<span class="n">DIFABS</span> <span class="n">UPDATE</span> <span class="n">TRANSFER</span>
     <span class="n">END</span>
     \<span class="n">SYST</span>
     <span class="n">END</span>
     \<span class="n">MERGE</span>
     <span class="n">END</span>
     \<span class="n">FOURIER</span>
     \ <span class="n">etc</span> <span class="n">etc</span> <span class="n">etc</span> <span class="o">---</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="internal-workings">
<h2>Internal workings<a class="headerlink" href="#internal-workings" title="Link to this heading"></a></h2>
<p>SOme understanding of the internal data management in CRYSTALS may
help the user to sort out unexplained failures.</p>
<section id="parameter-esds-list-9">
<span id="list9"></span><h3>Parameter esds - LIST 9<a class="headerlink" href="#parameter-esds-list-9" title="Link to this heading"></a></h3>
<blockquote>
<div><p>This list contains the refineable parameter esds.</p>
<p>It is created from LIST 5 and LIST 11 with the instruction</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">ESD</span>
<span class="n">END</span>
</pre></div>
</div>
</div></blockquote>
<dl>
<dt>The list can be printed with</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">PRINT</span> <span class="mi">9</span>
<span class="n">END</span>
</pre></div>
</div>
<p>The instruction \PUNCH 5 E creates a plain format punch file with
the atomic parameters and esds.</p>
</dd>
</dl>
</section>
<section id="refinement-parameter-map-list-22">
<span id="list22"></span><h3>Refinement parameter map  -  LIST 22<a class="headerlink" href="#refinement-parameter-map-list-22" title="Link to this heading"></a></h3>
<blockquote>
<div><p>This list contains the refinement directives in internal format
and it can only be generated by the computer.
After the refinement directives have been read in, they are
stored on the disc in binary format ready for processing.
Before the structure factor least squares routines can
use the information in LIST 12, it is necessary to convert them to
a LIST 22.</p>
<p>If the conversion fails, or the input of LIST 5 or LIST 12
is in error, LIST 22 will be marked as an error list, and any job
that attempts to reference LIST 22 will terminate in error.</p>
<p>For complex LIST 12s, i.e. those
containing EQUIVALENCE, LINK, RIDE, GROUP, WEIGHT or COMBINE, the user is
strongly advised to issue \LIST 22 and then \PRINT 22, and look at the
LIST 22
generated. The ouput, which is set out like a LIST 5, shows the
relationship between the physical and the least squares parameters.</p>
</div></blockquote>
</section>
<section id="the-least-squares-matrix-list-11">
<span id="list11"></span><h3>The least squares matrix  -  LIST 11<a class="headerlink" href="#the-least-squares-matrix-list-11" title="Link to this heading"></a></h3>
<blockquote>
<div><p>The matrix that is produced by the structure factor least
squares process is stored on the disc as a LIST 11. This list may be
massive, so it is wise to purge the disk regularly with large
structures. To recover the maximum space, delete the LIST 11 before
purging.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">DISK</span>
<span class="n">DELETE</span> <span class="mi">11</span>
<span class="n">END</span>
\<span class="n">PURGE</span>
<span class="n">END</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="printing-the-contents-of-list-11">
<h3>Printing the contents of LIST 11<a class="headerlink" href="#printing-the-contents-of-list-11" title="Link to this heading"></a></h3>
<blockquote>
<div><p>LIST 11 is printed by :</p>
</div></blockquote>
<p><strong>\PRINT 11</strong></p>
<p><strong>\PRINT 11 A</strong></p>
<blockquote>
<div><p>Prints the largest 10 correlation coefficients whose magnitude is
greater than 0.25.</p>
</div></blockquote>
<p><strong>\PRINT 11 B</strong></p>
<blockquote>
<div><p>Prints the correlation matrix.</p>
</div></blockquote>
<p><strong>\PRINT 11 C</strong></p>
<blockquote>
<div><p>Prints the current matrix (usually the inverse matrix).</p>
</div></blockquote>
</section>
<section id="least-squares-shift-list-list-24">
<span id="list24"></span><h3>Least squares shift list  -  LIST 24<a class="headerlink" href="#least-squares-shift-list-list-24" title="Link to this heading"></a></h3>
<blockquote>
<div><p>When the normal matrix produced by the least squares process
has been inverted, a set of shifts is calculated,
suitably scaled if necessary, to apply to the atomic parameters.
These shifts are output to the disc as a LIST 24,
and then applied by the routines that compute the new parameters.
List 24 can only be generated in the machine.</p>
</div></blockquote>
</section>
<section id="restraints-in-internal-format-list-26">
<span id="list26"></span><h3>Restraints in internal format  -  LIST 26<a class="headerlink" href="#restraints-in-internal-format-list-26" title="Link to this heading"></a></h3>
<blockquote>
<div><p>This list contains the restraints in internal format.
Before the structure factor least squares routines can
use the information in LIST 16 and 17, it is necessary to
convert it to an internal format held in LIST 26.</p>
<p>If this operation fails, or the input of LIST 12 or LIST 16
goes wrong, LIST 26 will be marked as an error list, and any job
that attempts to reference LIST 26 will terminate in error.</p>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="parameters.html" class="btn btn-neutral float-left" title="Atomic And Structural Parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="fourier.html" class="btn btn-neutral float-right" title="Fourier Routines" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Richard Cooper, David Watkin.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>