<!-- XTLVAR title="Reflection Data Input" -->
<!-- XTLVAR comment="Reflection Data Input" -->
<!-- XTLVAR cvssource="manual/crystals.man" -->
<H1>Crystals Manual</H1>
<H2>Chapter 5: Reflection Data Input</H2>
<DL><DT>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.scope">5.1: Scope of the Reflection Data Input section of the Reference Manual</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.refdata">5.2: Reflection Data</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.simplein">5.3: Simple input of F or Fsq data - LIST 6</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.4">5.4: Creation of LIST 7 from LIST 6 - COPY 6 7</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.print6">5.5: Printing LIST 6</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.punch6">5.6: Punching LIST 6</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.advinput6">5.7: Advanced input of F or Fsq data - LIST 6</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.refparamcoeff">5.8: Reflection Parameter Coefficients</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.store6">5.9: Storage of reflection data</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.compress6">5.10: Compressed reflection data</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.hkli">5.11: Intensity Data - HKLI</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.list27">5.12: Intensity Decay Curves  \LIST 27</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.print27">5.13: Printing the decay curve</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.datareduc">5.14: Data Reduction - Lp</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.syst">5.15: Systematic absence removal - \SYSTEMATIC</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.sort">5.16: Sorting of the reflection data  -  \SORT</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.merge">5.17: Merging equivalent reflections  -  \MERGE</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.thetabs">5.18: Theta-dependent Absorption Correction  -  \THETABS</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.wilson">5.19: WILSON PLOT  -  \WILSON</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.20">5.20: THLIM  -  \THLIM</A><br>
<DD><A HREF="crystalsmanual-reflectionin.html#reflectionin.21">5.21: SIGMADIST  -  \SIGMADIST</A><br>
</DL>

<BR>&nbsp;<BR>
<A NAME="reflectdata"> </A>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.scope">5.1: Scope of the Reflection Data Input section of the Reference Manual</A></H3></CENTER>

<BR>
<P>The areas covered are:

<pre>
 Reflection Data
 Simple input of F or Fsq data               - \LIST 6
 Advanced input of F or Fsq data             - \LIST 6
 Reflection Parameter Coefficients
 Storage of reflection data
 Compressed reflection files
 Intensity data                              - \HKLI
 Standard Decay Curves                       - \LIST 27
 Data Reduction                              - \LP
 Systematic absence removal                  - \SYSTEMATIC
 Sorting data                                - \SORT
 Merging equivalent reflections              - \MERGE
 Theta-dependent absorption correction       - \THETABS
 Analysis of data                            - \THLIM, WILSON, SIGMADIST
</pre><p><BR>
<BR>&nbsp;<BR>
<A NAME="Reflection data format"> </A>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.refdata">5.2: Reflection Data</A></H3></CENTER>

<BR>
<BR>&nbsp;<BR>
<div class="directive"><strong><i>Format of reflection data</i></strong>
      The reflection data may be embedded into the control data, but it
 is more normal to hold it in a separate file, the HKLI file. This file
 may have one of more reflections per line, or a reflection may span
 several lines. The parameters for each reflection may be in fixed
 format, <i>i.e.</i> right adjusted columns, or be in free-format, with
 at least a single space separating items.
<P>If fixed-format input is used, the user must supply a FORTRAN format
 statement. This specifies the width of the input fields, where the
 decimal points are, and any fields to be skipped.  Even though the indices
 are usually integer values, CRYSTALS read them as floating point numbers.
 A FORTRAN 'I' format is automatically changed to an 'F' format.
 Note that if the input figures contain decimal points, these will
 over-ride values given in the format statement.

<pre>
      Examples - ^ represents a space.

      FORMAT (3F4.0, 2F8.2)      ^^^1^^12^^^3^^^47.23^^^^9.32
      FORMAT (3I4, 2F8.2)        ^^^1^^12^^^3^^^47.23^^^^9.32

      FORMAT (3F4.0, 2F8.0)      ^^^1^^12^^^3^123456.^^312.16

      FORMAT (3F4.0, 3X,2F8.0)   ^^^1^^12^^^3ABC^123456.^^312.16
</pre><p><BR>
</div>
<div class="directive"><strong><i>Termination of reflection data</i></strong>
 The reflection data themselves should be terminated with  a
 value less than or equal to -512 for the first value on the 
 final input line.
<BR>
 If the reflections are embedded into the control data, then correct
 termination is <strong>vital.</strong> Incorrect termination may lead to the program
 trying to read commands as reflections, producing massive error files.
 If the reflections are in the HKLI file, most
 implementations will detect the end-of-file and terminate input.
<BR>
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>F or Fsq?</i></strong>
 CRYSTALS will accept either F or Fsq observations, signed or unsigned.
 Either quantity is referred to by the name 'Fo'. If sigma values
 are given, they must refer directly to the signed input F or Fsq values.
 reflections are stored as Fo, and standard deviations are
 transformed or approximated so that Least-Squares refinement
 can be performed with either F or Fsq independent of input type. Raw
 intensities, I, can be input with the HKLI command. The reflection
 input routines (LIST 6 or HKLI) are the only routine able to take the
 square root of the observation. See the chapter on refinement for a
 brief discussion of the merits of F and FSQ refinements.
<BR>
</div>
<div class="directive"><strong><i>Merged or unmerged data?</i></strong>
 CRYSTALS supports two levels of merging (averaging) simultaneously.  
 For Fourier syntheses it is important that all symmetry operations of 
 the Laue Group are applied, including Friedel's Law. For refinement it 
 is permitted to used un-merged data, though in general some merging is 
 performed. For non-centrosymmetric structures containing strong
 anomalous scatterers 
 Friedel pairs should be kept separate, but other symmetry operations 
 should be applied. 
<P>The reflection list with the minimal amount of merging is the 
 principal reflection list, LIST 6 (section !elabel!LIST06!). This can 
 be used to create 
 a full-merged list for Fourier (or other) calculations, LIST 7 
 (section !elabel!LIST07!).
 The user can indicate to most commands which use reflections whether 
 to use LIST 6 or LIST 7, but by default all use LIST 6 for backwards 
 compatibility. 
<BR>When working from the menus, CRYSTALS tries to determine whether a LIST 
 6 or a LIST 7 would be most appropriate.  If a LIST 7 is required, the 
 SCRIPT COPY67 is activated to output a LIST 6 as a temporary file, and 
 re-input it as a LIST 7.  This can then be manupulated independently of 
 the original LIST 6.
<BR>LIST 7s are currenlty automatically created for:
<pre>
      Fourier Maps
      Slant Fourier Maps
      Superflip Structure Solution
      Absolute Structure Determination
</pre><p><BR>
<BR> The experienced or adventurous user can of course use 
 LIST 6 and LIST 7 quite independently for different purposes.
<BR>
In LIST 7 the ARCHIVE keyword is set to NO, to prevent the original 
archived data from being over-written
<BR>
<BR>
<A NAME="LIST 6"> </A>
<A NAME="F or Fsq data"> </A>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.simplein">5.3: Simple input of F or Fsq data - LIST 6</A></H3></CENTER>
<A NAME="LIST06"> </A>

<P>LIST 6 will accept reflection data either as F or Fsq.
 For routine work, a pre-specified set of coefficients

<pre>
      h k l Fobs sigma(Fobs)
</pre><p><BR>
 are input and
 stored
 for each reflection.
<BR>
 <strong>NOTE</strong> that 'Fobs' will refer either to F or Fsq, depending on the
 value of F's.
<BR>
 The input coefficient list may be expanded for
 non-routine work - see section !elabel!ADVANCEDL6! below.

<pre>
 \LIST 6
 READ F'S=
 FORMAT EXPRESSION=
 END
</pre><p><BR>

<pre>
 \ The OPEN command connects the reflection file
 \OPEN HKLI REFLECT.DAT
 \LIST 6
 READ F'S=FSQ
 FORMAT (3F4.0, 2F8.0)
 END
 \ Close the reflection file
 \CLOSE HKLI
</pre><p><BR>
<BR>&nbsp;<BR>
<div class="directive"><strong><i>READ F'S=</i></strong>
<div class="parameter"><i>F'S=</i>
 This parameter is used to indicate whether Fo or Fo**2
 type coefficients are being read in, and must take one of the following
 values :

<pre>
      FSQ
      FO   -  Default
</pre><p><BR>
 The default value of  'FO'  indicates that coefficients corresponding
 to Fo are being read in.
<BR>
 By default, the reflections are assumed to come in fixed format from the HKLI
 channel, and may be terminated either by the end-of-file, or with -512.


<BR>&nbsp;<BR>
<A NAME="COPY 6 7"> </A>
<A NAME="Copy List 6 to 7"> </A>
</div>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.4">5.4: Creation of LIST 7 from LIST 6 - COPY 6 7</A></H3></CENTER>
<A NAME="LIST07"> </A>
<P>This command creates a LIST 7 as an exact copy of LIST 6 (see !elabel!LIST06!).
 The LIST 7 can then be merged using Friedel's Law to create a 
reflection list suitable for Fourier syntheses

<pre>
 \COPY INPUT= OUTPUT=
 END
</pre><p><BR>
Example
<pre>
 \COPY 6 7
 END
</pre><p><BR>




<BR>&nbsp;<BR>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.print6">5.5: Printing LIST 6</A></H3></CENTER>

<P>The reflections can be output to listing file as follows :
<div class="instruction"><strong><u>\PRINT 6 mode</u></strong><br>
 Mode controls the type of output.
<pre>
     A - Default - The reflections are in compressed 
                   format, on the scale of Fo.
     B -           The reflections are in compressed 
                   format, on the scale of Fc.
     C -           A general print of all the data 
                   stored for each reflection.
</pre><p><BR>
See also \REFLECTIONS (section !elabel!REFLECTIONS!), which produces tables 
for publication.
<BR>&nbsp;<BR>
<A NAME="Output of reflection data"> </A>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.punch6">5.6: Punching LIST 6</A></H3></CENTER>

<P>LIST 6 can be punched as an ASCII file in several formats.
<div class="instruction"><strong><u>\PUNCH 6 mode</u></strong><br>
 Mode controls the format of the output.
<pre>
      A - Output the reflections in a compressed format - Default.
      B - Output the reflections in 'cif' format. F's
      C - Output stored information in tabulated format.
      D - Output original information in tabulated format.
      E - Output the reflections in 'cif' format. F^s, scale of Fo
      F - Output Fo, sigma information in SHELX format.
      G - SHELX output with statistically generated sigmas
      H - Output the reflections in 'cif' format. F^s, scale of Fc
      I - Outputs all set items as a LIST 6.
      J - Used to convert pre-2016 esds to more precise ones. 

     AF - JF as above with F indicating that LIST 28 filters will be applied
</pre><p><BR>
<P>LIST 6 is also output by the links to the direct methods programs. In
 these files, the magnitudes of Fo or Fsq are scaled so that the largest
 fits the format statement. The SHELX file contains Fsq, the SIR file
 contains Fo.
<BR>
<A NAME="Reflection data input - advanced"> </A>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.advinput6">5.7: Advanced input of F or Fsq data - LIST 6</A></H3></CENTER>
<A NAME="ADVANCEDL6"> </A>

<P>LIST 6 will accept reflection data either as F or Fsq.
 The data may be
 in free or fixed format. For routine work, a pre-specified set of
 parameters is stored for each reflection. This may be expanded for
 non-routine work by <strong>INPUT</strong> and <strong>OUTPUT</strong> coefficients.

<pre>
 \LIST 6
 READ NCOEFFICIENT= TYPE= F'S= NGROUP= UNIT= CHECK= ARCHIVE=
 INPUT COEFFICIENT(1)= COEFFICIENT(2)= .  .
 STORE NCOEFFICIENT= MEDIUM= APPEND=
 OUTPUT COEFFICIENT(1)= COEFFICIENT(2)=  .  .
 FORMAT EXPRESSION=
 MULTIPLIERS VALUE=
 MATRIX M11=  M12=  ... M33= TOLER= TWINTOLER=
 END
</pre><p><BR>

<pre>
 \ The OPEN command connects the reflection file
 \OPEN HKLI REFLECT.DAT
 \LIST 6
 READ NCOEF=5 TYPE=FIXED UNIT=HKLI F'S=FSQ
 FORMAT (3F4.0, 2F8.2)
 INPUT H K L /FO/ SIGMA(/FO/)
 STORE NCOEF=7
 OUTPUT INDICES /FO/ SQRTW /FC/ BATCH/PHASE RATIO/JCODE SIGMA(/FO/)
 END
 \CLOSE HKLI
</pre><p><BR>
<BR>&nbsp;<BR>
<div class="directive"><strong><i>READ NCOEFFICIENT= TYPE= F'S= NGROUP= UNIT= CHECK= ARCHIVE=</i></strong>
<BR>
<div class="parameter"><i>NCOEFFICIENT= </i>
 Specifies the number of coefficients to be input per reflection. A list
 of permitted coefficients is given below. If this directive is omitted,
 the default is 5.
<BR>
 The default input coefficients are

<pre>
      H K L FOBS SIGMA(F)
</pre><p><BR>
</div>
<div class="parameter"><i>TYPE=</i>
 This parameter determines the form of the reflections as they are read
 in, and must take one of the following values :

<pre>
      FIXED     -  Fixed format data
      FREE      -  Free format text  -  default value
      COMPRESSED-  See 'Compressed Reflection Data' below
      COPY      -  LIST 6 is copied from the current input device to the
                   output device designated on the STORE directive with
                   the number of coefficients given on the OUTPUT and
                   COEFFICIENT directives.
</pre><p><BR>
</div>
<div class="parameter"><i>F'S=</i>
 This parameter is used to indicate whether Fo or Fo**2
 type coefficients are being read in, and must take one of the following
 values :

<pre>
      FSQ
      FO   -  Default value
</pre><p><BR>
 The default value of  'FO'  indicates that coefficients corresponding
 to Fo are being read in.
</div>
<div class="parameter"><i>NGROUP=</i>
 This parameter defines the number of reflections per line for fixed
 format input. (For free format input, the system
 can work out this information).
 NGROUP will be less than unity if the reflection spans several lines.
</div>
<div class="parameter"><i>UNIT=</i>
 This parameter defines the source of the reflection data that are
 to be input.

<pre>
      HKLI   -  Default value.
      DATAFILE
</pre><p><BR>
<P>
 HKLI  indicates that the reflection data are in a separate file from
 the main input data.
 The local implementation may set up default names for this file, or
 the \OPEN directive can be used to connect the file to CRYSTALS.
<P>
  DATAFILE  indicates that the reflections follow the directives for
  '\LIST 6' in the normal data input stream.
 If this is the case, the directives for  \LIST6  <strong>must</strong> be terminated
 by the directive  END, otherwise the reflection lines will be
 processed as normal directives associated with the  \LIST6
 command, and generate a very large number of input errors.
<P>
 By default, the data are assumed to come from the alternative HKLI
 channel.
</div>
<div class="parameter"><i>CHECK</i>
 This parameter determines whether reflections are rejected on input
 if they have a zero or negative value for Fo.

<pre>
      YES
      NO -  Default value.
</pre><p><BR>
 By default checking is disabled so that negative reflections are
 accepted on input.
<BR>
</div>
<div class="parameter"><i>ARCHIVE</i>
This parameter controls the creation of a file ARCHIVE-HKL.CIF, an  
image of the data in 3i4,2f8.2 (SHELX) format. 

<pre>
      YES -  Default value.
      NO 
</pre><p><BR>
The default value is YES except when a COPY is being performed. The 
ARCHIVE-HKL.CIF can be embedded in the final publish.cif file.
<BR>
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>INPUT COEFFICIENT(1)= COEFFICIENT(2)= .  .</i></strong>
<P>This directive defines the coefficients that are to be read in.
 The number of coefficients is given by the  NCOEFFICIENT  parameter
 above, or its default value.
<div class="parameter"><i>COEFFICIENT(1)= COEFFICIENT(2)= </i>
 Defines the coefficients and their input order. The coefficients must be
 selected from the following list

<pre>
      H             K             L             /FO/
      SQRTW         FCALC         PHASE         A-PART
      B-PART        TBAR          FOT           ELEMENTS
      SIGMA(F)      BATCH         INDICES       BATCH/PHASE
      SINTH/L**2    FO/FC         JCODE         SERIAL
      RATIO         THETA         OMEGA         CHI
      PHI           KAPPA         PSI           CORRECTIONS
      FACTOR1       FACTOR2       FACTOR3       RATIO/JCODE
</pre><p><BR>
 For the meaning of these coefficients, see section !elabel!REFPARCOEF! - 
 'Reflection Parameter Coefficients'
<BR>
 <strong>NOTE</strong> that 'Fobs' will refer either to F or Fsq, depending on the
 value of F's. Reflections are available during refinement as either signed
 Fsq or signed Fo independent of the type of input values.
<BR>
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>STORE NCOEFFICIENT= MEDIUM= APPEND=</i></strong>
<div class="parameter"><i>NCOEFFICIENT= </i>
 Specifies the number of coefficients to be stored per reflection. A list
 of permitted coefficients is given above. If this directive is omitted,
 the default is 9.
<BR>
 The default output coefficients are

<pre>
      INDICES /FO/ SQRTW /FC/ BATCH/PHASE RATIO/JCODE SIGMA(/FO/)
      CORRECTIONS ELEMENTS
</pre><p><BR>
</div>
<div class="parameter"><i>MEDIUM</i>
 This parameter sets the output reflection storage device. This can be a
 text file, but more normally it is the database, the '.dsc' file. 
 See section !elabel!STOREREF! - 'Storage of Reflection Data'.

<pre>
      FILE        A named or scratch ASCII serial file
      INPUT       A file of the same type as the input reflection source
      DISK   -    Default - The current structure database
</pre><p><BR>
</div>
<div class="parameter"><i>APPEND=</i>
 This parameter determines whether the input reflections are to replace
 or be appended to existing reflections.
<pre>
      YES      The input reflections are appended to existing reflections
      NO   -   Default - The input reflections replace any existing reflections
</pre><p><BR>
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>OUTPUT COEFFICIENT(1)= COEFFICIENT(2)= .  .</i></strong>
<P>This directive defines the coefficients that are to be stored.
 The number of coefficients is given by the  NCOEFFICIENT  parameter
 above, or its default value, and the coefficients selected from the list
 above.
<BR>
 If the  OUTPUT  directive is omitted, as many of the default
 coefficients as are required by NCOEFFICIENT  are used as output
 coefficients :
<BR>
 If the  OUTPUT  directive is omitted and  NCOEFFICIENT  is greater than 9,
 it is reset to 9 so that the coefficients above can be used.
<BR>
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>FORMAT EXPRESSION=</i></strong>
<P>This directive allows the user to define a format statement if
 fixed format input is being used.
 This directive is only valid if the  TYPE  parameter on the  READ  
 directive is  FIXED .
<div class="parameter"><i>EXPRESSION=</i>
 This parameter defines the format to be used.
 Normally this keyword is omitted, so that the directive looks
 like a FORTRAN format statement, except that there must be at least
 one space between the  'FORMAT' and the expression, to terminate the
 directive.
 Since all the data are read as real numbers, the format expression
 can only contain F , E , and X field definitions - either find a good
 Fortran reference book for examples, or ask someone who did 
 crystallography before 1990.
<BR>
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>MULTIPLIERS VALUE=</i></strong>
<P>This directive allows the user to define the multipliers to
 be applied to the data if they are being read in compressed format.
 This directive is only valid if the  TYPE parameter on the  READ  directive 
 is COMPRESSED .
<div class="parameter"><i>VALUE=</i>
 This parameter, whose default value is unity,
 is repeated the number of times specified by the  NCOEFFICIENT  parameter
 on the  READ  directive.
 The order is the same as the  INPUT  coefficients.
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>MATRIX M11= M12= ...M33= TOLER= TWINTOLER=</i></strong>
<P>This directive inputs a matrix to be applied to the reflection indices
as they are read in. If any component of the index differs by more than
TOLER from an integer, the reflection is rejected. TWINTOLER is a value,
in A-2, for overlap of potentially twinned reflections. See the chapter
on twinning (!elabel!twinning!).
<div class="parameter"><i>Mij=</i>
 The 9 elements (by row) of an index transformation matrix. The default
is a unit matrix
</div>
<div class="parameter"><i>TOLER=</i>
 The reflection is rejected if any transformed index differs from an
integer by more than TOLER. The default is 0.1.
</div>
<div class="parameter"><i>TWINTOLER=</i>
 The twin element tag is updated if the generated reciprocal lattice
point differs from a base lattice point by less than TWINTOLER
reciprocal Angstrom. The default is 0.001, but an ideal value will depend
upon the integration method, the mosaicity, and the lengths of the cell
edges.
<BR>
<BR>
<BR>&nbsp;<BR>
</div>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.refparamcoeff">5.8: Reflection Parameter Coefficients</A></H3></CENTER>
<A NAME="REFPARCOEF"> </A>

<P>CRYSTALS has a very flexible procedure for storing reflection
 information, enabling the user to optimise disk space use. The user
 must indicate to the program what information is available in the input
 data, and what information is to be stored. Storage space may also be
 reserved for data yet to be computed.
<P>During data reduction (section !elabel!DATAREDUC!), space is reserved for 
 relevant coefficients.
 These coefficients (<i>e.g.</i> setting angles) may not be needed during
 structure analysis, so they are not normally preserved beyond reduction.
<BR>&nbsp;<BR>
<div class="instruction"><strong><u>Special Reflection storage</u></strong><br>
<P>The user might need to arrange special reflection storage under the
 following conditions:
<BR>&nbsp;<BR>
<div class="directive"><strong><i>Refinement using a partial model</i></strong>
<P>If the user is experiencing difficulties with a small part of an otherwise
 well behaved large structure, the real and imaginary parts of the
 structure factors due to the well behaved part can be precomputed and
 stored and these atoms removed from the atom list (LIST 5).
 The user then only needs recompute the contributions
 from the varying fragment. The total Fo, Fc, real and imaginary parts are
 stored with the keys
<pre>
      /FO/      /FC/      APART      BPART
</pre><p><BR>
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>Twinned structures</i></strong>
<P>See chapter !elabel!twinning! on handling twinned data.

<BR>&nbsp;<BR>
</div>
</div>
<div class="instruction"><strong><u>Recognised reflection coefficients</u></strong><br>
<BR>
<pre>
 Coefficients recognised are:
 H            Reflection index h
 K            Reflection index k
 L            Reflection index l
 INDICES      Packed reflection indices
 /FO/         The observed intensity, Fsq or Fo value
 /FOT/        The observed intensity, Fsq or Fo value for a twinned crystal
 /FC/         The calculated structure factor
 SIGMA(/FO/)  Standard deviation of the input observation
 SQRTW        Sqrt of weight to be given a reflection during least squares
 A-PART       Real part of structure factor
 B-PART       Imaginary part of structure factor
 PHASE        Phase angle, radians
 BATCH        An integer associated with reflections measured in batches
 BATCH/PHASE  Packed (compressed into one word) Batch and Phase
 SINTH/L**2   (Sintheta/lambda)**2
 FO/FC        Fo/Fc
 ELEMENTS     Integers corresponding to twin elements
 SERIAL       Serial number of reflection
 JCODE        reflection quality code. See below
 RATIO        Ratio Fo**2/sigma(Fo**2)
 RATIO/JCODE  Packed ratio and jcode
 TBAR         Absorption weighted X-ray path length
 THETA        Bragg angle
 OMEGA        Setting angle
 CHI          Setting angle
 PHI          Setting angle
 KAPPA        Setting angle
 PSI          Setting angle
 CORRECTIONS  Composite correction factor for Fo
 FACTOR1      Individual correction factor for Fo
 FACTOR2      Individual correction factor for Fo
 FACTOR3      Individual correction factor for Fo
 NOTHING      A spare location for programmers use
</pre><p><BR>
<P>If an output coefficient is specified without the corresponding input
 coefficient, it value is set to zero except for BATCH (default is 1.0)
 and SINTH/L**2  (value computed from cell parameters). Packed INDICES are
 restricted to +/- 127, packed RATIO to range 0.0 - 999.0, JCODE to range
 0 - 9. 
<P>JCODE valuse assigned by RC93 for MACH3 data are

<pre>
            1     normal reflection
            9     weak reflection
            7     flagged strong S but not flagged D
            2     deviates from expected position/peak shape, but not W
            3     failed non-equal test at least once
            6     flagged weak
            4     reflection is bad
            8     flagged strong T but not flagged D
     The order of comparisons corresponds to the order of likelihood of
     having a particular code.
</pre><p><BR>
<BR>&nbsp;<BR>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.store6">5.9: Storage of reflection data</A></H3></CENTER>
<A NAME="STOREREF"> </A>

<P>Reflections may be stored either in the structure database (the DSC
 file), or as external binary serial files. The latter is used mainly
 during data reduction (section !elabel!DATAREDUC!).
<P>When a change is made to most other
 data lists, they are either completely overwritten (LIST1, cell
 parameters), or a new list created in addition to the old list (LIST 5,
 atom parameters). Because the reflections are special, they are handled
 differently. A small piece of information (called the LIST 6 Header) is
 created to hold information about the rest of the reflection list,
 and new headers are stored each time the main body is updated. The main
 body of the reflection list is modified in-situ if the only changes are
 ones which can easily be recomputed ( <i>e.g.</i> Fc, phase, sqrtw), thus
 reducing the disk activity. If an error occurs during the updating of
 the body, the list becomes inaccessible to other processes, and the
 failing process must be re-run correctly.
 If the changes involve a change in size of
 the list, then a new body is created.
<P>During raw data processing (Data reduction, section !elabel!DATAREDUC!) the 
 size of the reflection
 list can change a lot (coefficients being added or removed, reflections
 being merged or rejected). To prevent the .DSC file growing too large,
 binary serial files are used to hold the body of the reflection list.
 One is used for input and one for output at each stage, the roles being
 reversed after each stage. The header is kept in the .DSC file, and
 keeps track of the bodies. When data reduction is complete, the body
 must be copied to the .DSC file as follows:

<pre>
 \  After data reduction, make a final copy of the reflections
 \  and STORE THEM IN THE .DSC FILE:
 \LIST 6
 READ TYPE=COPY
 END
</pre><p><BR>
<BR>&nbsp;<BR>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.compress6">5.10: Compressed reflection data</A></H3></CENTER>

<P>CRYSTALS can produce files containing reflections is a 'compressed'
 format. This might be useful for archiving data. The compressed data is
 headed by the correct information for its reinput.
<P>The file contains information for  h, k, l, /FO/ or /FOT/, RATIO/JCODE
 and elements.
 For each  KL  pair, the  K  value is given for this group of
 reflections, then the  L  value for the group, followed by
 the  H  and /FO/ and other values for the first reflection, the  H   /FO/
 and other values for
 the second reflection, and so on, finishing with 512, which is the
 terminator for this  KL  pair.
 This pattern is repeated for all the  KL  pairs, the terminator
 for the last  KL  pair being -512, and indicates the end of the reflection
 list. Take care if you try to edit these files, and
 note that  K  and  L  are the two constant indices for each group,
 while  H  changes most rapidly.
<BR>
<BR>&nbsp;<BR>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.hkli">5.11: Intensity Data - HKLI</A></H3></CENTER>

<P>Raw intensity data require more processing than F or Fsq
 values. The instruction '\HKLI' is related to '\LIST 6', but has
 different default coefficients and additional directives for geometrical
 corrections.


<pre>
 \HKLI
 READ NCOEFFICIENT= TYPE= F'S= NGROUP= UNIT= CHECK= ARCHIVE=
 INPUT COEFFICIENT(1)= COEFFICIENT(2)= .  .
 STORE NCOEFFICIENT= MEDIUM= APPEND=
 OUTPUT COEFFICIENT(1)= COEFFICIENT(2)=  .  .
 FORMAT EXPRESSION=
 CORRECTIONS NSCALE NFACTOR
 FACTORS COEFFICIENT(1)= COEFFICIENT(2)=  .  .
 ABSORPTION PRINT= PHI= THETA= TUBE= PLATE=
 PHI NPHIVALUES= NPHICURVES=
 PHIVALUES PHI= .........
 PHIHKLI H= K= L= I[MAX]=
 PHICURVE I= .........
 THETA NTHETAVALUES=
 THETAVALUES THETA=
 THETACURVE CORRECTION= ........
 TUBE NOTHING OMEGA= CHI= PHI= KAPPA= MU=A[MAX]=
 PLATE NOTHING OMEGA= CHI= PHI= KAPPA= MU=A[MAX]=
 END
</pre><p><BR>
For example

<pre>
 \  The OPEN command connects the reflection file:
 \OPEN HKLI REFLECT.DAT
 \  The HKLI instruction reads the data in:
 \HKLI
 \  There are 12 items to read:
 READ NCOEF=12 FORMAT=FIXED UNIT=HKLI F'S=FSQ CHECK=NO
 \  This is what they are:
 INPUT H K L /FO/ SIGMA(/FO/) JCODE SERIAL BATCH THETA PHI OMEGA KAPPA
 \  And this is their format:
 FORMAT (5X,3F4.0,F9.0,F7.0,F4.0,F9.0,F4.0,4F7.2)
 \  We only want to store six of them:
 STORE NCOEF=6
 \  Specifically, these ones:
 OUTPUT INDICES /FO/ BATCH RATIO/JCODE SIGMA(/FO/) CORRECTIONS SERIAL
 \  Some absorption corrections have been measured:
 ABSORPTION PHI=YES  THETA=YES PRINT=NONE
 \  Here is the theta dependent absorption curve:
 THETA 16
 THETAVALUES
 CONT 0  5 10 15 20 25 30 35 40 45 50 55 60 65 70 75
 THETACURVE
 CONT 3.61  3.60  3.58  3.54  3.50  3.44  3.37  3.30
 CONT 3.23  3.16  3.09  3.02  2.96  2.91  2.86  2.82
 \  And here is one azimuthal absorption curve containing 26 points:
 PHI 26  1
 PHIVALUES
 CONT   6  16  21  26  31  36  41  61  66  76
 CONT  81  86  91  96 111 121 131 136 141 146
 CONT 151 156 161 166 171 176
 \  This is the reflection we used for the scan:
 PHIHKLI    -3   -1    0    28392
 PHICURVE
 CONT    26887   25377   24608   23990   23445   23049
 CONT    22867   22801   22782   22937   23104   23368
 CONT    23713   24129   25669   26836   27892   28250
 CONT    28291   28256   28101   28009   28204   28373
 CONT    28392   28203
 END
 \  All done. Close the hkl file.
 \CLOSE HKLI
</pre><p><BR>
 In the following description,
 for items defined under LIST 6 above only the default value will be given.
<BR>
<BR>&nbsp;<BR>
<div class="instruction"><strong><u>\HKLI</u></strong><br>
<BR>&nbsp;<BR>
<div class="directive"><strong><i>READ NCOEFFICIENT= TYPE= F'S= NGROUP= UNIT= CHECK= ARCHIVE=</i></strong>
 This directive is the same as the READ directive in \LIST 6 above, 
 except that the following parameters have
 different default values:

<pre>
 NCOEFFICIENT= default value is 12
 TYPE= default value is FIXED
 F'S= default value is FSQ
 NGROUP= default value is 1
 UNIT= default value is HKLI
</pre><p><BR>

<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>INPUT COEFFICIENT(1)= COEFFICIENT(2)= .  .</i></strong>
<P>This directive defines the coefficients that are to be read in.
 The number of coefficients is given by the  NCOEFFICIENT  parameter
 above, or its default value.
<BR>
 The default input coefficients are (i.e. for RC93 output):

<pre>
      H K L /FO/ SIGMA(/FO/) JCODE SERIAL BATCH THETA PHI OMEGA KAPPA
</pre><p><BR>
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>STORE NCOEFFICIENT= MEDIUM= APPEND=</i></strong>
<div class="parameter"><i>NCOEFFICIENT=</i>
The number of coefficients that will appear on the OUTPUT directive.
The default is 9.
</div>
<div class="parameter"><i>MEDIUM=</i>
 The default value is 'FILE'. Since the reflections will be much 
 changed during data reduction 
 (section !elabel!DATAREDUC!), the
 intermediate storage is usually a scratch serial file.
</div>
<div class="parameter"><i>APPEND=</i>
The default value is 'NO'.
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>OUTPUT COEFFICIENT(1)= COEFFICIENT(2)= .  .</i></strong>
 The default coefficients are:
<pre>
      INDICES /FO/ SQRTW /FC/ BATCH/PHASE RATIO/JCODE SIGMA(/FO/)
      CORRECTIONS ELEMENTS
</pre><p><BR>
Note that H, K, and L are compressed into one key: 'INDICES'.
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>FORMAT EXPRESSION=</i></strong>
<P>This directive is only valid if the  TYPE  parameter on the  
 READ  directive is  FIXED.
<div class="parameter"><i>EXPRESSION=</i>
 If the diffractometer type indicated in LIST 13 (section !elabel!LIST13!)
 is CAD4, the default
 corresponds to RC93 or RC85 output, otherwise an expression must be
 given.
<pre>
          e.g. (5X,3F4.0,F9.0,F7.0,F4.0,F9.0,F4.0,4F7.2)
</pre><p><BR>
<BR>
<BR>
<BR>
Directives found in HKLI commands, but not in LIST 6 commands are:
<BR>
</div>
</div>
<div class="directive"><strong><i>CORRECTIONS NSCALE= NFACTOR=</i></strong>

<div class="parameter"><i>NSCALE=</i>
 Set to 1 or 2 to select the first or second scale factor in LIST 27
 (see section !elabel!LIST27!).
<BR>
 The default is 2.
</div>
<div class="parameter"><i>NFACTOR=</i>
 Up to three correction per reflection to be applied to the input
 observations can be included in the input file. This keyword specifies
 how many to use.
<BR>
 The default is 0.
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>FACTORS COEFFICIENT(1)= COEFFICIENT(2)= .  .</i></strong>
 The permitted coefficients are FACTOR1, FACTOR2 and FACTOR3. These are
 applied to the input observation before any other action (including
 square rooting if requested) is performed.
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>ABSORPTION PRINT= PHI= THETA= TUBE= PLATE=</i></strong>
 This directive controls approximate absorption corrections to be applied
 during input. They are only suitable if the diffractometer used is one
 of those permitted in LIST 13 (section !elabel!LIST13!).
<div class="parameter"><i>PRINT=</i>
 Permitted levels are
<pre>
      FULL                  Two lines of information per reflection
      NONE    - Default     No output is produced
      PARTIAL -             Summary for each reflection
</pre><p><BR>
</div>
<div class="parameter"><i>PHI=</i>
<pre>
      NO      - Default
      YES
</pre><p><BR>
 If YES, then phi (azimuthal scan) data must follow.
</div>
<div class="parameter"><i>THETA=</i>
<pre>
      NO      - Default
      YES
</pre><p><BR>
 If YES, then a theta dependent correction curve must follow.
</div>
<div class="parameter"><i>TUBE=</i>
<pre>
      NO      - Default
      YES
</pre><p><BR>
 If YES, then orientation angles for the tube must follow.
</div>
<div class="parameter"><i>PLATE=</i>
<pre>
      NO      - Default
      YES
</pre><p><BR>
 If YES, then orientation angles for the plate must follow.
<BR>
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>PHI NPHIVALUES= NPHICURVES=</i></strong>
 If phi has been set to 'YES' above,
 this directive sets up input and computation of azimuthal scan
 absorption corrections, by the method of North, Phillips and Mathews,
 Acta Cryst., <strong>A24,</strong> 351 (1968).
<div class="parameter"><i>NPHIVALUES=</i>
 Number of sampling points on the phi curve. These need not be equally
 spaced
</div>
<div class="parameter"><i>NPHICURVES=</i>
      Number of phi curves that will be entered after this directive.
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>PHIVALUES PHI= .....</i></strong>
 The 'Nphivalue' phi angles  of the points on the absorption curve.
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>PHIHKLI H= K= L= I[MAX]=</i></strong>
 The h,k,l and Imax values for the following 'Nphicurve' phi profiles,
 in the same order as the profiles.
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>PHICURVE I= .....</i></strong>
 The 'Nphivalue' intensity values for the profile  at the phi values
 given on the Phivalues directive. There is a Phicurve corresponding to
 each PHIHKLI directive.
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>THETA NTHETAVALUES=</i></strong>
 If theta has been set to 'YES' above this directive sets up the input
 for and computation of a theta dependent absorption correction. Except
 when the data has been corrected by a proper analytical correction,
 a theta dependent correction is <strong>ALWAYS</strong> recommended, since neither
 a phi scan, multi-scan nor DIFABS (section !elabel!DIFABS!) will make a 
 good theta 
 approximation. See Int Tab,
 Vol II, p295 and 303 for suitable profiles.
<div class="parameter"><i>NTHETAVALUES=</i>
 The number of sampling points on the theta curve.
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>THETAVALUES THETA= .....</i></strong>
 The Nthetavalues at which the curve is sampled
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>THETACURVE CORRECTION= ......</i></strong>
 The Nthetavalue values of the correction factor profile.
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>TUBE NOTHING OMEGA= CHI= PHI= KAPPA= MU A[MAX]</i></strong>
 If TUBE has been set to 'YES' above, this directive sets up the
 correction for a sample in a tube, or for an acicular crystal steeply
 inclined to the phi axis. See J. Appl. Cryst, 8. 491, 1975. 'NOTHING' is
 a place-holder for internal workings.
<div class="parameter"><i>OMEGA= CHI= PHI= KAPPA=</i>
 These are the settings needed to bring the tube axis into the
 equatorial plane and perpendicular to the incident X-ray beam. Only one
 of Chi and Kappa may be given.
</div>
<div class="parameter"><i>MU=</i>
 The product of Mu and the thickness of the tube wall.
</div>
<div class="parameter"><i>A[MAX]</i>
 The maximum permitted correction. Values greater than A[max] generate a
 warning.
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>PLATE NOTHING OMEGA= CHI= PHI= KAPPA= MU A[MAX]</i></strong>
 If PLATE has been set to 'YES' above, this directive sets up the
 correction for an extended plate-like sample. See J. Appl. Cryst, 8. 491,
 1975. 'NOTHING' is
 a place-holder for internal workings.
<div class="parameter"><i>OMEGA= CHI= PHI= KAPPA=</i>
 These are the settings needed to bring the plate normal into the
 equatorial plane and perpendicular to the incident X-ray beam. Only one
 of Chi and Kappa may be given.
</div>
<div class="parameter"><i>MU=</i>
 The product of Mu and the plate thickness.
</div>
<div class="parameter"><i>A[MAX]</i>
 The maximum permitted correction. Values greater than A[max] generate a
 warning.
<BR>
<BR>&nbsp;<BR>
<A NAME="LIST 27"> </A>
<A NAME="Intensity decay curves"> </A>
</div>
</div>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.list27">5.12: Intensity Decay Curves  \LIST 27</A></H3></CENTER>
<A NAME="LIST27"> </A>


<pre>
 \LIST 27
 READ NSCALE=
 SCALE SCALENUMBER= RAWSCALE= SMOOTHSCALE= SERIAL=
 END
</pre><p><BR>
<P>If each reflection has been assigned a serial number (or some other
 incrementing value, such as total X-ray exposure time) then CRYSTALS can
 apply a correction which is linked to this value. The corrections, on the
 scale of Fsq, are held in LIST 27. Two correction factors can be stored,
 but only one used. For example, these can be the actual corrections computed
 from the decay of the standard reflections, and those obtained from
 a 3-point smoothing of the same correction data.
 The applied scale factor is obtained by interpolating between those given
 scale factors with serial numbers above and below the serial number of
 the current reflection.
 If there is a dramatic change in scale (for example due to remeasurement
 of some very strong reflections with attenuated X-rays), it is important
 not to interpolate over this discontinuity. To achieve this, a dummy
 scale factor is inserted at this point with scale values the same as the
 current scales, but with the same serial number as the first scales
 after the discontinuity - for example:

<pre>
 \LIST 27
 READ NSCALE=16
 SCALE   1      1.000  1.000    1
 SCALE   2      1.066  1.066    4
 SCALE   3      1.074  1.053   57
 SCALE   4      0.997  1.018   83
 SCALE   5      1.003  1.003  564
 SCALE   6      0.370  0.370  564
 SCALE   7      0.372  0.371  617
 END
</pre><p><BR>
<BR>&nbsp;<BR>
<div class="instruction"><strong><u>\LIST 27</u></strong><br>
<BR>&nbsp;<BR>
<div class="directive"><strong><i>READ NSCALE=</i></strong>
<div class="parameter"><i>NSCALE=</i>
 The number of  SCALE directives to follow.
 There is no default value for this parameter.
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>SCALE SCALENUMBER= RAWSCALE= SMOOTHSCALE= SERIALNUMBER=</i></strong>
<P>This directive is repeated once for each scale factor that is
 to be read in.
<div class="parameter"><i>SCALENUMBER=</i>
 This parameter indicates the number of the scale factor, starting
 from one.  There is no default for this parameter, which currently is
 not used.
</div>
<div class="parameter"><i>RAWSCALE=</i>
 This parameter gives the initial scale factor, computed directly
 from the intensities of the standard reflections.
<BR>
 There is no default.
</div>
<div class="parameter"><i>SMOOTHSCALE=</i>
 This parameter gives the scale factor after the raw scale factors have been
 smoothed, so that a continuous curve is fitted to all the data.
<BR>
 There is no default.
</div>
<div class="parameter"><i>SERIALNUMBER=</i>
 This parameter gives the serial number of the first standard reflection
 contributing to this scale.
 The data reduction programs use the  SERIAL to locate the correct
 scales to use for a given reflection.
<BR>
 There is no default.
<BR>
<BR>&nbsp;<BR>
</div>
</div>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.print27">5.13: Printing the decay curve</A></H3></CENTER>

<BR>&nbsp;<BR>
<div class="instruction"><strong><u>\PRINT 27</u></strong><br>
<P>This command prints the decay curve.
 There is no command to punch LIST 27.
<BR>
<BR>&nbsp;<BR>
<A NAME="LP"> </A>
<A NAME="Data reduction"> </A>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.datareduc">5.14: Data Reduction - Lp</A></H3></CENTER>
<A NAME="DATAREDUC"> </A>

<P>This command causes the Lp correction to be calculated for each
 reflection.
<P>The diffraction geometry, wavelength, etc. are taken from
 LIST 13 (section !elabel!LIST13!).
 If LIST 13 is input incorrectly, or has to be generated by the system,
 the message 'illegal diffraction geometry flag' will be output
 and the job terminated. If the user has forced the storage of Fsq
 values in \HKLI, it is necessary to indicate this to the Lp correction.

<pre>
 \LP
 STORE MEDIUM= F'S=
 END
</pre><p><BR>
For example
<pre>
 \  Apply an LP correction for the geometry stored
 \  in List 13.
 \LP
 END
</pre><p><BR>
<BR>&nbsp;<BR>
<div class="instruction"><strong><u>\LP</u></strong><br>
<BR>&nbsp;<BR>
<div class="directive"><strong><i>STORE MEDIUM= F'S=</i></strong>
<div class="parameter"><i>MEDIUM=</i>
      Determines the output medium.

<pre>
      FILE              A serial file
      INPUT - Default   The same as the input medium
      DISC              The .DSC file.
</pre><p><BR>
 The default output medium is the same as te input medium -  usually a
 serial file.
</div>
<div class="parameter"><i>F'S=</i>

<pre>
      FO      -      Default
      FSQ            Indicating that square roots were not taken at
                     input time.
</pre><p><BR>
<BR>&nbsp;<BR>
<A NAME="SYSTEMATIC"> </A>
<A NAME="Removing systematic absences"> </A>
</div>
</div>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.syst">5.15: Systematic absence removal - \SYSTEMATIC</A></H3></CENTER>
<A NAME="SYSTEMATIC"> </A>


<pre>
 \SYSTEMATIC INPUTLIST=
 STORE MEDIUM= F'S= NEWINDICES=  FRIEDEL=
 END
</pre><p><BR>
For example:
<pre>
 \  Remove systematic absences and move each hkl index
 \  by symmetry so that they all lie in the same part of
 \  the reciprocal lattice:
 \SYST
 END
</pre><p><BR>
<P>This routine uses the symmetry operators in LIST 2 (section !elabel!LIST02!)
 to identify
 systematic absences, which are listed and rejected. It can also
 use the symmetry operators to transform indices to that the reflections
 fall into a unique part of the reciprocal lattice. The unique set is
 bounded by the maximum range in 'l', maximum range of 'k' given the 'l'
 range, and maximum range of 'h', given the 'k,l' range.

<P>Friedel's Law may be invoked, depending on the flag in 
 LIST 13 (section !elabel!LIST13!).
 It is important <strong>NOT</strong> to use Friedel's Law for structures which have
 strong anomalous scatterers,
 since reflections related by Friedel's law are not
 equivalent in this case and should not be merged together.
 Similarly, if orientation dependent corrections are to be made (<i>e.g.</i>
 DIFABS),original indices should be preserved. Note that in this case,
 only exactly equivalent reflections will be merged, and care must be
 taken when computing Fourier maps. See the sections on Fourier maps, 
 !flabel!FOURIER! and DIFABS !RDIFABS<BR>.  
<P>If FRIEDEL is set to "YES", Friedel's law is applied whatever the 
 space group.  A flag is set in the 'JCODE' slot for each reflection 
 to indicate if the law was invoked or not. 
 DO NOT USE excluded JCODES IN \MERGE. If the data is then
 sorted but not merged, Friedel pairs will be adjacent and flagged. Used
 by the function "\TON" for evaluating absolute configuration.
<BR>
<BR>&nbsp;<BR>
<div class="instruction"><strong><u>\SYSTEMATIC</u></strong><br>
<BR>&nbsp;<BR>
<div class="directive"><strong><i>SYSTEMATIC INPUTLIST=</i></strong>
<BR>&nbsp;<BR>
<div class="parameter"><i>INPUTLIST=</i>
     6 OR 7
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>STORE MEDIUM= F'S= NEWINDICES=</i></strong>
<div class="parameter"><i>MEDIUM=</i>
      Determines the output medium.

<pre>
      FILE              A serial file
      INPUT - Default   The same as the input medium
      DISC              The .DSC file.
</pre><p><BR>
 The default output medium is the same as the input medium -  usually a
 serial file.
<BR>
</div>
<div class="parameter"><i>F'S=</i>

<pre>
      FO      -      Default
      FSQ            Indicating that square roots were not taken at
                     input time.
</pre><p><BR>
<BR>
</div>
<div class="parameter"><i>FRIEDEL=</i>

<pre>
      No      -      Default
      YES            Indicating that Friedels law should be applied 
                     whatever the space group.
</pre><p><BR>
</div>
<div class="parameter"><i>NEWINDICES=</i>
 Determines whether new indices are computed.

<pre>
      YES  -  Default - Permits transformation of indices.
      NO
</pre><p><BR>
<BR>&nbsp;<BR>
<A NAME="Sorting reflection data"> </A>
</div>
</div>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.sort">5.16: Sorting of the reflection data  -  \SORT</A></H3></CENTER>
<A NAME="SORT"> </A>


<pre>
 \SORT INPUTLIST=
 STORE MEDIUM=
 END
</pre><p><BR>
For example:
<pre>
 \  Sort reflections into order by L, then K, then H:
 \SORT
 END
</pre><p><BR>
<P>This routine sorts the data so that the reflections are placed
 in a predetermined order, in which reflections with the same indices
 are adjacent in the list. Upon output, the reflections are arranged
 so that they are in groups of constant  L, starting with the group
 with the smallest  L  value. Within any  L  group, the reflections
 are ordered in groups of constant  K, starting with the group with the
 smallest  K  value. Within each  group of constant K and L, the 
 reflections are arranged
 with the smallest  H  value first and the largest last in ascending
 order.
<P>The method of sorting is a multi-pass tree sort, in which as
 many reflections as possible are held in memory during each pass.
 If all the reflections with a given value of  L  cannot be in memory
 at the same time, the program will terminate in error.
<BR>&nbsp;<BR>
<div class="instruction"><strong><u>\SORT</u></strong><br>
<BR>&nbsp;<BR>
<div class="directive"><strong><i>STORE MEDIUM</i></strong>
<div class="parameter"><i>MEDIUM=</i>
      Determines the output medium.

<pre>
      FILE              A serial file
      INPUT - Default   The same as the input medium
      DISC              The .DSC file.
</pre><p><BR>
 The default output medium is the same as the input medium -  usually a
 serial file.
<BR>
<BR>&nbsp;<BR>
<A NAME="Merging reflection data"> </A>
<A NAME="MERGE"> </A>
</div>
</div>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.merge">5.17: Merging equivalent reflections  -  \MERGE</A></H3></CENTER>


<pre>
 \MERGE INPUT= TWINNED=
 STORE MEDIUM=
 REFLECTIONS NJCODE= LIST= LEVEL= F'S=
 JCODE NUMBER= VALUE=
 REJECT RATIO= SIGMA=
 WEIGHT SCHEME= NPARAMETERS= NCYCLE=
 PARAMETERS P .....
 END
</pre><p><BR>
For example:

<pre>
 \MERGE
 WEIGHT SCHEME=2 NPARAM=6
 PARAMETERS .5  3.0  1.0  2.0  .01 .00001
 END
</pre><p><BR>
<P>The merge routine takes a list of
 reflections and combines groups of adjacent reflections with
 <i>exactly</i> the same indices to
 produce a single mean structure amplitude.
<P>\SYST (section !flabel!SYSTEMATIC!) and \SORT (section !RSORT<BR>) produce 
 a suitable list, and if
 either of them have been omitted, it is extremely
 likely that the list of reflections produced by the merge process
 will contain duplicated entries for certain reflections.
<P>It is possible to combine equivalent
 reflections in several different ways, depending upon how each
 individual contributor is weighted when the mean is computed.
 Several different weighting schemes are provided, and these are described
 in the next section (the  WEIGHT  directive).
<P>The JCODE key in the list of reflections may be input from some
 diffractometers (e.g. a CAD4) to indicate that the value may be
 inaccurate. Reflections which have JCODES that differ from unity 
 are thought
 to be inaccurate and can be down-weighted or eliminated during the merge
 process (the  JCODE  directive). Note that JCODES MUST be positive
 and less than 10.
<P>Although under normal circumstances LIST 6 (reflections) contains /Fo/
 data rather than /Fo/**2 data, the calculations performed during
 the merge are done on the scale of /Fo/**2.
 This means that r-values are computed which refer to /Fo/**2,
 and that reflections can be rejected on the basis of the
 ratio of /Fo/**2 to its standard deviation.
 If for some reason the LIST 6 contains /Fo/**2 data rather
 than the normal /Fo/ data, it is necessary to use the "F's"
 parameter of the "REFLECTIONS" directive to inform the system 
 of this fact.
<P>During the merge process, the system calculates and then prints a
 set of merging r-values, which are defined as follows :

<pre>
 R = 100*SUM[ Sd(i) ]/SUM[ M(i) ],
             where 'i' runs over all reflections.


 Sd(i) = SUM[ &lt;Fsq(i)&gt; - Fsq(j) ],
             summed over 'j' contributors.

 and

 M(i) = SUM[ &lt;Fsq(i)&gt; ],
            summed 'j' times for 'j' contributors.
</pre><p><BR>
 The sum variable  'i'  runs over all the reflections produced by the merge
 process which have more than one contributor.
 The sum variable  'j'  runs over all the contributors for each reflection
 produced by the merge process.
  &lt;Fsq(I)&gt;  is the mean value for the reflection  'i' , while  Fsq(j)  is
 the observed value of Fsq for the contributor  'j'.
<P>If the crystal is twinned, this will affect the merge. See chapter 
<A NAME="twinning"> </A> on twinned crystals
<P>If the data is in Batches with different BATCH scale factors, this will
 affect the merge.
<BR>&nbsp;<BR>
<div class="instruction"><strong><u>WEIGHTING SCHEMES FOR THE DATA MERGE</u></strong><br>
<P>At present there are three different weighting schemes available
 for merging equivalent reflections.
 These are :

<pre>
      1.      Each reflection is given equal weight (unit weights).
      2.      Weights based on a Gaussian distribution.
      3.      W(i) = 1.0/Sigma(i)**2  for each reflection.
</pre><p><BR>
<P>Unit and statistical weights (schemes 1 and 3) are more or less
 equivalent unless some reflections have been remeasured under very
 different regimes ( <i>e.g.</i> with an attenuator set, mA turned down,
 different crystal)
<P>Scheme 2 is designed to discriminate against outliers, <i>i.e.</i>
 reflections lying farther from the mean than might be expected.

 For this scheme, a weighted mean value of Fsq is determined
 iteratively, starting from unit weights.
 At each iteration, the weights are recomputed to discriminate against
 outliers and  the contributing reflections are given a new
 weight w(i) given by :

<pre>
      w(i) = exp [ (-log(a) * q(i)**2)/(b**2 * e(i)**2) ]

 Where

     q(i)  is the deviation of the particular Fsq(i) from the current average.
     e(i)  is a predicted mean deviation of the reflection 'i' from the
           current mean and is given by a function similar to that used
           in Least Squares :
</pre><p><BR>
 e = c + d*Sig(Fsq) + g*Sig(Fsq)*/Fo/ + h*Sig(Fsq)*Fsq
<BR>
 a,b,c,d,g,h  are 6 input parameters provided by the user
<BR>
 'a'  and  'b' define the Gaussian distribution.
<BR>
 'a'  is the weight to be given to a reflection which has a
 deviation given by 'q(i) = b*e(i)'.
<BR>
 Suggested values of  'a'  and  'b'  are  0.5 and 3.0 respectively,
 so that if for example, 'e(i) = 3*Sig(Fsq)' (d=3, c=g=h=0),
 a deviation  q(i)  of  6*Sig*fsq  will assign a reflection a
 weight of 0.5.
<BR>
  'c'  Provides the bias necessary to allow for
 failures in the counting statistics at low count
 rates.
<BR>
  'd'  is a scaling constant.
<BR>
  'g'  and  'h'  allow for the increased dispersion of strong reflections.

<pre>
 For a conventional diffractometer, suggested values for the parameters are :

      a = .5      b=3.0      c=1.0      d=2.0      g=.01      h=.00001
</pre><p><BR>
<P>It is recommended that the Gaussian scheme be used, as it discriminates
 against zero or widely dispersed intensities very efficiently.
<BR>&nbsp;<BR>
</div>
<div class="instruction"><strong><u>Standard deviations produced by the merge</u></strong><br>
<P>After the equivalent reflections have been merged
 two different standard deviations
 are computed and can be output :

<pre>
 SIGMA1 = Sqrt (sum [ w(i)*q(i)**2 ] / n * sum [ w(i) ])
             that is, the weighted r.m.s. deviation.

 SIGMA2 = Sqrt (sum [ w(i)*s(i)**2 ] / n * sum [ w(i) ])
             that is, the weighted average standard deviation.
</pre><p><BR>
 Either of these two standard deviations can be selected as an estimate
 of Sigma(Fsq), and perhaps be converted to a Least Squares weight. If a
 reflection is measured very many times, SIGMA1 should be similar to
 SIGMA2. It is almost always much greater.
<BR>&nbsp;<BR>
</div>
<div class="instruction"><strong><u>\MERGE</u></strong><br>
<BR>&nbsp;<BR>
<div class="directive"><strong><i>MERGE=</i></strong>
<div class="parameter"><i>INPUT=</i>
  Either 6 or 7.  Default is 6.
<BR>&nbsp;<BR>
</div>
<div class="parameter"><i>TWINNED=</i>
<pre>
  NO      Treat data as un-twinned
  LIST13  Treat data according to list 13 
  YES     Treat data as twinned
</pre><p><BR>
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>STORE MEDIUM=</i></strong>
<div class="parameter"><i>MEDIUM=</i>
      Determines the output medium.

<pre>
      FILE              A serial file
      INPUT - Default   The same as the input medium
      DISC              The .DSC file.
</pre><p><BR>
 The default output medium is the same as the input medium -  usually a
 serial file.
<BR>
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>REFLECTIONS NJCODE= LIST= LEVEL= F'S=</i></strong>
<div class="parameter"><i>NJCODE=</i>
 Specifies the number of JCODE directives to follow - default zero.
</div>
<div class="parameter"><i>LIST=</i>
 Determines the amount of information printed
 during the merge process.

<pre>
      OFF
      MEDIUM  -  Default value
      HIGH
</pre><p><BR>
 If  LIST  is 'HIGH' , all Fsq are listed with their
 contributors and their deviations from the computed mean.
 The default value of  MEDIUM  indicates that the merged Fsq are listed
 with the contributors and their deviations
 from the computed mean if the r.m.s. deviation exceeds
 LEVEL*(mean standard deviation).
  HIGH  is equivalent to  MEDIUM  with  LEVEL  set at zero.
</div>
<div class="parameter"><i>LEVEL=</i>
 This parameter specifies the r.m.s. deviation level above which
 contributors are printed if  LIST  is equal to  MEDIUM .

 They are printed if sigma1 exceeds level*sigma2.
 The default value for this parameter is 3.
</div>
<div class="parameter"><i>F'S=</i>

<pre>
      FO      -      Default
      FSQ            Indicating that square roots were not taken at
                     input time.
</pre><p><BR>
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>JCODE NUMBER= VALUE=</i></strong>
<P>This directive allows reflections whose JCODE key differs from
 unity to be down-weighted or eliminated from the merge.
 It is repeated once for each JCODE that is read in.
<div class="parameter"><i>NUMBER=</i>
 The number of the JCODE must be given.
 There is no default value for this parameter.
</div>
<div class="parameter"><i>VALUE=</i>
 This is the absolute weight, associated with the JCODE number,
 that is given to the reflection.
 If this parameter is omitted a default value of zero is assumed,
 indicating that the reflection is to be eliminated
 and not included in the merge at all.
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>REJECT RATIO= SIGMA=</i></strong>
<P>This directive causes reflections
 whose mean intensity is less than product of the ratio and sigma to 
 be eliminated.
<div class="parameter"><i>RATIO=</i>
 The default value for this parameter is -10. Use LIST 28 (section 
!elabel!LIST28!) to suppress the
 use of reflections with RATIOs below a suitable threshold.
</div>
<div class="parameter"><i>SIGMA=</i>
<BR>

<pre>
      1
      2  -  Default value
</pre><p><BR>
 If sigma is equal to 1 the e.s.d. is the weighted r.m.s. deviation.
 If sigma is equal to 2 the e.s.d. is the weighted standard deviation.
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>WEIGHT SCHEME= NPARAMETERS= NCYCLE=</i></strong>
<P>This directive determines the weighting scheme to be used in
 merging equivalent reflections.
<div class="parameter"><i>SCHEME=</i>
 This parameter determines which of the weighting schemes defined above
 is to be used in the merging of equivalent reflections,
 and must take one of the following values:
<BR>

<pre>
      1  -  Default value (unit weights)
      2                   (modified Gaussian)
      3                   (statistical)
</pre><p><BR>
 If this parameter is omitted, unit weights are applied (scheme=1).
</div>
<div class="parameter"><i>NPARAMETERS=</i>
 This must be set to the number of parameters required to define the
 weighting scheme, and thus the number of values on the
  PARAMETERS  directive to follow.
 The default value for this parameter is zero,
 as schemes 1 and 3 require no parameters.
</div>
<div class="parameter"><i>NCYCLE=</i>
 This parameter has a default value of 5 and is the number of cycles of
 refinement of the weighted mean if scheme 2 is being used in the merge.
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>PARAMETERS P .....</i></strong>
 This directive contains  NPARAMETERS  values.
<div class="parameter"><i>P=</i>
 For weighting scheme 2, these parameters give the values  'a'  to  'h'
 defined above, and describe the form of the Gaussian distribution.
<BR>&nbsp;<BR>
<BR>&nbsp;<BR>
<A NAME="Theta-dependent Absorption Correction"> </A>
<A NAME="THETABS"> </A>
</div>
</div>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.thetabs">5.18: Theta-dependent Absorption Correction  -  \THETABS</A></H3></CENTER>


<pre>
 \THETABS
 THETA NTHETAVALUES=
 THETAVALUES THETA=
 THETACURVE CORRECTION= ........
 END
</pre><p><BR>
<BR>
For example

<pre>
 \THETABS
 THETA 16
 THETAVALUES
 CONT 0  5 10 15 20 25 30 35 40 45 50 55 60 65 70 75
 THETACURVE
 CONT 3.61  3.60  3.58  3.54  3.50  3.44  3.37  3.30
 CONT 3.23  3.16  3.09  3.02  2.96  2.91  2.86  2.82
 END
</pre><p><BR>
<P> Except
 when the data has been corrected by a proper analytical correction,
 a theta dependent correction is <strong>ALWAYS</strong> recommended, since neither
 a phi scan multi-scan nor DIFABS (section !elabel!DIFABS!) will make a 
 good theta 
 approximation. See Int Tab,
 Vol II, p295 and 303 for suitable profiles.
<BR>
<BR>&nbsp;<BR>
<div class="directive"><strong><i>THETA NTHETAVALUES=</i></strong>
<div class="parameter"> <i>NTHETAVALUES=</i>
 The number of sampling points on the theta curve.
<BR>&nbsp;<BR>
</div>
</div>
<div class="directive"><strong><i>THETAVALUES THETA= .....</i></strong>
 The Nthetavalues at which the curve is sampled
<BR>&nbsp;<BR>
</div>
<div class="directive"><strong><i>THETACURVE CORRECTION= ......</i></strong>
 The Nthetavalue values of the correction factor profile.
<BR>&nbsp;<BR>
<BR>
<BR>&nbsp;<BR>
<A NAME="wILSON PLOT"> </A>
<A NAME="WILSON"> </A>
</div>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.wilson">5.19: WILSON PLOT  -  \WILSON</A></H3></CENTER>


<pre>
 \WILSON
 OUTPUT PLOT= NZ= STATS= EVALS=
 FILTER LIST28=
 WEIGHT UPDATE=
 END
</pre><p><BR>
<BR>
PLOT, NZ and STATS take values of YES and NO, controlling whether output
is sent to the GUI.
EVALS takes the values NO/YES/PUNCH.
<BR>
 NO/YES  controls whether E-values are computed.
<BR>
 PUNCH enables E-values to be computed and output to a text file.
<BR>
<BR>
<BR>
<BR>&nbsp;<BR>
<A NAME="THLIM"> </A>
<A NAME="THLIM"> </A>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.20">5.20: THLIM  -  \THLIM</A></H3></CENTER>
<BR>Hthetalim#

<pre>
 \THLIM  INPUTLIST=
 OUTPUT PLOT= GLIST=
 END
</pre><p><BR>
 This command is only used in SCRIPTS to send information to the GUI
<BR>
INPUTLIST IS EITHER 6 or 7
<BR>
PLOT=YES sends plotting data to the GUI
<BR>
GLIST=YES sends a list of missing reflections to the GUI
<BR>
<BR>
<BR>
<BR>&nbsp;<BR>
<BR>SIGMADIST#
<A NAME="SIGMADIST"> </A>
<HR><small><A HREF="crystalsmanual-reflectionin.html">[Top]</A> <A HREF="manindex.html">[Index]</A> Manuals generated on Friday 5 July 2024</small>
<CENTER><H3><A NAME="reflectionin.21">5.21: SIGMADIST  -  \SIGMADIST</A></H3></CENTER>
<BR>Hsigmadist#

<pre>
 \SIGMADIST  INPUTLIST=
 OUTPUT PLOT= RESOLUTIO= PHASE= FILTER=
 END
</pre><p><BR>
 This command is only used in SCRIPTS to send information to the GUI
<BR>
PLOT=YES sends completeness data to GUI
<BR>
RESOLUTIO=YES sends distribution as function of resolution to GUI
<BR>
PHASE=YES   sends phase angle distribution to GUI
<BR>
FILTER=YES enable LIST 28 to be used.
<BR>
<BR>
<BR>&nbsp;<BR>
